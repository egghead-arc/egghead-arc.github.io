const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-DK8Ll48f.js","assets/en_US-AV7YDYDW-CITRz_QN.js","assets/en_US-AV7YDYDW-tdbzgZHY.css","assets/events-CxJ-SBIC.js","assets/inherits_browser-CKSPihn-.js","assets/index-BqU1NI_X.js"])))=>i.map(i=>d[i]);
import{l as vl,_ as yl,c as Dt,g as vh}from"./en_US-AV7YDYDW-CITRz_QN.js";import{e as ir,w as yh}from"./events-CxJ-SBIC.js";import{r as ml,i as ro}from"./inherits_browser-CKSPihn-.js";var uu=function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},W1=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),G1=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),J1=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),Y1=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),X1=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Z1=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Q1=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,fu=3,eb=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Z1]],du=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function tb(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new X1:typeof navigator<"u"?ib(navigator.userAgent):nb()}function rb(t){return t!==""&&eb.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var n=s.exec(t);return!!n&&[i,n]},!1)}function ib(t){var e=rb(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new Y1;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<fu&&(s=uu(uu([],s,!0),ab(fu-s.length),!0)):s=[];var n=s.join("."),a=sb(t),o=Q1.exec(t);return o&&o[1]?new J1(r,n,a,o[1]):new W1(r,n,a)}function sb(t){for(var e=0,r=du.length;e<r;e++){var i=du[e],s=i[0],n=i[1],a=n.exec(t);if(a)return s}return null}function nb(){var t=typeof process<"u"&&process.version;return t?new G1(process.version.slice(1)):null}function ab(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var K={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Dc=function(t,e){return Dc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},Dc(t,e)};function ob(t,e){Dc(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Pc=function(){return Pc=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++){r=arguments[i];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Pc.apply(this,arguments)};function cb(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r}function hb(t,e,r,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(n=(s<3?a(n):s>3?a(e,r,n):a(e,r))||n);return s>3&&n&&Object.defineProperty(e,r,n),n}function ub(t,e){return function(r,i){e(r,i,t)}}function fb(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function db(t,e,r,i){function s(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function o(f){try{h(i.next(f))}catch(l){a(l)}}function c(f){try{h(i.throw(f))}catch(l){a(l)}}function h(f){f.done?n(f.value):s(f.value).then(o,c)}h((i=i.apply(t,e||[])).next())})}function lb(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(h){return function(f){return c([h,f])}}function c(h){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=h[0]&2?s.return:h[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,h[1])).done)return n;switch(s=0,n&&(h=[h[0]&2,n.value]),h[0]){case 0:case 1:n=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,s=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){r.label=h[1];break}if(h[0]===6&&r.label<n[1]){r.label=n[1],n=h;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(h);break}n[2]&&r.ops.pop(),r.trys.pop();continue}h=e.call(t,r)}catch(f){h=[6,f],s=0}finally{i=n=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function pb(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function bb(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Oc(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function wl(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),s,n=[],a;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return n}function gb(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(wl(arguments[e]));return t}function vb(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),s=0,e=0;e<r;e++)for(var n=arguments[e],a=0,o=n.length;a<o;a++,s++)i[s]=n[a];return i}function Nn(t){return this instanceof Nn?(this.v=t,this):new Nn(t)}function yb(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),s,n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(v){i[v]&&(s[v]=function(_){return new Promise(function(m,$){n.push([v,_,m,$])>1||o(v,_)})})}function o(v,_){try{c(i[v](_))}catch(m){l(n[0][3],m)}}function c(v){v.value instanceof Nn?Promise.resolve(v.value.v).then(h,f):l(n[0][2],v)}function h(v){o("next",v)}function f(v){o("throw",v)}function l(v,_){v(_),n.shift(),n.length&&o(n[0][0],n[0][1])}}function mb(t){var e,r;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=t[s]?function(a){return(r=!r)?{value:Nn(t[s](a)),done:s==="return"}:n?n(a):a}:n}}function wb(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Oc=="function"?Oc(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(n){r[n]=t[n]&&function(a){return new Promise(function(o,c){a=t[n](a),s(o,c,a.done,a.value)})}}function s(n,a,o,c){Promise.resolve(c).then(function(h){n({value:h,done:o})},a)}}function _b(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Eb(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function xb(t){return t&&t.__esModule?t:{default:t}}function $b(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Sb(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const Ib=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Pc},__asyncDelegator:mb,__asyncGenerator:yb,__asyncValues:wb,__await:Nn,__awaiter:db,__classPrivateFieldGet:$b,__classPrivateFieldSet:Sb,__createBinding:pb,__decorate:hb,__exportStar:bb,__extends:ob,__generator:lb,__importDefault:xb,__importStar:Eb,__makeTemplateObject:_b,__metadata:fb,__param:ub,__read:wl,__rest:cb,__spread:gb,__spreadArrays:vb,__values:Oc},Symbol.toStringTag,{value:"Module"})),io=vl(Ib);var Bo={},bn={},lu;function Ab(){if(lu)return bn;lu=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return bn.delay=t,bn}var Ii={},qo={},Ai={},pu;function Db(){return pu||(pu=1,Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.ONE_THOUSAND=Ai.ONE_HUNDRED=void 0,Ai.ONE_HUNDRED=100,Ai.ONE_THOUSAND=1e3),Ai}var Lo={},bu;function Pb(){return bu||(bu=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Lo)),Lo}var gu;function _l(){return gu||(gu=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=io;e.__exportStar(Db(),t),e.__exportStar(Pb(),t)}(qo)),qo}var vu;function Ob(){if(vu)return Ii;vu=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.fromMiliseconds=Ii.toMiliseconds=void 0;const t=_l();function e(i){return i*t.ONE_THOUSAND}Ii.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Ii.fromMiliseconds=r,Ii}var yu;function Mb(){return yu||(yu=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=io;e.__exportStar(Ab(),t),e.__exportStar(Ob(),t)}(Bo)),Bo}var es={},mu;function Cb(){if(mu)return es;mu=1,Object.defineProperty(es,"__esModule",{value:!0}),es.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return es.Watch=t,es.default=t,es}var jo={},gn={},wu;function Tb(){if(wu)return gn;wu=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.IWatch=void 0;class t{}return gn.IWatch=t,gn}var _u;function Rb(){return _u||(_u=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),io.__exportStar(Tb(),t)}(jo)),jo}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=io;e.__exportStar(Mb(),t),e.__exportStar(Cb(),t),e.__exportStar(Rb(),t),e.__exportStar(_l(),t)})(K);var _e={};Object.defineProperty(_e,"__esModule",{value:!0});_e.getLocalStorage=_e.getLocalStorageOrThrow=_e.getCrypto=_e.getCryptoOrThrow=El=_e.getLocation=_e.getLocationOrThrow=mh=_e.getNavigator=_e.getNavigatorOrThrow=Hn=_e.getDocument=_e.getDocumentOrThrow=_e.getFromWindowOrThrow=_e.getFromWindow=void 0;function ki(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}_e.getFromWindow=ki;function Bs(t){const e=ki(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}_e.getFromWindowOrThrow=Bs;function Nb(){return Bs("document")}_e.getDocumentOrThrow=Nb;function Fb(){return ki("document")}var Hn=_e.getDocument=Fb;function Bb(){return Bs("navigator")}_e.getNavigatorOrThrow=Bb;function qb(){return ki("navigator")}var mh=_e.getNavigator=qb;function Lb(){return Bs("location")}_e.getLocationOrThrow=Lb;function jb(){return ki("location")}var El=_e.getLocation=jb;function Ub(){return Bs("crypto")}_e.getCryptoOrThrow=Ub;function zb(){return ki("crypto")}_e.getCrypto=zb;function kb(){return Bs("localStorage")}_e.getLocalStorageOrThrow=kb;function Hb(){return ki("localStorage")}_e.getLocalStorage=Hb;var wh={};Object.defineProperty(wh,"__esModule",{value:!0});var xl=wh.getWindowMetadata=void 0;const Eu=_e;function Kb(){let t,e;try{t=Eu.getDocumentOrThrow(),e=Eu.getLocationOrThrow()}catch{return null}function r(){const l=t.getElementsByTagName("link"),v=[];for(let _=0;_<l.length;_++){const m=l[_],$=m.getAttribute("rel");if($&&$.toLowerCase().indexOf("icon")>-1){const O=m.getAttribute("href");if(O)if(O.toLowerCase().indexOf("https:")===-1&&O.toLowerCase().indexOf("http:")===-1&&O.indexOf("//")!==0){let D=e.protocol+"//"+e.host;if(O.indexOf("/")===0)D+=O;else{const P=e.pathname.split("/");P.pop();const C=P.join("/");D+=C+"/"+O}v.push(D)}else if(O.indexOf("//")===0){const D=e.protocol+O;v.push(D)}else v.push(O)}}return v}function i(...l){const v=t.getElementsByTagName("meta");for(let _=0;_<v.length;_++){const m=v[_],$=["itemprop","property","name"].map(O=>m.getAttribute(O)).filter(O=>O?l.includes(O):!1);if($.length&&$){const O=m.getAttribute("content");if(O)return O}}return""}function s(){let l=i("name","og:site_name","og:title","twitter:title");return l||(l=t.title),l}function n(){return i("description","og:description","twitter:description","keywords")}const a=s(),o=n(),c=e.origin,h=r();return{description:o,url:c,icons:h,name:a}}xl=wh.getWindowMetadata=Kb;function Fn(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function xu(t){return Fn(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const $l="2.23.2";let vn={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${$l}`};class qi extends Error{constructor(e,r={}){var o;const i=(()=>{var c;return r.cause instanceof qi?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),s=r.cause instanceof qi&&r.cause.docsPath||r.docsPath,n=(o=vn.getDocsUrl)==null?void 0:o.call(vn,{...r,docsPath:s}),a=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...i?[`Details: ${i}`]:[],...vn.version?[`Version: ${vn.version}`]:[]].join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=s,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=$l}walk(e){return Sl(this,e)}}function Sl(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Sl(t.cause,e):e?null:t}class Il extends qi{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}function qs(t,{dir:e,size:r=32}={}){return typeof t=="string"?Vb(t,{dir:e,size:r}):Wb(t,{dir:e,size:r})}function Vb(t,{dir:e,size:r=32}={}){if(r===null)return t;const i=t.replace("0x","");if(i.length>r*2)throw new Il({size:Math.ceil(i.length/2),targetSize:r,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function Wb(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new Il({size:t.length,targetSize:r,type:"bytes"});const i=new Uint8Array(r);for(let s=0;s<r;s++){const n=e==="right";i[n?s:r-s-1]=t[n?s:t.length-s-1]}return i}class Gb extends qi{constructor({max:e,min:r,signed:i,size:s,value:n}){super(`Number "${n}" is not in safe ${s?`${s*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}}class Jb extends qi{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Ls(t,{size:e}){if(xu(t)>e)throw new Jb({givenSize:xu(t),maxSize:e})}function Mc(t,e={}){const{signed:r}=e;e.size&&Ls(t,{size:e.size});const i=BigInt(t);if(!r)return i;const s=(t.length-2)/2,n=(1n<<BigInt(s)*8n-1n)-1n;return i<=n?i:i-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function Yb(t,e={}){return Number(Mc(t,e))}const Xb=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Cc(t,e={}){return typeof t=="number"||typeof t=="bigint"?Dl(t,e):typeof t=="string"?eg(t,e):typeof t=="boolean"?Zb(t,e):Al(t,e)}function Zb(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(Ls(r,{size:e.size}),qs(r,{size:e.size})):r}function Al(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=Xb[t[s]];const i=`0x${r}`;return typeof e.size=="number"?(Ls(i,{size:e.size}),qs(i,{dir:"right",size:e.size})):i}function Dl(t,e={}){const{signed:r,size:i}=e,s=BigInt(t);let n;i?r?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const a=typeof n=="bigint"&&r?-n-1n:0;if(n&&s>n||s<a){const c=typeof t=="bigint"?"n":"";throw new Gb({max:n?`${n}${c}`:void 0,min:`${a}${c}`,signed:r,size:i,value:`${t}${c}`})}const o=`0x${(r&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?qs(o,{size:i}):o}const Qb=new TextEncoder;function eg(t,e={}){const r=Qb.encode(t);return Al(r,e)}const tg=new TextEncoder;function rg(t,e={}){return typeof t=="number"||typeof t=="bigint"?sg(t,e):typeof t=="boolean"?ig(t,e):Fn(t)?Pl(t,e):Ol(t,e)}function ig(t,e={}){const r=new Uint8Array(1);return r[0]=Number(t),typeof e.size=="number"?(Ls(r,{size:e.size}),qs(r,{size:e.size})):r}const Ur={zero:48,nine:57,A:65,F:70,a:97,f:102};function $u(t){if(t>=Ur.zero&&t<=Ur.nine)return t-Ur.zero;if(t>=Ur.A&&t<=Ur.F)return t-(Ur.A-10);if(t>=Ur.a&&t<=Ur.f)return t-(Ur.a-10)}function Pl(t,e={}){let r=t;e.size&&(Ls(r,{size:e.size}),r=qs(r,{dir:"right",size:e.size}));let i=r.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,n=new Uint8Array(s);for(let a=0,o=0;a<s;a++){const c=$u(i.charCodeAt(o++)),h=$u(i.charCodeAt(o++));if(c===void 0||h===void 0)throw new qi(`Invalid byte sequence ("${i[o-2]}${i[o-1]}" in "${i}").`);n[a]=c*16+h}return n}function sg(t,e){const r=Dl(t,e);return Pl(r)}function Ol(t,e={}){const r=tg.encode(t);return typeof e.size=="number"?(Ls(r,{size:e.size}),qs(r,{dir:"right",size:e.size})):r}function La(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ng(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function so(t,...e){if(!ng(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function PM(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");La(t.outputLen),La(t.blockLen)}function Su(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ag(t,e){so(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const ba=BigInt(2**32-1),Iu=BigInt(32);function og(t,e=!1){return e?{h:Number(t&ba),l:Number(t>>Iu&ba)}:{h:Number(t>>Iu&ba)|0,l:Number(t&ba)|0}}function cg(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:a}=og(t[s],e);[r[s],i[s]]=[n,a]}return[r,i]}const hg=(t,e,r)=>t<<r|e>>>32-r,ug=(t,e,r)=>e<<r|t>>>32-r,fg=(t,e,r)=>e<<r-32|t>>>64-r,dg=(t,e,r)=>t<<r-32|e>>>64-r,ts=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function lg(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function OM(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function MM(t,e){return t<<32-e|t>>>e}const Au=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function pg(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Du(t){for(let e=0;e<t.length;e++)t[e]=pg(t[e])}function bg(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Ml(t){return typeof t=="string"&&(t=bg(t)),so(t),t}function CM(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];so(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}class gg{clone(){return this._cloneInto()}}function vg(t){const e=i=>t().update(Ml(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function TM(t=32){if(ts&&typeof ts.getRandomValues=="function")return ts.getRandomValues(new Uint8Array(t));if(ts&&typeof ts.randomBytes=="function")return ts.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const Cl=[],Tl=[],Rl=[],yg=BigInt(0),yn=BigInt(1),mg=BigInt(2),wg=BigInt(7),_g=BigInt(256),Eg=BigInt(113);for(let t=0,e=yn,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Cl.push(2*(5*i+r)),Tl.push((t+1)*(t+2)/2%64);let s=yg;for(let n=0;n<7;n++)e=(e<<yn^(e>>wg)*Eg)%_g,e&mg&&(s^=yn<<(yn<<BigInt(n))-yn);Rl.push(s)}const[xg,$g]=cg(Rl,!0),Pu=(t,e,r)=>r>32?fg(t,e,r):hg(t,e,r),Ou=(t,e,r)=>r>32?dg(t,e,r):ug(t,e,r);function Sg(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let a=0;a<10;a++)r[a]=t[a]^t[a+10]^t[a+20]^t[a+30]^t[a+40];for(let a=0;a<10;a+=2){const o=(a+8)%10,c=(a+2)%10,h=r[c],f=r[c+1],l=Pu(h,f,1)^r[o],v=Ou(h,f,1)^r[o+1];for(let _=0;_<50;_+=10)t[a+_]^=l,t[a+_+1]^=v}let s=t[2],n=t[3];for(let a=0;a<24;a++){const o=Tl[a],c=Pu(s,n,o),h=Ou(s,n,o),f=Cl[a];s=t[f],n=t[f+1],t[f]=c,t[f+1]=h}for(let a=0;a<50;a+=10){for(let o=0;o<10;o++)r[o]=t[a+o];for(let o=0;o<10;o++)t[a+o]^=~r[(o+2)%10]&r[(o+4)%10]}t[0]^=xg[i],t[1]^=$g[i]}r.fill(0)}class _h extends gg{constructor(e,r,i,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,La(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=lg(this.state)}keccak(){Au||Du(this.state32),Sg(this.state32,this.rounds),Au||Du(this.state32),this.posOut=0,this.pos=0}update(e){Su(this);const{blockLen:r,state:i}=this;e=Ml(e);const s=e.length;for(let n=0;n<s;){const a=Math.min(r-this.pos,s-n);for(let o=0;o<a;o++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,r&128&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Su(this,!1),so(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const a=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+a),s),this.posOut+=a,s+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return La(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ag(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:a}=this;return e||(e=new _h(r,i,s,a,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=a,e.destroyed=this.destroyed,e}}const Ig=(t,e,r)=>vg(()=>new _h(e,t,r)),Ag=Ig(1,136,256/8);function Nl(t,e){const r=e||"hex",i=Ag(Fn(t,{strict:!1})?rg(t):t);return r==="bytes"?i:Cc(i)}class Dg extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Uo=new Dg(8192);function Pg(t,e){if(Uo.has(`${t}.${e}`))return Uo.get(`${t}.${e}`);const r=t.substring(2).toLowerCase(),i=Nl(Ol(r),"bytes"),s=r.split("");for(let a=0;a<40;a+=2)i[a>>1]>>4>=8&&s[a]&&(s[a]=s[a].toUpperCase()),(i[a>>1]&15)>=8&&s[a+1]&&(s[a+1]=s[a+1].toUpperCase());const n=`0x${s.join("")}`;return Uo.set(`${t}.${e}`,n),n}function Og(t){const e=Nl(`0x${t.substring(4)}`).substring(26);return Pg(`0x${e}`)}async function Mg({hash:t,signature:e}){const r=Fn(t)?t:Cc(t),{secp256k1:i}=await yl(async()=>{const{secp256k1:a}=await import("./secp256k1-DK8Ll48f.js");return{secp256k1:a}},__vite__mapDeps([0,1,2,3,4]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:h,s:f,v:l,yParity:v}=e,_=Number(v??l),m=Mu(_);return new i.Signature(Mc(h),Mc(f)).addRecoveryBit(m)}const a=Fn(e)?e:Cc(e),o=Yb(`0x${a.slice(130)}`),c=Mu(o);return i.Signature.fromCompact(a.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function Mu(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function Cg({hash:t,signature:e}){return Og(await Mg({hash:t,signature:e}))}const Tg=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Rg=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function Li(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Rg(t)}catch{return t}}function Xr(t){return typeof t=="string"?t:Tg(t)||""}function Ng(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Fl(t,...e){if(!Ng(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Cu(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Fg(t,e){Fl(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const rs=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const zo=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Bg(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Bl(t){return typeof t=="string"&&(t=Bg(t)),Fl(t),t}let qg=class{clone(){return this._cloneInto()}};function Lg(t){const e=i=>t().update(Bl(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function ql(t=32){if(rs&&typeof rs.getRandomValues=="function")return rs.getRandomValues(new Uint8Array(t));if(rs&&typeof rs.randomBytes=="function")return rs.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function jg(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),a=Number(r>>s&n),o=Number(r&n),c=i?4:0,h=i?0:4;t.setUint32(e+c,a,i),t.setUint32(e+h,o,i)}let Ug=class extends qg{constructor(e,r,i,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=zo(this.buffer)}update(e){Cu(this);const{view:r,buffer:i,blockLen:s}=this;e=Bl(e);const n=e.length;for(let a=0;a<n;){const o=Math.min(s-this.pos,n-a);if(o===s){const c=zo(e);for(;s<=n-a;a+=s)this.process(c,a);continue}i.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Cu(this),Fg(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:a}=this;r[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(i,0),a=0);for(let l=a;l<s;l++)r[l]=0;jg(i,s-8,BigInt(this.length*8),n),this.process(i,0);const o=zo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=c/4,f=this.get();if(h>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<h;l++)o.setUint32(4*l,f[l],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:a,pos:o}=this;return e.length=s,e.pos=o,e.finished=n,e.destroyed=a,s%r&&e.buffer.set(i),e}};const ga=BigInt(2**32-1),Tc=BigInt(32);function Ll(t,e=!1){return e?{h:Number(t&ga),l:Number(t>>Tc&ga)}:{h:Number(t>>Tc&ga)|0,l:Number(t&ga)|0}}function zg(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:a}=Ll(t[s],e);[r[s],i[s]]=[n,a]}return[r,i]}const kg=(t,e)=>BigInt(t>>>0)<<Tc|BigInt(e>>>0),Hg=(t,e,r)=>t>>>r,Kg=(t,e,r)=>t<<32-r|e>>>r,Vg=(t,e,r)=>t>>>r|e<<32-r,Wg=(t,e,r)=>t<<32-r|e>>>r,Gg=(t,e,r)=>t<<64-r|e>>>r-32,Jg=(t,e,r)=>t>>>r-32|e<<64-r,Yg=(t,e)=>e,Xg=(t,e)=>t,Zg=(t,e,r)=>t<<r|e>>>32-r,Qg=(t,e,r)=>e<<r|t>>>32-r,ev=(t,e,r)=>e<<r-32|t>>>64-r,tv=(t,e,r)=>t<<r-32|e>>>64-r;function rv(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const iv=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),sv=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,nv=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),av=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,ov=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),cv=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,te={fromBig:Ll,split:zg,toBig:kg,shrSH:Hg,shrSL:Kg,rotrSH:Vg,rotrSL:Wg,rotrBH:Gg,rotrBL:Jg,rotr32H:Yg,rotr32L:Xg,rotlSH:Zg,rotlSL:Qg,rotlBH:ev,rotlBL:tv,add:rv,add3L:iv,add3H:sv,add4L:nv,add4H:av,add5H:cv,add5L:ov},[hv,uv]=te.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ni=new Uint32Array(80),ai=new Uint32Array(80);let fv=class extends Ug{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:a,Dh:o,Dl:c,Eh:h,El:f,Fh:l,Fl:v,Gh:_,Gl:m,Hh:$,Hl:O}=this;return[e,r,i,s,n,a,o,c,h,f,l,v,_,m,$,O]}set(e,r,i,s,n,a,o,c,h,f,l,v,_,m,$,O){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=a|0,this.Dh=o|0,this.Dl=c|0,this.Eh=h|0,this.El=f|0,this.Fh=l|0,this.Fl=v|0,this.Gh=_|0,this.Gl=m|0,this.Hh=$|0,this.Hl=O|0}process(e,r){for(let C=0;C<16;C++,r+=4)ni[C]=e.getUint32(r),ai[C]=e.getUint32(r+=4);for(let C=16;C<80;C++){const T=ni[C-15]|0,N=ai[C-15]|0,z=te.rotrSH(T,N,1)^te.rotrSH(T,N,8)^te.shrSH(T,N,7),H=te.rotrSL(T,N,1)^te.rotrSL(T,N,8)^te.shrSL(T,N,7),U=ni[C-2]|0,B=ai[C-2]|0,J=te.rotrSH(U,B,19)^te.rotrBH(U,B,61)^te.shrSH(U,B,6),S=te.rotrSL(U,B,19)^te.rotrBL(U,B,61)^te.shrSL(U,B,6),u=te.add4L(H,S,ai[C-7],ai[C-16]),b=te.add4H(u,z,J,ni[C-7],ni[C-16]);ni[C]=b|0,ai[C]=u|0}let{Ah:i,Al:s,Bh:n,Bl:a,Ch:o,Cl:c,Dh:h,Dl:f,Eh:l,El:v,Fh:_,Fl:m,Gh:$,Gl:O,Hh:D,Hl:P}=this;for(let C=0;C<80;C++){const T=te.rotrSH(l,v,14)^te.rotrSH(l,v,18)^te.rotrBH(l,v,41),N=te.rotrSL(l,v,14)^te.rotrSL(l,v,18)^te.rotrBL(l,v,41),z=l&_^~l&$,H=v&m^~v&O,U=te.add5L(P,N,H,uv[C],ai[C]),B=te.add5H(U,D,T,z,hv[C],ni[C]),J=U|0,S=te.rotrSH(i,s,28)^te.rotrBH(i,s,34)^te.rotrBH(i,s,39),u=te.rotrSL(i,s,28)^te.rotrBL(i,s,34)^te.rotrBL(i,s,39),b=i&n^i&o^n&o,w=s&a^s&c^a&c;D=$|0,P=O|0,$=_|0,O=m|0,_=l|0,m=v|0,{h:l,l:v}=te.add(h|0,f|0,B|0,J|0),h=o|0,f=c|0,o=n|0,c=a|0,n=i|0,a=s|0;const p=te.add3L(J,u,w);i=te.add3H(p,B,S,b),s=p|0}({h:i,l:s}=te.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:a}=te.add(this.Bh|0,this.Bl|0,n|0,a|0),{h:o,l:c}=te.add(this.Ch|0,this.Cl|0,o|0,c|0),{h,l:f}=te.add(this.Dh|0,this.Dl|0,h|0,f|0),{h:l,l:v}=te.add(this.Eh|0,this.El|0,l|0,v|0),{h:_,l:m}=te.add(this.Fh|0,this.Fl|0,_|0,m|0),{h:$,l:O}=te.add(this.Gh|0,this.Gl|0,$|0,O|0),{h:D,l:P}=te.add(this.Hh|0,this.Hl|0,D|0,P|0),this.set(i,s,n,a,o,c,h,f,l,v,_,m,$,O,D,P)}roundClean(){ni.fill(0),ai.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const dv=Lg(()=>new fv);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Eh=BigInt(0),jl=BigInt(1),lv=BigInt(2);function xh(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function $h(t){if(!xh(t))throw new Error("Uint8Array expected")}function ko(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const pv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Sh(t){$h(t);let e="";for(let r=0;r<t.length;r++)e+=pv[t[r]];return e}function Ul(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Eh:BigInt("0x"+t)}const zr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Tu(t){if(t>=zr._0&&t<=zr._9)return t-zr._0;if(t>=zr.A&&t<=zr.F)return t-(zr.A-10);if(t>=zr.a&&t<=zr.f)return t-(zr.a-10)}function zl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const a=Tu(t.charCodeAt(n)),o=Tu(t.charCodeAt(n+1));if(a===void 0||o===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=a*16+o}return i}function bv(t){return Ul(Sh(t))}function Ca(t){return $h(t),Ul(Sh(Uint8Array.from(t).reverse()))}function kl(t,e){return zl(t.toString(16).padStart(e*2,"0"))}function Rc(t,e){return kl(t,e).reverse()}function kr(t,e,r){let i;if(typeof e=="string")try{i=zl(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(xh(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function Ru(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];$h(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const Ho=t=>typeof t=="bigint"&&Eh<=t;function gv(t,e,r){return Ho(t)&&Ho(e)&&Ho(r)&&e<=t&&t<r}function mn(t,e,r,i){if(!gv(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function vv(t){let e;for(e=0;t>Eh;t>>=jl,e+=1);return e}const yv=t=>(lv<<BigInt(t-1))-jl,mv={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||xh(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ih(t,e,r={}){const i=(s,n,a)=>{const o=mv[n];if(typeof o!="function")throw new Error("invalid validator function");const c=t[s];if(!(a&&c===void 0)&&!o(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function Nu(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const ft=BigInt(0),rt=BigInt(1),Ci=BigInt(2),wv=BigInt(3),Nc=BigInt(4),Fu=BigInt(5),Bu=BigInt(8);function nt(t,e){const r=t%e;return r>=ft?r:e+r}function _v(t,e,r){if(e<ft)throw new Error("invalid exponent, negatives unsupported");if(r<=ft)throw new Error("invalid modulus");if(r===rt)return ft;let i=rt;for(;e>ft;)e&rt&&(i=i*t%r),t=t*t%r,e>>=rt;return i}function _r(t,e,r){let i=t;for(;e-- >ft;)i*=i,i%=r;return i}function qu(t,e){if(t===ft)throw new Error("invert: expected non-zero number");if(e<=ft)throw new Error("invert: expected positive modulus, got "+e);let r=nt(t,e),i=e,s=ft,n=rt;for(;r!==ft;){const a=i/r,o=i%r,c=s-n*a;i=r,r=o,s=n,n=c}if(i!==rt)throw new Error("invert: does not exist");return nt(s,e)}function Ev(t){const e=(t-rt)/Ci;let r,i,s;for(r=t-rt,i=0;r%Ci===ft;r/=Ci,i++);for(s=Ci;s<t&&_v(s,e,t)!==t-rt;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const a=(t+rt)/Nc;return function(o,c){const h=o.pow(c,a);if(!o.eql(o.sqr(h),c))throw new Error("Cannot find square root");return h}}const n=(r+rt)/Ci;return function(a,o){if(a.pow(o,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,h=a.pow(a.mul(a.ONE,s),r),f=a.pow(o,n),l=a.pow(o,r);for(;!a.eql(l,a.ONE);){if(a.eql(l,a.ZERO))return a.ZERO;let v=1;for(let m=a.sqr(l);v<c&&!a.eql(m,a.ONE);v++)m=a.sqr(m);const _=a.pow(h,rt<<BigInt(c-v-1));h=a.sqr(_),f=a.mul(f,_),l=a.mul(l,h),c=v}return f}}function xv(t){if(t%Nc===wv){const e=(t+rt)/Nc;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%Bu===Fu){const e=(t-Fu)/Bu;return function(r,i){const s=r.mul(i,Ci),n=r.pow(s,e),a=r.mul(i,n),o=r.mul(r.mul(a,Ci),n),c=r.mul(a,r.sub(o,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return Ev(t)}const $v=(t,e)=>(nt(t,e)&rt)===rt,Sv=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Iv(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Sv.reduce((i,s)=>(i[s]="function",i),e);return Ih(t,r)}function Av(t,e,r){if(r<ft)throw new Error("invalid exponent, negatives unsupported");if(r===ft)return t.ONE;if(r===rt)return e;let i=t.ONE,s=e;for(;r>ft;)r&rt&&(i=t.mul(i,s)),s=t.sqr(s),r>>=rt;return i}function Dv(t,e){const r=new Array(e.length),i=e.reduce((n,a,o)=>t.is0(a)?n:(r[o]=n,t.mul(n,a)),t.ONE),s=t.inv(i);return e.reduceRight((n,a,o)=>t.is0(a)?n:(r[o]=t.mul(n,r[o]),t.mul(n,a)),s),r}function Hl(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Kl(t,e,r=!1,i={}){if(t<=ft)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=Hl(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const o=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:yv(s),ZERO:ft,ONE:rt,create:c=>nt(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ft<=c&&c<t},is0:c=>c===ft,isOdd:c=>(c&rt)===rt,neg:c=>nt(-c,t),eql:(c,h)=>c===h,sqr:c=>nt(c*c,t),add:(c,h)=>nt(c+h,t),sub:(c,h)=>nt(c-h,t),mul:(c,h)=>nt(c*h,t),pow:(c,h)=>Av(o,c,h),div:(c,h)=>nt(c*qu(h,t),t),sqrN:c=>c*c,addN:(c,h)=>c+h,subN:(c,h)=>c-h,mulN:(c,h)=>c*h,inv:c=>qu(c,t),sqrt:i.sqrt||(c=>(a||(a=xv(t)),a(o,c))),invertBatch:c=>Dv(o,c),cmov:(c,h,f)=>f?h:c,toBytes:c=>r?Rc(c,n):kl(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?Ca(c):bv(c)}});return Object.freeze(o)}const Lu=BigInt(0),va=BigInt(1);function Ko(t,e){const r=e.negate();return t?r:e}function Vl(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Vo(t,e){Vl(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function Pv(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function Ov(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Wo=new WeakMap,Wl=new WeakMap;function Go(t){return Wl.get(t)||1}function Mv(t,e){return{constTimeNegate:Ko,hasPrecomputes(r){return Go(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>Lu;)i&va&&(s=s.add(n)),n=n.double(),i>>=va;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=Vo(i,e),a=[];let o=r,c=o;for(let h=0;h<s;h++){c=o,a.push(c);for(let f=1;f<n;f++)c=c.add(o),a.push(c);o=c.double()}return a},wNAF(r,i,s){const{windows:n,windowSize:a}=Vo(r,e);let o=t.ZERO,c=t.BASE;const h=BigInt(2**r-1),f=2**r,l=BigInt(r);for(let v=0;v<n;v++){const _=v*a;let m=Number(s&h);s>>=l,m>a&&(m-=f,s+=va);const $=_,O=_+Math.abs(m)-1,D=v%2!==0,P=m<0;m===0?c=c.add(Ko(D,i[$])):o=o.add(Ko(P,i[O]))}return{p:o,f:c}},wNAFUnsafe(r,i,s,n=t.ZERO){const{windows:a,windowSize:o}=Vo(r,e),c=BigInt(2**r-1),h=2**r,f=BigInt(r);for(let l=0;l<a;l++){const v=l*o;if(s===Lu)break;let _=Number(s&c);if(s>>=f,_>o&&(_-=h,s+=va),_===0)continue;let m=i[v+Math.abs(_)-1];_<0&&(m=m.negate()),n=n.add(m)}return n},getPrecomputes(r,i,s){let n=Wo.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&Wo.set(i,s(n))),n},wNAFCached(r,i,s){const n=Go(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const a=Go(r);return a===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(a,this.getPrecomputes(a,r,s),i,n)},setWindowSize(r,i){Vl(i,e),Wl.set(r,i),Wo.delete(r)}}}function Cv(t,e,r,i){if(Pv(r,t),Ov(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,n=vv(BigInt(r.length)),a=n>12?n-3:n>4?n-2:n?2:1,o=(1<<a)-1,c=new Array(o+1).fill(s),h=Math.floor((e.BITS-1)/a)*a;let f=s;for(let l=h;l>=0;l-=a){c.fill(s);for(let _=0;_<i.length;_++){const m=i[_],$=Number(m>>BigInt(l)&BigInt(o));c[$]=c[$].add(r[_])}let v=s;for(let _=c.length-1,m=s;_>0;_--)m=m.add(c[_]),v=v.add(m);if(f=f.add(v),l!==0)for(let _=0;_<a;_++)f=f.double()}return f}function Tv(t){return Iv(t.Fp),Ih(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Hl(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const ur=BigInt(0),Ct=BigInt(1),ya=BigInt(2),Rv=BigInt(8),Nv={zip215:!0};function Fv(t){const e=Tv(t);return Ih(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Bv(t){const e=Fv(t),{Fp:r,n:i,prehash:s,hash:n,randomBytes:a,nByteLength:o,h:c}=e,h=ya<<BigInt(o*8)-Ct,f=r.create,l=Kl(e.n,e.nBitLength),v=e.uvRatio||((p,g)=>{try{return{isValid:!0,value:r.sqrt(p*r.inv(g))}}catch{return{isValid:!1,value:ur}}}),_=e.adjustScalarBytes||(p=>p),m=e.domain||((p,g,E)=>{if(ko("phflag",E),g.length||E)throw new Error("Contexts/pre-hash are not supported");return p});function $(p,g){mn("coordinate "+p,g,ur,h)}function O(p){if(!(p instanceof C))throw new Error("ExtendedPoint expected")}const D=Nu((p,g)=>{const{ex:E,ey:I,ez:y}=p,d=p.is0();g==null&&(g=d?Rv:r.inv(y));const x=f(E*g),R=f(I*g),j=f(y*g);if(d)return{x:ur,y:Ct};if(j!==Ct)throw new Error("invZ was invalid");return{x,y:R}}),P=Nu(p=>{const{a:g,d:E}=e;if(p.is0())throw new Error("bad point: ZERO");const{ex:I,ey:y,ez:d,et:x}=p,R=f(I*I),j=f(y*y),F=f(d*d),q=f(F*F),G=f(R*g),X=f(F*f(G+j)),Q=f(q+f(E*f(R*j)));if(X!==Q)throw new Error("bad point: equation left != right (1)");const Y=f(I*y),ee=f(d*x);if(Y!==ee)throw new Error("bad point: equation left != right (2)");return!0});class C{constructor(g,E,I,y){this.ex=g,this.ey=E,this.ez=I,this.et=y,$("x",g),$("y",E),$("z",I),$("t",y),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(g){if(g instanceof C)throw new Error("extended point not allowed");const{x:E,y:I}=g||{};return $("x",E),$("y",I),new C(E,I,Ct,f(E*I))}static normalizeZ(g){const E=r.invertBatch(g.map(I=>I.ez));return g.map((I,y)=>I.toAffine(E[y])).map(C.fromAffine)}static msm(g,E){return Cv(C,l,g,E)}_setWindowSize(g){z.setWindowSize(this,g)}assertValidity(){P(this)}equals(g){O(g);const{ex:E,ey:I,ez:y}=this,{ex:d,ey:x,ez:R}=g,j=f(E*R),F=f(d*y),q=f(I*R),G=f(x*y);return j===F&&q===G}is0(){return this.equals(C.ZERO)}negate(){return new C(f(-this.ex),this.ey,this.ez,f(-this.et))}double(){const{a:g}=e,{ex:E,ey:I,ez:y}=this,d=f(E*E),x=f(I*I),R=f(ya*f(y*y)),j=f(g*d),F=E+I,q=f(f(F*F)-d-x),G=j+x,X=G-R,Q=j-x,Y=f(q*X),ee=f(G*Q),bt=f(q*Q),ae=f(X*G);return new C(Y,ee,ae,bt)}add(g){O(g);const{a:E,d:I}=e,{ex:y,ey:d,ez:x,et:R}=this,{ex:j,ey:F,ez:q,et:G}=g;if(E===BigInt(-1)){const xe=f((d-y)*(F+j)),mi=f((d+y)*(F-j)),ve=f(mi-xe);if(ve===ur)return this.double();const $e=f(x*ya*G),wi=f(R*ya*q),Se=wi+$e,Ie=mi+xe,_i=wi-$e,be=f(Se*ve),ye=f(Ie*_i),Ei=f(Se*_i),ne=f(ve*Ie);return new C(be,ye,ne,Ei)}const X=f(y*j),Q=f(d*F),Y=f(R*I*G),ee=f(x*q),bt=f((y+d)*(j+F)-X-Q),ae=ee-Y,de=ee+Y,Gt=f(Q-E*X),ge=f(bt*ae),Oe=f(de*Gt),Xi=f(bt*Gt),Me=f(ae*de);return new C(ge,Oe,Me,Xi)}subtract(g){return this.add(g.negate())}wNAF(g){return z.wNAFCached(this,g,C.normalizeZ)}multiply(g){const E=g;mn("scalar",E,Ct,i);const{p:I,f:y}=this.wNAF(E);return C.normalizeZ([I,y])[0]}multiplyUnsafe(g,E=C.ZERO){const I=g;return mn("scalar",I,ur,i),I===ur?N:this.is0()||I===Ct?this:z.wNAFCachedUnsafe(this,I,C.normalizeZ,E)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return z.unsafeLadder(this,i).is0()}toAffine(g){return D(this,g)}clearCofactor(){const{h:g}=e;return g===Ct?this:this.multiplyUnsafe(g)}static fromHex(g,E=!1){const{d:I,a:y}=e,d=r.BYTES;g=kr("pointHex",g,d),ko("zip215",E);const x=g.slice(),R=g[d-1];x[d-1]=R&-129;const j=Ca(x),F=E?h:r.ORDER;mn("pointHex.y",j,ur,F);const q=f(j*j),G=f(q-Ct),X=f(I*q-y);let{isValid:Q,value:Y}=v(G,X);if(!Q)throw new Error("Point.fromHex: invalid y coordinate");const ee=(Y&Ct)===Ct,bt=(R&128)!==0;if(!E&&Y===ur&&bt)throw new Error("Point.fromHex: x=0 and x_0=1");return bt!==ee&&(Y=f(-Y)),C.fromAffine({x:Y,y:j})}static fromPrivateKey(g){return B(g).point}toRawBytes(){const{x:g,y:E}=this.toAffine(),I=Rc(E,r.BYTES);return I[I.length-1]|=g&Ct?128:0,I}toHex(){return Sh(this.toRawBytes())}}C.BASE=new C(e.Gx,e.Gy,Ct,f(e.Gx*e.Gy)),C.ZERO=new C(ur,Ct,Ct,ur);const{BASE:T,ZERO:N}=C,z=Mv(C,o*8);function H(p){return nt(p,i)}function U(p){return H(Ca(p))}function B(p){const g=r.BYTES;p=kr("private key",p,g);const E=kr("hashed private key",n(p),2*g),I=_(E.slice(0,g)),y=E.slice(g,2*g),d=U(I),x=T.multiply(d),R=x.toRawBytes();return{head:I,prefix:y,scalar:d,point:x,pointBytes:R}}function J(p){return B(p).pointBytes}function S(p=new Uint8Array,...g){const E=Ru(...g);return U(n(m(E,kr("context",p),!!s)))}function u(p,g,E={}){p=kr("message",p),s&&(p=s(p));const{prefix:I,scalar:y,pointBytes:d}=B(g),x=S(E.context,I,p),R=T.multiply(x).toRawBytes(),j=S(E.context,R,d,p),F=H(x+j*y);mn("signature.s",F,ur,i);const q=Ru(R,Rc(F,r.BYTES));return kr("result",q,r.BYTES*2)}const b=Nv;function w(p,g,E,I=b){const{context:y,zip215:d}=I,x=r.BYTES;p=kr("signature",p,2*x),g=kr("message",g),E=kr("publicKey",E,x),d!==void 0&&ko("zip215",d),s&&(g=s(g));const R=Ca(p.slice(x,2*x));let j,F,q;try{j=C.fromHex(E,d),F=C.fromHex(p.slice(0,x),d),q=T.multiplyUnsafe(R)}catch{return!1}if(!d&&j.isSmallOrder())return!1;const G=S(y,F.toRawBytes(),j.toRawBytes(),g);return F.add(j.multiplyUnsafe(G)).subtract(q).clearCofactor().equals(C.ZERO)}return T._setWindowSize(8),{CURVE:e,getPublicKey:J,sign:u,verify:w,ExtendedPoint:C,utils:{getExtendedPublicKey:B,randomPrivateKey:()=>a(r.BYTES),precompute(p=8,g=C.BASE){return g._setWindowSize(p),g.multiply(BigInt(3)),g}}}}BigInt(0),BigInt(1);const Ah=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ju=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const qv=BigInt(1),Uu=BigInt(2);BigInt(3);const Lv=BigInt(5),jv=BigInt(8);function Uv(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=Ah,a=t*t%n*t%n,o=_r(a,Uu,n)*a%n,c=_r(o,qv,n)*t%n,h=_r(c,Lv,n)*c%n,f=_r(h,e,n)*h%n,l=_r(f,r,n)*f%n,v=_r(l,i,n)*l%n,_=_r(v,s,n)*v%n,m=_r(_,s,n)*v%n,$=_r(m,e,n)*h%n;return{pow_p_5_8:_r($,Uu,n)*t%n,b2:a}}function zv(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function kv(t,e){const r=Ah,i=nt(e*e*e,r),s=nt(i*i*e,r),n=Uv(t*s).pow_p_5_8;let a=nt(t*i*n,r);const o=nt(e*a*a,r),c=a,h=nt(a*ju,r),f=o===t,l=o===nt(-t,r),v=o===nt(-t*ju,r);return f&&(a=c),(l||v)&&(a=h),$v(a,r)&&(a=nt(-a,r)),{isValid:f||l,value:a}}const Hv=Kl(Ah,void 0,!0),Kv={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Hv,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:jv,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:dv,randomBytes:ql,adjustScalarBytes:zv,uvRatio:kv},Gl=Bv(Kv),Vv="EdDSA",Wv="JWT",ja=".",no="base64url",Jl="utf8",Yl="utf8",Gv=":",Jv="did",Yv="key",zu="base58btc",Xv="z",Zv="K36",Qv=32;function Dh(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Xl(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Dh(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Zl(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=Xl(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return Dh(r)}function ey(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),a=n.charCodeAt(0);if(r[a]!==255)throw new TypeError(n+" is ambiguous");r[a]=s}var o=t.length,c=t.charAt(0),h=Math.log(o)/Math.log(256),f=Math.log(256)/Math.log(o);function l(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var $=0,O=0,D=0,P=m.length;D!==P&&m[D]===0;)D++,$++;for(var C=(P-D)*f+1>>>0,T=new Uint8Array(C);D!==P;){for(var N=m[D],z=0,H=C-1;(N!==0||z<O)&&H!==-1;H--,z++)N+=256*T[H]>>>0,T[H]=N%o>>>0,N=N/o>>>0;if(N!==0)throw new Error("Non-zero carry");O=z,D++}for(var U=C-O;U!==C&&T[U]===0;)U++;for(var B=c.repeat($);U<C;++U)B+=t.charAt(T[U]);return B}function v(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var $=0;if(m[$]!==" "){for(var O=0,D=0;m[$]===c;)O++,$++;for(var P=(m.length-$)*h+1>>>0,C=new Uint8Array(P);m[$];){var T=r[m.charCodeAt($)];if(T===255)return;for(var N=0,z=P-1;(T!==0||N<D)&&z!==-1;z--,N++)T+=o*C[z]>>>0,C[z]=T%256>>>0,T=T/256>>>0;if(T!==0)throw new Error("Non-zero carry");D=N,$++}if(m[$]!==" "){for(var H=P-D;H!==P&&C[H]===0;)H++;for(var U=new Uint8Array(O+(P-H)),B=O;H!==P;)U[B++]=C[H++];return U}}}function _(m){var $=v(m);if($)return $;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:v,decode:_}}var ty=ey,ry=ty;const Ql=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},iy=t=>new TextEncoder().encode(t),sy=t=>new TextDecoder().decode(t);let ny=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ay=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ep(this,e)}},oy=class{constructor(e){this.decoders=e}or(e){return ep(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const ep=(t,e)=>new oy({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let cy=class{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new ny(e,r,i),this.decoder=new ay(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const ao=({name:t,prefix:e,encode:r,decode:i})=>new cy(t,e,r,i),Kn=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=ry(r,e);return ao({prefix:t,name:e,encode:i,decode:n=>Ql(s(n))})},hy=(t,e,r,i)=>{const s={};for(let f=0;f<e.length;++f)s[e[f]]=f;let n=t.length;for(;t[n-1]==="=";)--n;const a=new Uint8Array(n*r/8|0);let o=0,c=0,h=0;for(let f=0;f<n;++f){const l=s[t[f]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|l,o+=r,o>=8&&(o-=8,a[h++]=255&c>>o)}if(o>=r||255&c<<8-o)throw new SyntaxError("Unexpected end of data");return a},uy=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",a=0,o=0;for(let c=0;c<t.length;++c)for(o=o<<8|t[c],a+=8;a>r;)a-=r,n+=e[s&o>>a];if(a&&(n+=e[s&o<<r-a]),i)for(;n.length*r&7;)n+="=";return n},wt=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ao({prefix:e,name:t,encode(s){return uy(s,i,r)},decode(s){return hy(s,i,r,t)}}),fy=ao({prefix:"\0",name:"identity",encode:t=>sy(t),decode:t=>iy(t)});var dy=Object.freeze({__proto__:null,identity:fy});const ly=wt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var py=Object.freeze({__proto__:null,base2:ly});const by=wt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var gy=Object.freeze({__proto__:null,base8:by});const vy=Kn({prefix:"9",name:"base10",alphabet:"0123456789"});var yy=Object.freeze({__proto__:null,base10:vy});const my=wt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),wy=wt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var _y=Object.freeze({__proto__:null,base16:my,base16upper:wy});const Ey=wt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),xy=wt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$y=wt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sy=wt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Iy=wt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ay=wt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Dy=wt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Py=wt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Oy=wt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var My=Object.freeze({__proto__:null,base32:Ey,base32upper:xy,base32pad:$y,base32padupper:Sy,base32hex:Iy,base32hexupper:Ay,base32hexpad:Dy,base32hexpadupper:Py,base32z:Oy});const Cy=Kn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ty=Kn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ry=Object.freeze({__proto__:null,base36:Cy,base36upper:Ty});const Ny=Kn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Fy=Kn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var By=Object.freeze({__proto__:null,base58btc:Ny,base58flickr:Fy});const qy=wt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ly=wt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),jy=wt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Uy=wt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var zy=Object.freeze({__proto__:null,base64:qy,base64pad:Ly,base64url:jy,base64urlpad:Uy});const tp=Array.from(""),ky=tp.reduce((t,e,r)=>(t[r]=e,t),[]),Hy=tp.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Ky(t){return t.reduce((e,r)=>(e+=ky[r],e),"")}function Vy(t){const e=[];for(const r of t){const i=Hy[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Wy=ao({prefix:"",name:"base256emoji",encode:Ky,decode:Vy});var Gy=Object.freeze({__proto__:null,base256emoji:Wy}),Jy=rp,ku=128,Yy=-128,Xy=Math.pow(2,31);function rp(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Xy;)e[r++]=t&255|ku,t/=128;for(;t&Yy;)e[r++]=t&255|ku,t>>>=7;return e[r]=t|0,rp.bytes=r-i+1,e}var Zy=Fc,Qy=128,Hu=127;function Fc(t,i){var r=0,i=i||0,s=0,n=i,a,o=t.length;do{if(n>=o)throw Fc.bytes=0,new RangeError("Could not decode varint");a=t[n++],r+=s<28?(a&Hu)<<s:(a&Hu)*Math.pow(2,s),s+=7}while(a>=Qy);return Fc.bytes=n-i,r}var em=Math.pow(2,7),tm=Math.pow(2,14),rm=Math.pow(2,21),im=Math.pow(2,28),sm=Math.pow(2,35),nm=Math.pow(2,42),am=Math.pow(2,49),om=Math.pow(2,56),cm=Math.pow(2,63),hm=function(t){return t<em?1:t<tm?2:t<rm?3:t<im?4:t<sm?5:t<nm?6:t<am?7:t<om?8:t<cm?9:10},um={encode:Jy,decode:Zy,encodingLength:hm},ip=um;const Ku=(t,e,r=0)=>(ip.encode(t,e,r),e),Vu=t=>ip.encodingLength(t),Bc=(t,e)=>{const r=e.byteLength,i=Vu(t),s=i+Vu(r),n=new Uint8Array(s+r);return Ku(t,n,0),Ku(r,n,i),n.set(e,s),new fm(t,r,e,n)};let fm=class{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}};const sp=({name:t,code:e,encode:r})=>new dm(t,e,r);let dm=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Bc(this.code,r):r.then(i=>Bc(this.code,i))}else throw Error("Unknown type, must be binary type")}};const np=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),lm=sp({name:"sha2-256",code:18,encode:np("SHA-256")}),pm=sp({name:"sha2-512",code:19,encode:np("SHA-512")});var bm=Object.freeze({__proto__:null,sha256:lm,sha512:pm});const ap=0,gm="identity",op=Ql,vm=t=>Bc(ap,op(t)),ym={code:ap,name:gm,encode:op,digest:vm};var mm=Object.freeze({__proto__:null,identity:ym});new TextEncoder,new TextDecoder;const Wu={...dy,...py,...gy,...yy,..._y,...My,...Ry,...By,...zy,...Gy};({...bm,...mm});function cp(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Gu=cp("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Jo=cp("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Xl(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),hp={utf8:Gu,"utf-8":Gu,hex:Wu.base16,latin1:Jo,ascii:Jo,binary:Jo,...Wu};function oo(t,e="utf8"){const r=hp[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function js(t,e="utf8"){const r=hp[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Dh(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Ju(t){return Li(oo(js(t,no),Jl))}function Ua(t){return oo(js(Xr(t),Jl),no)}function up(t){const e=js(Zv,zu),r=Xv+oo(Zl([e,t]),zu);return[Jv,Yv,r].join(Gv)}function wm(t){return oo(t,no)}function _m(t){return js(t,no)}function Em(t){return js([Ua(t.header),Ua(t.payload)].join(ja),Yl)}function xm(t){return[Ua(t.header),Ua(t.payload),wm(t.signature)].join(ja)}function qc(t){const e=t.split(ja),r=Ju(e[0]),i=Ju(e[1]),s=_m(e[2]),n=js(e.slice(0,2).join(ja),Yl);return{header:r,payload:i,signature:s,data:n}}function Yu(t=ql(Qv)){const e=Gl.getPublicKey(t);return{secretKey:Zl([t,e]),publicKey:e}}async function $m(t,e,r,i,s=K.fromMiliseconds(Date.now())){const n={alg:Vv,typ:Wv},a=up(i.publicKey),o=s+r,c={iss:a,sub:t,aud:e,iat:s,exp:o},h=Em({header:n,payload:c}),f=Gl.sign(h,i.secretKey.slice(0,32));return xm({header:n,payload:c,signature:f})}function fp(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Yo(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=fp(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return r}function Sm(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),a=n.charCodeAt(0);if(r[a]!==255)throw new TypeError(n+" is ambiguous");r[a]=s}var o=t.length,c=t.charAt(0),h=Math.log(o)/Math.log(256),f=Math.log(256)/Math.log(o);function l(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var $=0,O=0,D=0,P=m.length;D!==P&&m[D]===0;)D++,$++;for(var C=(P-D)*f+1>>>0,T=new Uint8Array(C);D!==P;){for(var N=m[D],z=0,H=C-1;(N!==0||z<O)&&H!==-1;H--,z++)N+=256*T[H]>>>0,T[H]=N%o>>>0,N=N/o>>>0;if(N!==0)throw new Error("Non-zero carry");O=z,D++}for(var U=C-O;U!==C&&T[U]===0;)U++;for(var B=c.repeat($);U<C;++U)B+=t.charAt(T[U]);return B}function v(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var $=0;if(m[$]!==" "){for(var O=0,D=0;m[$]===c;)O++,$++;for(var P=(m.length-$)*h+1>>>0,C=new Uint8Array(P);m[$];){var T=r[m.charCodeAt($)];if(T===255)return;for(var N=0,z=P-1;(T!==0||N<D)&&z!==-1;z--,N++)T+=o*C[z]>>>0,C[z]=T%256>>>0,T=T/256>>>0;if(T!==0)throw new Error("Non-zero carry");D=N,$++}if(m[$]!==" "){for(var H=P-D;H!==P&&C[H]===0;)H++;for(var U=new Uint8Array(O+(P-H)),B=O;H!==P;)U[B++]=C[H++];return U}}}function _(m){var $=v(m);if($)return $;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:v,decode:_}}var Im=Sm,Am=Im;const Dm=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Pm=t=>new TextEncoder().encode(t),Om=t=>new TextDecoder().decode(t);class Mm{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Cm{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return dp(this,e)}}class Tm{constructor(e){this.decoders=e}or(e){return dp(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const dp=(t,e)=>new Tm({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Rm{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new Mm(e,r,i),this.decoder=new Cm(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const co=({name:t,prefix:e,encode:r,decode:i})=>new Rm(t,e,r,i),Vn=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Am(r,e);return co({prefix:t,name:e,encode:i,decode:n=>Dm(s(n))})},Nm=(t,e,r,i)=>{const s={};for(let f=0;f<e.length;++f)s[e[f]]=f;let n=t.length;for(;t[n-1]==="=";)--n;const a=new Uint8Array(n*r/8|0);let o=0,c=0,h=0;for(let f=0;f<n;++f){const l=s[t[f]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|l,o+=r,o>=8&&(o-=8,a[h++]=255&c>>o)}if(o>=r||255&c<<8-o)throw new SyntaxError("Unexpected end of data");return a},Fm=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",a=0,o=0;for(let c=0;c<t.length;++c)for(o=o<<8|t[c],a+=8;a>r;)a-=r,n+=e[s&o>>a];if(a&&(n+=e[s&o<<r-a]),i)for(;n.length*r&7;)n+="=";return n},_t=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>co({prefix:e,name:t,encode(s){return Fm(s,i,r)},decode(s){return Nm(s,i,r,t)}}),Bm=co({prefix:"\0",name:"identity",encode:t=>Om(t),decode:t=>Pm(t)}),qm=Object.freeze(Object.defineProperty({__proto__:null,identity:Bm},Symbol.toStringTag,{value:"Module"})),Lm=_t({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),jm=Object.freeze(Object.defineProperty({__proto__:null,base2:Lm},Symbol.toStringTag,{value:"Module"})),Um=_t({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),zm=Object.freeze(Object.defineProperty({__proto__:null,base8:Um},Symbol.toStringTag,{value:"Module"})),km=Vn({prefix:"9",name:"base10",alphabet:"0123456789"}),Hm=Object.freeze(Object.defineProperty({__proto__:null,base10:km},Symbol.toStringTag,{value:"Module"})),Km=_t({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Vm=_t({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Wm=Object.freeze(Object.defineProperty({__proto__:null,base16:Km,base16upper:Vm},Symbol.toStringTag,{value:"Module"})),Gm=_t({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Jm=_t({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ym=_t({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Xm=_t({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Zm=_t({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Qm=_t({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),e2=_t({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),t2=_t({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),r2=_t({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),i2=Object.freeze(Object.defineProperty({__proto__:null,base32:Gm,base32hex:Zm,base32hexpad:e2,base32hexpadupper:t2,base32hexupper:Qm,base32pad:Ym,base32padupper:Xm,base32upper:Jm,base32z:r2},Symbol.toStringTag,{value:"Module"})),s2=Vn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),n2=Vn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),a2=Object.freeze(Object.defineProperty({__proto__:null,base36:s2,base36upper:n2},Symbol.toStringTag,{value:"Module"})),o2=Vn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),c2=Vn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),h2=Object.freeze(Object.defineProperty({__proto__:null,base58btc:o2,base58flickr:c2},Symbol.toStringTag,{value:"Module"})),u2=_t({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),f2=_t({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),d2=_t({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),l2=_t({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),p2=Object.freeze(Object.defineProperty({__proto__:null,base64:u2,base64pad:f2,base64url:d2,base64urlpad:l2},Symbol.toStringTag,{value:"Module"})),lp=Array.from(""),b2=lp.reduce((t,e,r)=>(t[r]=e,t),[]),g2=lp.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function v2(t){return t.reduce((e,r)=>(e+=b2[r],e),"")}function y2(t){const e=[];for(const r of t){const i=g2[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const m2=co({prefix:"",name:"base256emoji",encode:v2,decode:y2}),w2=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:m2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Xu={...qm,...jm,...zm,...Hm,...Wm,...i2,...a2,...h2,...p2,...w2};function pp(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Zu=pp("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Xo=pp("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=fp(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),bp={utf8:Zu,"utf-8":Zu,hex:Xu.base16,latin1:Xo,ascii:Xo,binary:Xo,...Xu};function tr(t,e="utf8"){const r=bp[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function Ot(t,e="utf8"){const r=bp[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var gp={};const _2="6.6.1",E2={version:_2};var Wt={},Ph={exports:{}};Ph.exports;(function(t){(function(e,r){function i(S,u){if(!S)throw new Error(u||"Assertion failed")}function s(S,u){S.super_=u;var b=function(){};b.prototype=u.prototype,S.prototype=new b,S.prototype.constructor=S}function n(S,u,b){if(n.isBN(S))return S;this.negative=0,this.words=null,this.length=0,this.red=null,S!==null&&((u==="le"||u==="be")&&(b=u,u=10),this._init(S||0,u||10,b||"be"))}typeof e=="object"?e.exports=n:r.BN=n,n.BN=n,n.wordSize=26;var a;try{typeof window<"u"&&typeof window.Buffer<"u"?a=window.Buffer:a=ml.Buffer}catch{}n.isBN=function(u){return u instanceof n?!0:u!==null&&typeof u=="object"&&u.constructor.wordSize===n.wordSize&&Array.isArray(u.words)},n.max=function(u,b){return u.cmp(b)>0?u:b},n.min=function(u,b){return u.cmp(b)<0?u:b},n.prototype._init=function(u,b,w){if(typeof u=="number")return this._initNumber(u,b,w);if(typeof u=="object")return this._initArray(u,b,w);b==="hex"&&(b=16),i(b===(b|0)&&b>=2&&b<=36),u=u.toString().replace(/\s+/g,"");var p=0;u[0]==="-"&&(p++,this.negative=1),p<u.length&&(b===16?this._parseHex(u,p,w):(this._parseBase(u,b,p),w==="le"&&this._initArray(this.toArray(),b,w)))},n.prototype._initNumber=function(u,b,w){u<0&&(this.negative=1,u=-u),u<67108864?(this.words=[u&67108863],this.length=1):u<4503599627370496?(this.words=[u&67108863,u/67108864&67108863],this.length=2):(i(u<9007199254740992),this.words=[u&67108863,u/67108864&67108863,1],this.length=3),w==="le"&&this._initArray(this.toArray(),b,w)},n.prototype._initArray=function(u,b,w){if(i(typeof u.length=="number"),u.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(u.length/3),this.words=new Array(this.length);for(var p=0;p<this.length;p++)this.words[p]=0;var g,E,I=0;if(w==="be")for(p=u.length-1,g=0;p>=0;p-=3)E=u[p]|u[p-1]<<8|u[p-2]<<16,this.words[g]|=E<<I&67108863,this.words[g+1]=E>>>26-I&67108863,I+=24,I>=26&&(I-=26,g++);else if(w==="le")for(p=0,g=0;p<u.length;p+=3)E=u[p]|u[p+1]<<8|u[p+2]<<16,this.words[g]|=E<<I&67108863,this.words[g+1]=E>>>26-I&67108863,I+=24,I>=26&&(I-=26,g++);return this.strip()};function o(S,u){var b=S.charCodeAt(u);return b>=65&&b<=70?b-55:b>=97&&b<=102?b-87:b-48&15}function c(S,u,b){var w=o(S,b);return b-1>=u&&(w|=o(S,b-1)<<4),w}n.prototype._parseHex=function(u,b,w){this.length=Math.ceil((u.length-b)/6),this.words=new Array(this.length);for(var p=0;p<this.length;p++)this.words[p]=0;var g=0,E=0,I;if(w==="be")for(p=u.length-1;p>=b;p-=2)I=c(u,b,p)<<g,this.words[E]|=I&67108863,g>=18?(g-=18,E+=1,this.words[E]|=I>>>26):g+=8;else{var y=u.length-b;for(p=y%2===0?b+1:b;p<u.length;p+=2)I=c(u,b,p)<<g,this.words[E]|=I&67108863,g>=18?(g-=18,E+=1,this.words[E]|=I>>>26):g+=8}this.strip()};function h(S,u,b,w){for(var p=0,g=Math.min(S.length,b),E=u;E<g;E++){var I=S.charCodeAt(E)-48;p*=w,I>=49?p+=I-49+10:I>=17?p+=I-17+10:p+=I}return p}n.prototype._parseBase=function(u,b,w){this.words=[0],this.length=1;for(var p=0,g=1;g<=67108863;g*=b)p++;p--,g=g/b|0;for(var E=u.length-w,I=E%p,y=Math.min(E,E-I)+w,d=0,x=w;x<y;x+=p)d=h(u,x,x+p,b),this.imuln(g),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d);if(I!==0){var R=1;for(d=h(u,x,u.length,b),x=0;x<I;x++)R*=b;this.imuln(R),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d)}this.strip()},n.prototype.copy=function(u){u.words=new Array(this.length);for(var b=0;b<this.length;b++)u.words[b]=this.words[b];u.length=this.length,u.negative=this.negative,u.red=this.red},n.prototype.clone=function(){var u=new n(null);return this.copy(u),u},n.prototype._expand=function(u){for(;this.length<u;)this.words[this.length++]=0;return this},n.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},n.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},n.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var f=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],v=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];n.prototype.toString=function(u,b){u=u||10,b=b|0||1;var w;if(u===16||u==="hex"){w="";for(var p=0,g=0,E=0;E<this.length;E++){var I=this.words[E],y=((I<<p|g)&16777215).toString(16);g=I>>>24-p&16777215,p+=2,p>=26&&(p-=26,E--),g!==0||E!==this.length-1?w=f[6-y.length]+y+w:w=y+w}for(g!==0&&(w=g.toString(16)+w);w.length%b!==0;)w="0"+w;return this.negative!==0&&(w="-"+w),w}if(u===(u|0)&&u>=2&&u<=36){var d=l[u],x=v[u];w="";var R=this.clone();for(R.negative=0;!R.isZero();){var j=R.modn(x).toString(u);R=R.idivn(x),R.isZero()?w=j+w:w=f[d-j.length]+j+w}for(this.isZero()&&(w="0"+w);w.length%b!==0;)w="0"+w;return this.negative!==0&&(w="-"+w),w}i(!1,"Base should be between 2 and 36")},n.prototype.toNumber=function(){var u=this.words[0];return this.length===2?u+=this.words[1]*67108864:this.length===3&&this.words[2]===1?u+=4503599627370496+this.words[1]*67108864:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-u:u},n.prototype.toJSON=function(){return this.toString(16)},n.prototype.toBuffer=function(u,b){return i(typeof a<"u"),this.toArrayLike(a,u,b)},n.prototype.toArray=function(u,b){return this.toArrayLike(Array,u,b)},n.prototype.toArrayLike=function(u,b,w){var p=this.byteLength(),g=w||Math.max(1,p);i(p<=g,"byte array longer than desired length"),i(g>0,"Requested array length <= 0"),this.strip();var E=b==="le",I=new u(g),y,d,x=this.clone();if(E){for(d=0;!x.isZero();d++)y=x.andln(255),x.iushrn(8),I[d]=y;for(;d<g;d++)I[d]=0}else{for(d=0;d<g-p;d++)I[d]=0;for(d=0;!x.isZero();d++)y=x.andln(255),x.iushrn(8),I[g-d-1]=y}return I},Math.clz32?n.prototype._countBits=function(u){return 32-Math.clz32(u)}:n.prototype._countBits=function(u){var b=u,w=0;return b>=4096&&(w+=13,b>>>=13),b>=64&&(w+=7,b>>>=7),b>=8&&(w+=4,b>>>=4),b>=2&&(w+=2,b>>>=2),w+b},n.prototype._zeroBits=function(u){if(u===0)return 26;var b=u,w=0;return b&8191||(w+=13,b>>>=13),b&127||(w+=7,b>>>=7),b&15||(w+=4,b>>>=4),b&3||(w+=2,b>>>=2),b&1||w++,w},n.prototype.bitLength=function(){var u=this.words[this.length-1],b=this._countBits(u);return(this.length-1)*26+b};function _(S){for(var u=new Array(S.bitLength()),b=0;b<u.length;b++){var w=b/26|0,p=b%26;u[b]=(S.words[w]&1<<p)>>>p}return u}n.prototype.zeroBits=function(){if(this.isZero())return 0;for(var u=0,b=0;b<this.length;b++){var w=this._zeroBits(this.words[b]);if(u+=w,w!==26)break}return u},n.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},n.prototype.toTwos=function(u){return this.negative!==0?this.abs().inotn(u).iaddn(1):this.clone()},n.prototype.fromTwos=function(u){return this.testn(u-1)?this.notn(u).iaddn(1).ineg():this.clone()},n.prototype.isNeg=function(){return this.negative!==0},n.prototype.neg=function(){return this.clone().ineg()},n.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},n.prototype.iuor=function(u){for(;this.length<u.length;)this.words[this.length++]=0;for(var b=0;b<u.length;b++)this.words[b]=this.words[b]|u.words[b];return this.strip()},n.prototype.ior=function(u){return i((this.negative|u.negative)===0),this.iuor(u)},n.prototype.or=function(u){return this.length>u.length?this.clone().ior(u):u.clone().ior(this)},n.prototype.uor=function(u){return this.length>u.length?this.clone().iuor(u):u.clone().iuor(this)},n.prototype.iuand=function(u){var b;this.length>u.length?b=u:b=this;for(var w=0;w<b.length;w++)this.words[w]=this.words[w]&u.words[w];return this.length=b.length,this.strip()},n.prototype.iand=function(u){return i((this.negative|u.negative)===0),this.iuand(u)},n.prototype.and=function(u){return this.length>u.length?this.clone().iand(u):u.clone().iand(this)},n.prototype.uand=function(u){return this.length>u.length?this.clone().iuand(u):u.clone().iuand(this)},n.prototype.iuxor=function(u){var b,w;this.length>u.length?(b=this,w=u):(b=u,w=this);for(var p=0;p<w.length;p++)this.words[p]=b.words[p]^w.words[p];if(this!==b)for(;p<b.length;p++)this.words[p]=b.words[p];return this.length=b.length,this.strip()},n.prototype.ixor=function(u){return i((this.negative|u.negative)===0),this.iuxor(u)},n.prototype.xor=function(u){return this.length>u.length?this.clone().ixor(u):u.clone().ixor(this)},n.prototype.uxor=function(u){return this.length>u.length?this.clone().iuxor(u):u.clone().iuxor(this)},n.prototype.inotn=function(u){i(typeof u=="number"&&u>=0);var b=Math.ceil(u/26)|0,w=u%26;this._expand(b),w>0&&b--;for(var p=0;p<b;p++)this.words[p]=~this.words[p]&67108863;return w>0&&(this.words[p]=~this.words[p]&67108863>>26-w),this.strip()},n.prototype.notn=function(u){return this.clone().inotn(u)},n.prototype.setn=function(u,b){i(typeof u=="number"&&u>=0);var w=u/26|0,p=u%26;return this._expand(w+1),b?this.words[w]=this.words[w]|1<<p:this.words[w]=this.words[w]&~(1<<p),this.strip()},n.prototype.iadd=function(u){var b;if(this.negative!==0&&u.negative===0)return this.negative=0,b=this.isub(u),this.negative^=1,this._normSign();if(this.negative===0&&u.negative!==0)return u.negative=0,b=this.isub(u),u.negative=1,b._normSign();var w,p;this.length>u.length?(w=this,p=u):(w=u,p=this);for(var g=0,E=0;E<p.length;E++)b=(w.words[E]|0)+(p.words[E]|0)+g,this.words[E]=b&67108863,g=b>>>26;for(;g!==0&&E<w.length;E++)b=(w.words[E]|0)+g,this.words[E]=b&67108863,g=b>>>26;if(this.length=w.length,g!==0)this.words[this.length]=g,this.length++;else if(w!==this)for(;E<w.length;E++)this.words[E]=w.words[E];return this},n.prototype.add=function(u){var b;return u.negative!==0&&this.negative===0?(u.negative=0,b=this.sub(u),u.negative^=1,b):u.negative===0&&this.negative!==0?(this.negative=0,b=u.sub(this),this.negative=1,b):this.length>u.length?this.clone().iadd(u):u.clone().iadd(this)},n.prototype.isub=function(u){if(u.negative!==0){u.negative=0;var b=this.iadd(u);return u.negative=1,b._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(u),this.negative=1,this._normSign();var w=this.cmp(u);if(w===0)return this.negative=0,this.length=1,this.words[0]=0,this;var p,g;w>0?(p=this,g=u):(p=u,g=this);for(var E=0,I=0;I<g.length;I++)b=(p.words[I]|0)-(g.words[I]|0)+E,E=b>>26,this.words[I]=b&67108863;for(;E!==0&&I<p.length;I++)b=(p.words[I]|0)+E,E=b>>26,this.words[I]=b&67108863;if(E===0&&I<p.length&&p!==this)for(;I<p.length;I++)this.words[I]=p.words[I];return this.length=Math.max(this.length,I),p!==this&&(this.negative=1),this.strip()},n.prototype.sub=function(u){return this.clone().isub(u)};function m(S,u,b){b.negative=u.negative^S.negative;var w=S.length+u.length|0;b.length=w,w=w-1|0;var p=S.words[0]|0,g=u.words[0]|0,E=p*g,I=E&67108863,y=E/67108864|0;b.words[0]=I;for(var d=1;d<w;d++){for(var x=y>>>26,R=y&67108863,j=Math.min(d,u.length-1),F=Math.max(0,d-S.length+1);F<=j;F++){var q=d-F|0;p=S.words[q]|0,g=u.words[F]|0,E=p*g+R,x+=E/67108864|0,R=E&67108863}b.words[d]=R|0,y=x|0}return y!==0?b.words[d]=y|0:b.length--,b.strip()}var $=function(u,b,w){var p=u.words,g=b.words,E=w.words,I=0,y,d,x,R=p[0]|0,j=R&8191,F=R>>>13,q=p[1]|0,G=q&8191,X=q>>>13,Q=p[2]|0,Y=Q&8191,ee=Q>>>13,bt=p[3]|0,ae=bt&8191,de=bt>>>13,Gt=p[4]|0,ge=Gt&8191,Oe=Gt>>>13,Xi=p[5]|0,Me=Xi&8191,xe=Xi>>>13,mi=p[6]|0,ve=mi&8191,$e=mi>>>13,wi=p[7]|0,Se=wi&8191,Ie=wi>>>13,_i=p[8]|0,be=_i&8191,ye=_i>>>13,Ei=p[9]|0,ne=Ei&8191,Fe=Ei>>>13,Ys=g[0]|0,He=Ys&8191,Be=Ys>>>13,xi=g[1]|0,qe=xi&8191,Le=xi>>>13,na=g[2]|0,le=na&8191,je=na>>>13,aa=g[3]|0,Ke=aa&8191,Ce=aa>>>13,ti=g[4]|0,Te=ti&8191,Re=ti>>>13,Zi=g[5]|0,me=Zi&8191,Ve=Zi>>>13,oa=g[6]|0,We=oa&8191,Ge=oa>>>13,ca=g[7]|0,Ue=ca&8191,Ne=ca>>>13,wr=g[8]|0,Je=wr&8191,Ye=wr>>>13,ha=g[9]|0,Xe=ha&8191,Ze=ha>>>13;w.negative=u.negative^b.negative,w.length=19,y=Math.imul(j,He),d=Math.imul(j,Be),d=d+Math.imul(F,He)|0,x=Math.imul(F,Be);var jt=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(jt>>>26)|0,jt&=67108863,y=Math.imul(G,He),d=Math.imul(G,Be),d=d+Math.imul(X,He)|0,x=Math.imul(X,Be),y=y+Math.imul(j,qe)|0,d=d+Math.imul(j,Le)|0,d=d+Math.imul(F,qe)|0,x=x+Math.imul(F,Le)|0;var Xs=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(Xs>>>26)|0,Xs&=67108863,y=Math.imul(Y,He),d=Math.imul(Y,Be),d=d+Math.imul(ee,He)|0,x=Math.imul(ee,Be),y=y+Math.imul(G,qe)|0,d=d+Math.imul(G,Le)|0,d=d+Math.imul(X,qe)|0,x=x+Math.imul(X,Le)|0,y=y+Math.imul(j,le)|0,d=d+Math.imul(j,je)|0,d=d+Math.imul(F,le)|0,x=x+Math.imul(F,je)|0;var Zs=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(Zs>>>26)|0,Zs&=67108863,y=Math.imul(ae,He),d=Math.imul(ae,Be),d=d+Math.imul(de,He)|0,x=Math.imul(de,Be),y=y+Math.imul(Y,qe)|0,d=d+Math.imul(Y,Le)|0,d=d+Math.imul(ee,qe)|0,x=x+Math.imul(ee,Le)|0,y=y+Math.imul(G,le)|0,d=d+Math.imul(G,je)|0,d=d+Math.imul(X,le)|0,x=x+Math.imul(X,je)|0,y=y+Math.imul(j,Ke)|0,d=d+Math.imul(j,Ce)|0,d=d+Math.imul(F,Ke)|0,x=x+Math.imul(F,Ce)|0;var Qs=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(Qs>>>26)|0,Qs&=67108863,y=Math.imul(ge,He),d=Math.imul(ge,Be),d=d+Math.imul(Oe,He)|0,x=Math.imul(Oe,Be),y=y+Math.imul(ae,qe)|0,d=d+Math.imul(ae,Le)|0,d=d+Math.imul(de,qe)|0,x=x+Math.imul(de,Le)|0,y=y+Math.imul(Y,le)|0,d=d+Math.imul(Y,je)|0,d=d+Math.imul(ee,le)|0,x=x+Math.imul(ee,je)|0,y=y+Math.imul(G,Ke)|0,d=d+Math.imul(G,Ce)|0,d=d+Math.imul(X,Ke)|0,x=x+Math.imul(X,Ce)|0,y=y+Math.imul(j,Te)|0,d=d+Math.imul(j,Re)|0,d=d+Math.imul(F,Te)|0,x=x+Math.imul(F,Re)|0;var en=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(en>>>26)|0,en&=67108863,y=Math.imul(Me,He),d=Math.imul(Me,Be),d=d+Math.imul(xe,He)|0,x=Math.imul(xe,Be),y=y+Math.imul(ge,qe)|0,d=d+Math.imul(ge,Le)|0,d=d+Math.imul(Oe,qe)|0,x=x+Math.imul(Oe,Le)|0,y=y+Math.imul(ae,le)|0,d=d+Math.imul(ae,je)|0,d=d+Math.imul(de,le)|0,x=x+Math.imul(de,je)|0,y=y+Math.imul(Y,Ke)|0,d=d+Math.imul(Y,Ce)|0,d=d+Math.imul(ee,Ke)|0,x=x+Math.imul(ee,Ce)|0,y=y+Math.imul(G,Te)|0,d=d+Math.imul(G,Re)|0,d=d+Math.imul(X,Te)|0,x=x+Math.imul(X,Re)|0,y=y+Math.imul(j,me)|0,d=d+Math.imul(j,Ve)|0,d=d+Math.imul(F,me)|0,x=x+Math.imul(F,Ve)|0;var tn=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(tn>>>26)|0,tn&=67108863,y=Math.imul(ve,He),d=Math.imul(ve,Be),d=d+Math.imul($e,He)|0,x=Math.imul($e,Be),y=y+Math.imul(Me,qe)|0,d=d+Math.imul(Me,Le)|0,d=d+Math.imul(xe,qe)|0,x=x+Math.imul(xe,Le)|0,y=y+Math.imul(ge,le)|0,d=d+Math.imul(ge,je)|0,d=d+Math.imul(Oe,le)|0,x=x+Math.imul(Oe,je)|0,y=y+Math.imul(ae,Ke)|0,d=d+Math.imul(ae,Ce)|0,d=d+Math.imul(de,Ke)|0,x=x+Math.imul(de,Ce)|0,y=y+Math.imul(Y,Te)|0,d=d+Math.imul(Y,Re)|0,d=d+Math.imul(ee,Te)|0,x=x+Math.imul(ee,Re)|0,y=y+Math.imul(G,me)|0,d=d+Math.imul(G,Ve)|0,d=d+Math.imul(X,me)|0,x=x+Math.imul(X,Ve)|0,y=y+Math.imul(j,We)|0,d=d+Math.imul(j,Ge)|0,d=d+Math.imul(F,We)|0,x=x+Math.imul(F,Ge)|0;var cr=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(cr>>>26)|0,cr&=67108863,y=Math.imul(Se,He),d=Math.imul(Se,Be),d=d+Math.imul(Ie,He)|0,x=Math.imul(Ie,Be),y=y+Math.imul(ve,qe)|0,d=d+Math.imul(ve,Le)|0,d=d+Math.imul($e,qe)|0,x=x+Math.imul($e,Le)|0,y=y+Math.imul(Me,le)|0,d=d+Math.imul(Me,je)|0,d=d+Math.imul(xe,le)|0,x=x+Math.imul(xe,je)|0,y=y+Math.imul(ge,Ke)|0,d=d+Math.imul(ge,Ce)|0,d=d+Math.imul(Oe,Ke)|0,x=x+Math.imul(Oe,Ce)|0,y=y+Math.imul(ae,Te)|0,d=d+Math.imul(ae,Re)|0,d=d+Math.imul(de,Te)|0,x=x+Math.imul(de,Re)|0,y=y+Math.imul(Y,me)|0,d=d+Math.imul(Y,Ve)|0,d=d+Math.imul(ee,me)|0,x=x+Math.imul(ee,Ve)|0,y=y+Math.imul(G,We)|0,d=d+Math.imul(G,Ge)|0,d=d+Math.imul(X,We)|0,x=x+Math.imul(X,Ge)|0,y=y+Math.imul(j,Ue)|0,d=d+Math.imul(j,Ne)|0,d=d+Math.imul(F,Ue)|0,x=x+Math.imul(F,Ne)|0;var rn=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(rn>>>26)|0,rn&=67108863,y=Math.imul(be,He),d=Math.imul(be,Be),d=d+Math.imul(ye,He)|0,x=Math.imul(ye,Be),y=y+Math.imul(Se,qe)|0,d=d+Math.imul(Se,Le)|0,d=d+Math.imul(Ie,qe)|0,x=x+Math.imul(Ie,Le)|0,y=y+Math.imul(ve,le)|0,d=d+Math.imul(ve,je)|0,d=d+Math.imul($e,le)|0,x=x+Math.imul($e,je)|0,y=y+Math.imul(Me,Ke)|0,d=d+Math.imul(Me,Ce)|0,d=d+Math.imul(xe,Ke)|0,x=x+Math.imul(xe,Ce)|0,y=y+Math.imul(ge,Te)|0,d=d+Math.imul(ge,Re)|0,d=d+Math.imul(Oe,Te)|0,x=x+Math.imul(Oe,Re)|0,y=y+Math.imul(ae,me)|0,d=d+Math.imul(ae,Ve)|0,d=d+Math.imul(de,me)|0,x=x+Math.imul(de,Ve)|0,y=y+Math.imul(Y,We)|0,d=d+Math.imul(Y,Ge)|0,d=d+Math.imul(ee,We)|0,x=x+Math.imul(ee,Ge)|0,y=y+Math.imul(G,Ue)|0,d=d+Math.imul(G,Ne)|0,d=d+Math.imul(X,Ue)|0,x=x+Math.imul(X,Ne)|0,y=y+Math.imul(j,Je)|0,d=d+Math.imul(j,Ye)|0,d=d+Math.imul(F,Je)|0,x=x+Math.imul(F,Ye)|0;var sn=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(sn>>>26)|0,sn&=67108863,y=Math.imul(ne,He),d=Math.imul(ne,Be),d=d+Math.imul(Fe,He)|0,x=Math.imul(Fe,Be),y=y+Math.imul(be,qe)|0,d=d+Math.imul(be,Le)|0,d=d+Math.imul(ye,qe)|0,x=x+Math.imul(ye,Le)|0,y=y+Math.imul(Se,le)|0,d=d+Math.imul(Se,je)|0,d=d+Math.imul(Ie,le)|0,x=x+Math.imul(Ie,je)|0,y=y+Math.imul(ve,Ke)|0,d=d+Math.imul(ve,Ce)|0,d=d+Math.imul($e,Ke)|0,x=x+Math.imul($e,Ce)|0,y=y+Math.imul(Me,Te)|0,d=d+Math.imul(Me,Re)|0,d=d+Math.imul(xe,Te)|0,x=x+Math.imul(xe,Re)|0,y=y+Math.imul(ge,me)|0,d=d+Math.imul(ge,Ve)|0,d=d+Math.imul(Oe,me)|0,x=x+Math.imul(Oe,Ve)|0,y=y+Math.imul(ae,We)|0,d=d+Math.imul(ae,Ge)|0,d=d+Math.imul(de,We)|0,x=x+Math.imul(de,Ge)|0,y=y+Math.imul(Y,Ue)|0,d=d+Math.imul(Y,Ne)|0,d=d+Math.imul(ee,Ue)|0,x=x+Math.imul(ee,Ne)|0,y=y+Math.imul(G,Je)|0,d=d+Math.imul(G,Ye)|0,d=d+Math.imul(X,Je)|0,x=x+Math.imul(X,Ye)|0,y=y+Math.imul(j,Xe)|0,d=d+Math.imul(j,Ze)|0,d=d+Math.imul(F,Xe)|0,x=x+Math.imul(F,Ze)|0;var nn=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(nn>>>26)|0,nn&=67108863,y=Math.imul(ne,qe),d=Math.imul(ne,Le),d=d+Math.imul(Fe,qe)|0,x=Math.imul(Fe,Le),y=y+Math.imul(be,le)|0,d=d+Math.imul(be,je)|0,d=d+Math.imul(ye,le)|0,x=x+Math.imul(ye,je)|0,y=y+Math.imul(Se,Ke)|0,d=d+Math.imul(Se,Ce)|0,d=d+Math.imul(Ie,Ke)|0,x=x+Math.imul(Ie,Ce)|0,y=y+Math.imul(ve,Te)|0,d=d+Math.imul(ve,Re)|0,d=d+Math.imul($e,Te)|0,x=x+Math.imul($e,Re)|0,y=y+Math.imul(Me,me)|0,d=d+Math.imul(Me,Ve)|0,d=d+Math.imul(xe,me)|0,x=x+Math.imul(xe,Ve)|0,y=y+Math.imul(ge,We)|0,d=d+Math.imul(ge,Ge)|0,d=d+Math.imul(Oe,We)|0,x=x+Math.imul(Oe,Ge)|0,y=y+Math.imul(ae,Ue)|0,d=d+Math.imul(ae,Ne)|0,d=d+Math.imul(de,Ue)|0,x=x+Math.imul(de,Ne)|0,y=y+Math.imul(Y,Je)|0,d=d+Math.imul(Y,Ye)|0,d=d+Math.imul(ee,Je)|0,x=x+Math.imul(ee,Ye)|0,y=y+Math.imul(G,Xe)|0,d=d+Math.imul(G,Ze)|0,d=d+Math.imul(X,Xe)|0,x=x+Math.imul(X,Ze)|0;var an=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(an>>>26)|0,an&=67108863,y=Math.imul(ne,le),d=Math.imul(ne,je),d=d+Math.imul(Fe,le)|0,x=Math.imul(Fe,je),y=y+Math.imul(be,Ke)|0,d=d+Math.imul(be,Ce)|0,d=d+Math.imul(ye,Ke)|0,x=x+Math.imul(ye,Ce)|0,y=y+Math.imul(Se,Te)|0,d=d+Math.imul(Se,Re)|0,d=d+Math.imul(Ie,Te)|0,x=x+Math.imul(Ie,Re)|0,y=y+Math.imul(ve,me)|0,d=d+Math.imul(ve,Ve)|0,d=d+Math.imul($e,me)|0,x=x+Math.imul($e,Ve)|0,y=y+Math.imul(Me,We)|0,d=d+Math.imul(Me,Ge)|0,d=d+Math.imul(xe,We)|0,x=x+Math.imul(xe,Ge)|0,y=y+Math.imul(ge,Ue)|0,d=d+Math.imul(ge,Ne)|0,d=d+Math.imul(Oe,Ue)|0,x=x+Math.imul(Oe,Ne)|0,y=y+Math.imul(ae,Je)|0,d=d+Math.imul(ae,Ye)|0,d=d+Math.imul(de,Je)|0,x=x+Math.imul(de,Ye)|0,y=y+Math.imul(Y,Xe)|0,d=d+Math.imul(Y,Ze)|0,d=d+Math.imul(ee,Xe)|0,x=x+Math.imul(ee,Ze)|0;var on=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(on>>>26)|0,on&=67108863,y=Math.imul(ne,Ke),d=Math.imul(ne,Ce),d=d+Math.imul(Fe,Ke)|0,x=Math.imul(Fe,Ce),y=y+Math.imul(be,Te)|0,d=d+Math.imul(be,Re)|0,d=d+Math.imul(ye,Te)|0,x=x+Math.imul(ye,Re)|0,y=y+Math.imul(Se,me)|0,d=d+Math.imul(Se,Ve)|0,d=d+Math.imul(Ie,me)|0,x=x+Math.imul(Ie,Ve)|0,y=y+Math.imul(ve,We)|0,d=d+Math.imul(ve,Ge)|0,d=d+Math.imul($e,We)|0,x=x+Math.imul($e,Ge)|0,y=y+Math.imul(Me,Ue)|0,d=d+Math.imul(Me,Ne)|0,d=d+Math.imul(xe,Ue)|0,x=x+Math.imul(xe,Ne)|0,y=y+Math.imul(ge,Je)|0,d=d+Math.imul(ge,Ye)|0,d=d+Math.imul(Oe,Je)|0,x=x+Math.imul(Oe,Ye)|0,y=y+Math.imul(ae,Xe)|0,d=d+Math.imul(ae,Ze)|0,d=d+Math.imul(de,Xe)|0,x=x+Math.imul(de,Ze)|0;var ri=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(ri>>>26)|0,ri&=67108863,y=Math.imul(ne,Te),d=Math.imul(ne,Re),d=d+Math.imul(Fe,Te)|0,x=Math.imul(Fe,Re),y=y+Math.imul(be,me)|0,d=d+Math.imul(be,Ve)|0,d=d+Math.imul(ye,me)|0,x=x+Math.imul(ye,Ve)|0,y=y+Math.imul(Se,We)|0,d=d+Math.imul(Se,Ge)|0,d=d+Math.imul(Ie,We)|0,x=x+Math.imul(Ie,Ge)|0,y=y+Math.imul(ve,Ue)|0,d=d+Math.imul(ve,Ne)|0,d=d+Math.imul($e,Ue)|0,x=x+Math.imul($e,Ne)|0,y=y+Math.imul(Me,Je)|0,d=d+Math.imul(Me,Ye)|0,d=d+Math.imul(xe,Je)|0,x=x+Math.imul(xe,Ye)|0,y=y+Math.imul(ge,Xe)|0,d=d+Math.imul(ge,Ze)|0,d=d+Math.imul(Oe,Xe)|0,x=x+Math.imul(Oe,Ze)|0;var cn=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(cn>>>26)|0,cn&=67108863,y=Math.imul(ne,me),d=Math.imul(ne,Ve),d=d+Math.imul(Fe,me)|0,x=Math.imul(Fe,Ve),y=y+Math.imul(be,We)|0,d=d+Math.imul(be,Ge)|0,d=d+Math.imul(ye,We)|0,x=x+Math.imul(ye,Ge)|0,y=y+Math.imul(Se,Ue)|0,d=d+Math.imul(Se,Ne)|0,d=d+Math.imul(Ie,Ue)|0,x=x+Math.imul(Ie,Ne)|0,y=y+Math.imul(ve,Je)|0,d=d+Math.imul(ve,Ye)|0,d=d+Math.imul($e,Je)|0,x=x+Math.imul($e,Ye)|0,y=y+Math.imul(Me,Xe)|0,d=d+Math.imul(Me,Ze)|0,d=d+Math.imul(xe,Xe)|0,x=x+Math.imul(xe,Ze)|0;var hn=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(hn>>>26)|0,hn&=67108863,y=Math.imul(ne,We),d=Math.imul(ne,Ge),d=d+Math.imul(Fe,We)|0,x=Math.imul(Fe,Ge),y=y+Math.imul(be,Ue)|0,d=d+Math.imul(be,Ne)|0,d=d+Math.imul(ye,Ue)|0,x=x+Math.imul(ye,Ne)|0,y=y+Math.imul(Se,Je)|0,d=d+Math.imul(Se,Ye)|0,d=d+Math.imul(Ie,Je)|0,x=x+Math.imul(Ie,Ye)|0,y=y+Math.imul(ve,Xe)|0,d=d+Math.imul(ve,Ze)|0,d=d+Math.imul($e,Xe)|0,x=x+Math.imul($e,Ze)|0;var Jt=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,y=Math.imul(ne,Ue),d=Math.imul(ne,Ne),d=d+Math.imul(Fe,Ue)|0,x=Math.imul(Fe,Ne),y=y+Math.imul(be,Je)|0,d=d+Math.imul(be,Ye)|0,d=d+Math.imul(ye,Je)|0,x=x+Math.imul(ye,Ye)|0,y=y+Math.imul(Se,Xe)|0,d=d+Math.imul(Se,Ze)|0,d=d+Math.imul(Ie,Xe)|0,x=x+Math.imul(Ie,Ze)|0;var un=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(un>>>26)|0,un&=67108863,y=Math.imul(ne,Je),d=Math.imul(ne,Ye),d=d+Math.imul(Fe,Je)|0,x=Math.imul(Fe,Ye),y=y+Math.imul(be,Xe)|0,d=d+Math.imul(be,Ze)|0,d=d+Math.imul(ye,Xe)|0,x=x+Math.imul(ye,Ze)|0;var fn=(I+y|0)+((d&8191)<<13)|0;I=(x+(d>>>13)|0)+(fn>>>26)|0,fn&=67108863,y=Math.imul(ne,Xe),d=Math.imul(ne,Ze),d=d+Math.imul(Fe,Xe)|0,x=Math.imul(Fe,Ze);var dn=(I+y|0)+((d&8191)<<13)|0;return I=(x+(d>>>13)|0)+(dn>>>26)|0,dn&=67108863,E[0]=jt,E[1]=Xs,E[2]=Zs,E[3]=Qs,E[4]=en,E[5]=tn,E[6]=cr,E[7]=rn,E[8]=sn,E[9]=nn,E[10]=an,E[11]=on,E[12]=ri,E[13]=cn,E[14]=hn,E[15]=Jt,E[16]=un,E[17]=fn,E[18]=dn,I!==0&&(E[19]=I,w.length++),w};Math.imul||($=m);function O(S,u,b){b.negative=u.negative^S.negative,b.length=S.length+u.length;for(var w=0,p=0,g=0;g<b.length-1;g++){var E=p;p=0;for(var I=w&67108863,y=Math.min(g,u.length-1),d=Math.max(0,g-S.length+1);d<=y;d++){var x=g-d,R=S.words[x]|0,j=u.words[d]|0,F=R*j,q=F&67108863;E=E+(F/67108864|0)|0,q=q+I|0,I=q&67108863,E=E+(q>>>26)|0,p+=E>>>26,E&=67108863}b.words[g]=I,w=E,E=p}return w!==0?b.words[g]=w:b.length--,b.strip()}function D(S,u,b){var w=new P;return w.mulp(S,u,b)}n.prototype.mulTo=function(u,b){var w,p=this.length+u.length;return this.length===10&&u.length===10?w=$(this,u,b):p<63?w=m(this,u,b):p<1024?w=O(this,u,b):w=D(this,u,b),w};function P(S,u){this.x=S,this.y=u}P.prototype.makeRBT=function(u){for(var b=new Array(u),w=n.prototype._countBits(u)-1,p=0;p<u;p++)b[p]=this.revBin(p,w,u);return b},P.prototype.revBin=function(u,b,w){if(u===0||u===w-1)return u;for(var p=0,g=0;g<b;g++)p|=(u&1)<<b-g-1,u>>=1;return p},P.prototype.permute=function(u,b,w,p,g,E){for(var I=0;I<E;I++)p[I]=b[u[I]],g[I]=w[u[I]]},P.prototype.transform=function(u,b,w,p,g,E){this.permute(E,u,b,w,p,g);for(var I=1;I<g;I<<=1)for(var y=I<<1,d=Math.cos(2*Math.PI/y),x=Math.sin(2*Math.PI/y),R=0;R<g;R+=y)for(var j=d,F=x,q=0;q<I;q++){var G=w[R+q],X=p[R+q],Q=w[R+q+I],Y=p[R+q+I],ee=j*Q-F*Y;Y=j*Y+F*Q,Q=ee,w[R+q]=G+Q,p[R+q]=X+Y,w[R+q+I]=G-Q,p[R+q+I]=X-Y,q!==y&&(ee=d*j-x*F,F=d*F+x*j,j=ee)}},P.prototype.guessLen13b=function(u,b){var w=Math.max(b,u)|1,p=w&1,g=0;for(w=w/2|0;w;w=w>>>1)g++;return 1<<g+1+p},P.prototype.conjugate=function(u,b,w){if(!(w<=1))for(var p=0;p<w/2;p++){var g=u[p];u[p]=u[w-p-1],u[w-p-1]=g,g=b[p],b[p]=-b[w-p-1],b[w-p-1]=-g}},P.prototype.normalize13b=function(u,b){for(var w=0,p=0;p<b/2;p++){var g=Math.round(u[2*p+1]/b)*8192+Math.round(u[2*p]/b)+w;u[p]=g&67108863,g<67108864?w=0:w=g/67108864|0}return u},P.prototype.convert13b=function(u,b,w,p){for(var g=0,E=0;E<b;E++)g=g+(u[E]|0),w[2*E]=g&8191,g=g>>>13,w[2*E+1]=g&8191,g=g>>>13;for(E=2*b;E<p;++E)w[E]=0;i(g===0),i((g&-8192)===0)},P.prototype.stub=function(u){for(var b=new Array(u),w=0;w<u;w++)b[w]=0;return b},P.prototype.mulp=function(u,b,w){var p=2*this.guessLen13b(u.length,b.length),g=this.makeRBT(p),E=this.stub(p),I=new Array(p),y=new Array(p),d=new Array(p),x=new Array(p),R=new Array(p),j=new Array(p),F=w.words;F.length=p,this.convert13b(u.words,u.length,I,p),this.convert13b(b.words,b.length,x,p),this.transform(I,E,y,d,p,g),this.transform(x,E,R,j,p,g);for(var q=0;q<p;q++){var G=y[q]*R[q]-d[q]*j[q];d[q]=y[q]*j[q]+d[q]*R[q],y[q]=G}return this.conjugate(y,d,p),this.transform(y,d,F,E,p,g),this.conjugate(F,E,p),this.normalize13b(F,p),w.negative=u.negative^b.negative,w.length=u.length+b.length,w.strip()},n.prototype.mul=function(u){var b=new n(null);return b.words=new Array(this.length+u.length),this.mulTo(u,b)},n.prototype.mulf=function(u){var b=new n(null);return b.words=new Array(this.length+u.length),D(this,u,b)},n.prototype.imul=function(u){return this.clone().mulTo(u,this)},n.prototype.imuln=function(u){i(typeof u=="number"),i(u<67108864);for(var b=0,w=0;w<this.length;w++){var p=(this.words[w]|0)*u,g=(p&67108863)+(b&67108863);b>>=26,b+=p/67108864|0,b+=g>>>26,this.words[w]=g&67108863}return b!==0&&(this.words[w]=b,this.length++),this},n.prototype.muln=function(u){return this.clone().imuln(u)},n.prototype.sqr=function(){return this.mul(this)},n.prototype.isqr=function(){return this.imul(this.clone())},n.prototype.pow=function(u){var b=_(u);if(b.length===0)return new n(1);for(var w=this,p=0;p<b.length&&b[p]===0;p++,w=w.sqr());if(++p<b.length)for(var g=w.sqr();p<b.length;p++,g=g.sqr())b[p]!==0&&(w=w.mul(g));return w},n.prototype.iushln=function(u){i(typeof u=="number"&&u>=0);var b=u%26,w=(u-b)/26,p=67108863>>>26-b<<26-b,g;if(b!==0){var E=0;for(g=0;g<this.length;g++){var I=this.words[g]&p,y=(this.words[g]|0)-I<<b;this.words[g]=y|E,E=I>>>26-b}E&&(this.words[g]=E,this.length++)}if(w!==0){for(g=this.length-1;g>=0;g--)this.words[g+w]=this.words[g];for(g=0;g<w;g++)this.words[g]=0;this.length+=w}return this.strip()},n.prototype.ishln=function(u){return i(this.negative===0),this.iushln(u)},n.prototype.iushrn=function(u,b,w){i(typeof u=="number"&&u>=0);var p;b?p=(b-b%26)/26:p=0;var g=u%26,E=Math.min((u-g)/26,this.length),I=67108863^67108863>>>g<<g,y=w;if(p-=E,p=Math.max(0,p),y){for(var d=0;d<E;d++)y.words[d]=this.words[d];y.length=E}if(E!==0)if(this.length>E)for(this.length-=E,d=0;d<this.length;d++)this.words[d]=this.words[d+E];else this.words[0]=0,this.length=1;var x=0;for(d=this.length-1;d>=0&&(x!==0||d>=p);d--){var R=this.words[d]|0;this.words[d]=x<<26-g|R>>>g,x=R&I}return y&&x!==0&&(y.words[y.length++]=x),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},n.prototype.ishrn=function(u,b,w){return i(this.negative===0),this.iushrn(u,b,w)},n.prototype.shln=function(u){return this.clone().ishln(u)},n.prototype.ushln=function(u){return this.clone().iushln(u)},n.prototype.shrn=function(u){return this.clone().ishrn(u)},n.prototype.ushrn=function(u){return this.clone().iushrn(u)},n.prototype.testn=function(u){i(typeof u=="number"&&u>=0);var b=u%26,w=(u-b)/26,p=1<<b;if(this.length<=w)return!1;var g=this.words[w];return!!(g&p)},n.prototype.imaskn=function(u){i(typeof u=="number"&&u>=0);var b=u%26,w=(u-b)/26;if(i(this.negative===0,"imaskn works only with positive numbers"),this.length<=w)return this;if(b!==0&&w++,this.length=Math.min(w,this.length),b!==0){var p=67108863^67108863>>>b<<b;this.words[this.length-1]&=p}return this.strip()},n.prototype.maskn=function(u){return this.clone().imaskn(u)},n.prototype.iaddn=function(u){return i(typeof u=="number"),i(u<67108864),u<0?this.isubn(-u):this.negative!==0?this.length===1&&(this.words[0]|0)<u?(this.words[0]=u-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(u),this.negative=1,this):this._iaddn(u)},n.prototype._iaddn=function(u){this.words[0]+=u;for(var b=0;b<this.length&&this.words[b]>=67108864;b++)this.words[b]-=67108864,b===this.length-1?this.words[b+1]=1:this.words[b+1]++;return this.length=Math.max(this.length,b+1),this},n.prototype.isubn=function(u){if(i(typeof u=="number"),i(u<67108864),u<0)return this.iaddn(-u);if(this.negative!==0)return this.negative=0,this.iaddn(u),this.negative=1,this;if(this.words[0]-=u,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var b=0;b<this.length&&this.words[b]<0;b++)this.words[b]+=67108864,this.words[b+1]-=1;return this.strip()},n.prototype.addn=function(u){return this.clone().iaddn(u)},n.prototype.subn=function(u){return this.clone().isubn(u)},n.prototype.iabs=function(){return this.negative=0,this},n.prototype.abs=function(){return this.clone().iabs()},n.prototype._ishlnsubmul=function(u,b,w){var p=u.length+w,g;this._expand(p);var E,I=0;for(g=0;g<u.length;g++){E=(this.words[g+w]|0)+I;var y=(u.words[g]|0)*b;E-=y&67108863,I=(E>>26)-(y/67108864|0),this.words[g+w]=E&67108863}for(;g<this.length-w;g++)E=(this.words[g+w]|0)+I,I=E>>26,this.words[g+w]=E&67108863;if(I===0)return this.strip();for(i(I===-1),I=0,g=0;g<this.length;g++)E=-(this.words[g]|0)+I,I=E>>26,this.words[g]=E&67108863;return this.negative=1,this.strip()},n.prototype._wordDiv=function(u,b){var w=this.length-u.length,p=this.clone(),g=u,E=g.words[g.length-1]|0,I=this._countBits(E);w=26-I,w!==0&&(g=g.ushln(w),p.iushln(w),E=g.words[g.length-1]|0);var y=p.length-g.length,d;if(b!=="mod"){d=new n(null),d.length=y+1,d.words=new Array(d.length);for(var x=0;x<d.length;x++)d.words[x]=0}var R=p.clone()._ishlnsubmul(g,1,y);R.negative===0&&(p=R,d&&(d.words[y]=1));for(var j=y-1;j>=0;j--){var F=(p.words[g.length+j]|0)*67108864+(p.words[g.length+j-1]|0);for(F=Math.min(F/E|0,67108863),p._ishlnsubmul(g,F,j);p.negative!==0;)F--,p.negative=0,p._ishlnsubmul(g,1,j),p.isZero()||(p.negative^=1);d&&(d.words[j]=F)}return d&&d.strip(),p.strip(),b!=="div"&&w!==0&&p.iushrn(w),{div:d||null,mod:p}},n.prototype.divmod=function(u,b,w){if(i(!u.isZero()),this.isZero())return{div:new n(0),mod:new n(0)};var p,g,E;return this.negative!==0&&u.negative===0?(E=this.neg().divmod(u,b),b!=="mod"&&(p=E.div.neg()),b!=="div"&&(g=E.mod.neg(),w&&g.negative!==0&&g.iadd(u)),{div:p,mod:g}):this.negative===0&&u.negative!==0?(E=this.divmod(u.neg(),b),b!=="mod"&&(p=E.div.neg()),{div:p,mod:E.mod}):this.negative&u.negative?(E=this.neg().divmod(u.neg(),b),b!=="div"&&(g=E.mod.neg(),w&&g.negative!==0&&g.isub(u)),{div:E.div,mod:g}):u.length>this.length||this.cmp(u)<0?{div:new n(0),mod:this}:u.length===1?b==="div"?{div:this.divn(u.words[0]),mod:null}:b==="mod"?{div:null,mod:new n(this.modn(u.words[0]))}:{div:this.divn(u.words[0]),mod:new n(this.modn(u.words[0]))}:this._wordDiv(u,b)},n.prototype.div=function(u){return this.divmod(u,"div",!1).div},n.prototype.mod=function(u){return this.divmod(u,"mod",!1).mod},n.prototype.umod=function(u){return this.divmod(u,"mod",!0).mod},n.prototype.divRound=function(u){var b=this.divmod(u);if(b.mod.isZero())return b.div;var w=b.div.negative!==0?b.mod.isub(u):b.mod,p=u.ushrn(1),g=u.andln(1),E=w.cmp(p);return E<0||g===1&&E===0?b.div:b.div.negative!==0?b.div.isubn(1):b.div.iaddn(1)},n.prototype.modn=function(u){i(u<=67108863);for(var b=(1<<26)%u,w=0,p=this.length-1;p>=0;p--)w=(b*w+(this.words[p]|0))%u;return w},n.prototype.idivn=function(u){i(u<=67108863);for(var b=0,w=this.length-1;w>=0;w--){var p=(this.words[w]|0)+b*67108864;this.words[w]=p/u|0,b=p%u}return this.strip()},n.prototype.divn=function(u){return this.clone().idivn(u)},n.prototype.egcd=function(u){i(u.negative===0),i(!u.isZero());var b=this,w=u.clone();b.negative!==0?b=b.umod(u):b=b.clone();for(var p=new n(1),g=new n(0),E=new n(0),I=new n(1),y=0;b.isEven()&&w.isEven();)b.iushrn(1),w.iushrn(1),++y;for(var d=w.clone(),x=b.clone();!b.isZero();){for(var R=0,j=1;!(b.words[0]&j)&&R<26;++R,j<<=1);if(R>0)for(b.iushrn(R);R-- >0;)(p.isOdd()||g.isOdd())&&(p.iadd(d),g.isub(x)),p.iushrn(1),g.iushrn(1);for(var F=0,q=1;!(w.words[0]&q)&&F<26;++F,q<<=1);if(F>0)for(w.iushrn(F);F-- >0;)(E.isOdd()||I.isOdd())&&(E.iadd(d),I.isub(x)),E.iushrn(1),I.iushrn(1);b.cmp(w)>=0?(b.isub(w),p.isub(E),g.isub(I)):(w.isub(b),E.isub(p),I.isub(g))}return{a:E,b:I,gcd:w.iushln(y)}},n.prototype._invmp=function(u){i(u.negative===0),i(!u.isZero());var b=this,w=u.clone();b.negative!==0?b=b.umod(u):b=b.clone();for(var p=new n(1),g=new n(0),E=w.clone();b.cmpn(1)>0&&w.cmpn(1)>0;){for(var I=0,y=1;!(b.words[0]&y)&&I<26;++I,y<<=1);if(I>0)for(b.iushrn(I);I-- >0;)p.isOdd()&&p.iadd(E),p.iushrn(1);for(var d=0,x=1;!(w.words[0]&x)&&d<26;++d,x<<=1);if(d>0)for(w.iushrn(d);d-- >0;)g.isOdd()&&g.iadd(E),g.iushrn(1);b.cmp(w)>=0?(b.isub(w),p.isub(g)):(w.isub(b),g.isub(p))}var R;return b.cmpn(1)===0?R=p:R=g,R.cmpn(0)<0&&R.iadd(u),R},n.prototype.gcd=function(u){if(this.isZero())return u.abs();if(u.isZero())return this.abs();var b=this.clone(),w=u.clone();b.negative=0,w.negative=0;for(var p=0;b.isEven()&&w.isEven();p++)b.iushrn(1),w.iushrn(1);do{for(;b.isEven();)b.iushrn(1);for(;w.isEven();)w.iushrn(1);var g=b.cmp(w);if(g<0){var E=b;b=w,w=E}else if(g===0||w.cmpn(1)===0)break;b.isub(w)}while(!0);return w.iushln(p)},n.prototype.invm=function(u){return this.egcd(u).a.umod(u)},n.prototype.isEven=function(){return(this.words[0]&1)===0},n.prototype.isOdd=function(){return(this.words[0]&1)===1},n.prototype.andln=function(u){return this.words[0]&u},n.prototype.bincn=function(u){i(typeof u=="number");var b=u%26,w=(u-b)/26,p=1<<b;if(this.length<=w)return this._expand(w+1),this.words[w]|=p,this;for(var g=p,E=w;g!==0&&E<this.length;E++){var I=this.words[E]|0;I+=g,g=I>>>26,I&=67108863,this.words[E]=I}return g!==0&&(this.words[E]=g,this.length++),this},n.prototype.isZero=function(){return this.length===1&&this.words[0]===0},n.prototype.cmpn=function(u){var b=u<0;if(this.negative!==0&&!b)return-1;if(this.negative===0&&b)return 1;this.strip();var w;if(this.length>1)w=1;else{b&&(u=-u),i(u<=67108863,"Number is too big");var p=this.words[0]|0;w=p===u?0:p<u?-1:1}return this.negative!==0?-w|0:w},n.prototype.cmp=function(u){if(this.negative!==0&&u.negative===0)return-1;if(this.negative===0&&u.negative!==0)return 1;var b=this.ucmp(u);return this.negative!==0?-b|0:b},n.prototype.ucmp=function(u){if(this.length>u.length)return 1;if(this.length<u.length)return-1;for(var b=0,w=this.length-1;w>=0;w--){var p=this.words[w]|0,g=u.words[w]|0;if(p!==g){p<g?b=-1:p>g&&(b=1);break}}return b},n.prototype.gtn=function(u){return this.cmpn(u)===1},n.prototype.gt=function(u){return this.cmp(u)===1},n.prototype.gten=function(u){return this.cmpn(u)>=0},n.prototype.gte=function(u){return this.cmp(u)>=0},n.prototype.ltn=function(u){return this.cmpn(u)===-1},n.prototype.lt=function(u){return this.cmp(u)===-1},n.prototype.lten=function(u){return this.cmpn(u)<=0},n.prototype.lte=function(u){return this.cmp(u)<=0},n.prototype.eqn=function(u){return this.cmpn(u)===0},n.prototype.eq=function(u){return this.cmp(u)===0},n.red=function(u){return new B(u)},n.prototype.toRed=function(u){return i(!this.red,"Already a number in reduction context"),i(this.negative===0,"red works only with positives"),u.convertTo(this)._forceRed(u)},n.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},n.prototype._forceRed=function(u){return this.red=u,this},n.prototype.forceRed=function(u){return i(!this.red,"Already a number in reduction context"),this._forceRed(u)},n.prototype.redAdd=function(u){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,u)},n.prototype.redIAdd=function(u){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,u)},n.prototype.redSub=function(u){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,u)},n.prototype.redISub=function(u){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,u)},n.prototype.redShl=function(u){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,u)},n.prototype.redMul=function(u){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,u),this.red.mul(this,u)},n.prototype.redIMul=function(u){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,u),this.red.imul(this,u)},n.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},n.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},n.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},n.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},n.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},n.prototype.redPow=function(u){return i(this.red&&!u.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,u)};var C={k256:null,p224:null,p192:null,p25519:null};function T(S,u){this.name=S,this.p=new n(u,16),this.n=this.p.bitLength(),this.k=new n(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}T.prototype._tmp=function(){var u=new n(null);return u.words=new Array(Math.ceil(this.n/13)),u},T.prototype.ireduce=function(u){var b=u,w;do this.split(b,this.tmp),b=this.imulK(b),b=b.iadd(this.tmp),w=b.bitLength();while(w>this.n);var p=w<this.n?-1:b.ucmp(this.p);return p===0?(b.words[0]=0,b.length=1):p>0?b.isub(this.p):b.strip!==void 0?b.strip():b._strip(),b},T.prototype.split=function(u,b){u.iushrn(this.n,0,b)},T.prototype.imulK=function(u){return u.imul(this.k)};function N(){T.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}s(N,T),N.prototype.split=function(u,b){for(var w=4194303,p=Math.min(u.length,9),g=0;g<p;g++)b.words[g]=u.words[g];if(b.length=p,u.length<=9){u.words[0]=0,u.length=1;return}var E=u.words[9];for(b.words[b.length++]=E&w,g=10;g<u.length;g++){var I=u.words[g]|0;u.words[g-10]=(I&w)<<4|E>>>22,E=I}E>>>=22,u.words[g-10]=E,E===0&&u.length>10?u.length-=10:u.length-=9},N.prototype.imulK=function(u){u.words[u.length]=0,u.words[u.length+1]=0,u.length+=2;for(var b=0,w=0;w<u.length;w++){var p=u.words[w]|0;b+=p*977,u.words[w]=b&67108863,b=p*64+(b/67108864|0)}return u.words[u.length-1]===0&&(u.length--,u.words[u.length-1]===0&&u.length--),u};function z(){T.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}s(z,T);function H(){T.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}s(H,T);function U(){T.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}s(U,T),U.prototype.imulK=function(u){for(var b=0,w=0;w<u.length;w++){var p=(u.words[w]|0)*19+b,g=p&67108863;p>>>=26,u.words[w]=g,b=p}return b!==0&&(u.words[u.length++]=b),u},n._prime=function(u){if(C[u])return C[u];var b;if(u==="k256")b=new N;else if(u==="p224")b=new z;else if(u==="p192")b=new H;else if(u==="p25519")b=new U;else throw new Error("Unknown prime "+u);return C[u]=b,b};function B(S){if(typeof S=="string"){var u=n._prime(S);this.m=u.p,this.prime=u}else i(S.gtn(1),"modulus must be greater than 1"),this.m=S,this.prime=null}B.prototype._verify1=function(u){i(u.negative===0,"red works only with positives"),i(u.red,"red works only with red numbers")},B.prototype._verify2=function(u,b){i((u.negative|b.negative)===0,"red works only with positives"),i(u.red&&u.red===b.red,"red works only with red numbers")},B.prototype.imod=function(u){return this.prime?this.prime.ireduce(u)._forceRed(this):u.umod(this.m)._forceRed(this)},B.prototype.neg=function(u){return u.isZero()?u.clone():this.m.sub(u)._forceRed(this)},B.prototype.add=function(u,b){this._verify2(u,b);var w=u.add(b);return w.cmp(this.m)>=0&&w.isub(this.m),w._forceRed(this)},B.prototype.iadd=function(u,b){this._verify2(u,b);var w=u.iadd(b);return w.cmp(this.m)>=0&&w.isub(this.m),w},B.prototype.sub=function(u,b){this._verify2(u,b);var w=u.sub(b);return w.cmpn(0)<0&&w.iadd(this.m),w._forceRed(this)},B.prototype.isub=function(u,b){this._verify2(u,b);var w=u.isub(b);return w.cmpn(0)<0&&w.iadd(this.m),w},B.prototype.shl=function(u,b){return this._verify1(u),this.imod(u.ushln(b))},B.prototype.imul=function(u,b){return this._verify2(u,b),this.imod(u.imul(b))},B.prototype.mul=function(u,b){return this._verify2(u,b),this.imod(u.mul(b))},B.prototype.isqr=function(u){return this.imul(u,u.clone())},B.prototype.sqr=function(u){return this.mul(u,u)},B.prototype.sqrt=function(u){if(u.isZero())return u.clone();var b=this.m.andln(3);if(i(b%2===1),b===3){var w=this.m.add(new n(1)).iushrn(2);return this.pow(u,w)}for(var p=this.m.subn(1),g=0;!p.isZero()&&p.andln(1)===0;)g++,p.iushrn(1);i(!p.isZero());var E=new n(1).toRed(this),I=E.redNeg(),y=this.m.subn(1).iushrn(1),d=this.m.bitLength();for(d=new n(2*d*d).toRed(this);this.pow(d,y).cmp(I)!==0;)d.redIAdd(I);for(var x=this.pow(d,p),R=this.pow(u,p.addn(1).iushrn(1)),j=this.pow(u,p),F=g;j.cmp(E)!==0;){for(var q=j,G=0;q.cmp(E)!==0;G++)q=q.redSqr();i(G<F);var X=this.pow(x,new n(1).iushln(F-G-1));R=R.redMul(X),x=X.redSqr(),j=j.redMul(x),F=G}return R},B.prototype.invm=function(u){var b=u._invmp(this.m);return b.negative!==0?(b.negative=0,this.imod(b).redNeg()):this.imod(b)},B.prototype.pow=function(u,b){if(b.isZero())return new n(1).toRed(this);if(b.cmpn(1)===0)return u.clone();var w=4,p=new Array(1<<w);p[0]=new n(1).toRed(this),p[1]=u;for(var g=2;g<p.length;g++)p[g]=this.mul(p[g-1],u);var E=p[0],I=0,y=0,d=b.bitLength()%26;for(d===0&&(d=26),g=b.length-1;g>=0;g--){for(var x=b.words[g],R=d-1;R>=0;R--){var j=x>>R&1;if(E!==p[0]&&(E=this.sqr(E)),j===0&&I===0){y=0;continue}I<<=1,I|=j,y++,!(y!==w&&(g!==0||R!==0))&&(E=this.mul(E,p[I]),y=0,I=0)}d=26}return E},B.prototype.convertTo=function(u){var b=u.umod(this.m);return b===u?b.clone():b},B.prototype.convertFrom=function(u){var b=u.clone();return b.red=null,b},n.mont=function(u){return new J(u)};function J(S){B.call(this,S),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new n(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}s(J,B),J.prototype.convertTo=function(u){return this.imod(u.ushln(this.shift))},J.prototype.convertFrom=function(u){var b=this.imod(u.mul(this.rinv));return b.red=null,b},J.prototype.imul=function(u,b){if(u.isZero()||b.isZero())return u.words[0]=0,u.length=1,u;var w=u.imul(b),p=w.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),g=w.isub(p).iushrn(this.shift),E=g;return g.cmp(this.m)>=0?E=g.isub(this.m):g.cmpn(0)<0&&(E=g.iadd(this.m)),E._forceRed(this)},J.prototype.mul=function(u,b){if(u.isZero()||b.isZero())return new n(0)._forceRed(this);var w=u.mul(b),p=w.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),g=w.isub(p).iushrn(this.shift),E=g;return g.cmp(this.m)>=0?E=g.isub(this.m):g.cmpn(0)<0&&(E=g.iadd(this.m)),E._forceRed(this)},J.prototype.invm=function(u){var b=this.imod(u._invmp(this.m).mul(this.r2));return b._forceRed(this)}})(t,Dt)})(Ph);var ei=Ph.exports,Hi=vp;function vp(t,e){if(!t)throw new Error(e||"Assertion failed")}vp.equal=function(e,r,i){if(e!=r)throw new Error(i||"Assertion failed: "+e+" != "+r)};var Oh={};(function(t){var e=t;function r(n,a){if(Array.isArray(n))return n.slice();if(!n)return[];var o=[];if(typeof n!="string"){for(var c=0;c<n.length;c++)o[c]=n[c]|0;return o}if(a==="hex"){n=n.replace(/[^a-z0-9]+/ig,""),n.length%2!==0&&(n="0"+n);for(var c=0;c<n.length;c+=2)o.push(parseInt(n[c]+n[c+1],16))}else for(var c=0;c<n.length;c++){var h=n.charCodeAt(c),f=h>>8,l=h&255;f?o.push(f,l):o.push(l)}return o}e.toArray=r;function i(n){return n.length===1?"0"+n:n}e.zero2=i;function s(n){for(var a="",o=0;o<n.length;o++)a+=i(n[o].toString(16));return a}e.toHex=s,e.encode=function(a,o){return o==="hex"?s(a):a}})(Oh);(function(t){var e=t,r=ei,i=Hi,s=Oh;e.assert=i,e.toArray=s.toArray,e.zero2=s.zero2,e.toHex=s.toHex,e.encode=s.encode;function n(f,l,v){var _=new Array(Math.max(f.bitLength(),v)+1),m;for(m=0;m<_.length;m+=1)_[m]=0;var $=1<<l+1,O=f.clone();for(m=0;m<_.length;m++){var D,P=O.andln($-1);O.isOdd()?(P>($>>1)-1?D=($>>1)-P:D=P,O.isubn(D)):D=0,_[m]=D,O.iushrn(1)}return _}e.getNAF=n;function a(f,l){var v=[[],[]];f=f.clone(),l=l.clone();for(var _=0,m=0,$;f.cmpn(-_)>0||l.cmpn(-m)>0;){var O=f.andln(3)+_&3,D=l.andln(3)+m&3;O===3&&(O=-1),D===3&&(D=-1);var P;O&1?($=f.andln(7)+_&7,($===3||$===5)&&D===2?P=-O:P=O):P=0,v[0].push(P);var C;D&1?($=l.andln(7)+m&7,($===3||$===5)&&O===2?C=-D:C=D):C=0,v[1].push(C),2*_===P+1&&(_=1-_),2*m===C+1&&(m=1-m),f.iushrn(1),l.iushrn(1)}return v}e.getJSF=a;function o(f,l,v){var _="_"+l;f.prototype[l]=function(){return this[_]!==void 0?this[_]:this[_]=v.call(this)}}e.cachedProperty=o;function c(f){return typeof f=="string"?e.toArray(f,"hex"):f}e.parseBytes=c;function h(f){return new r(f,"hex","le")}e.intFromLE=h})(Wt);var Mh={exports:{}},Zo;Mh.exports=function(e){return Zo||(Zo=new fi(null)),Zo.generate(e)};function fi(t){this.rand=t}Mh.exports.Rand=fi;fi.prototype.generate=function(e){return this._rand(e)};fi.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var r=new Uint8Array(e),i=0;i<r.length;i++)r[i]=this.rand.getByte();return r};if(typeof self=="object")self.crypto&&self.crypto.getRandomValues?fi.prototype._rand=function(e){var r=new Uint8Array(e);return self.crypto.getRandomValues(r),r}:self.msCrypto&&self.msCrypto.getRandomValues?fi.prototype._rand=function(e){var r=new Uint8Array(e);return self.msCrypto.getRandomValues(r),r}:typeof window=="object"&&(fi.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var Qu=ml;if(typeof Qu.randomBytes!="function")throw new Error("Not supported");fi.prototype._rand=function(e){return Qu.randomBytes(e)}}catch{}var yp=Mh.exports,Ch={},Di=ei,Wn=Wt,za=Wn.getNAF,x2=Wn.getJSF,ka=Wn.assert;function vi(t,e){this.type=t,this.p=new Di(e.p,16),this.red=e.prime?Di.red(e.prime):Di.mont(this.p),this.zero=new Di(0).toRed(this.red),this.one=new Di(1).toRed(this.red),this.two=new Di(2).toRed(this.red),this.n=e.n&&new Di(e.n,16),this.g=e.g&&this.pointFromJSON(e.g,e.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}var ho=vi;vi.prototype.point=function(){throw new Error("Not implemented")};vi.prototype.validate=function(){throw new Error("Not implemented")};vi.prototype._fixedNafMul=function(e,r){ka(e.precomputed);var i=e._getDoubles(),s=za(r,1,this._bitLength),n=(1<<i.step+1)-(i.step%2===0?2:1);n/=3;var a=[],o,c;for(o=0;o<s.length;o+=i.step){c=0;for(var h=o+i.step-1;h>=o;h--)c=(c<<1)+s[h];a.push(c)}for(var f=this.jpoint(null,null,null),l=this.jpoint(null,null,null),v=n;v>0;v--){for(o=0;o<a.length;o++)c=a[o],c===v?l=l.mixedAdd(i.points[o]):c===-v&&(l=l.mixedAdd(i.points[o].neg()));f=f.add(l)}return f.toP()};vi.prototype._wnafMul=function(e,r){var i=4,s=e._getNAFPoints(i);i=s.wnd;for(var n=s.points,a=za(r,i,this._bitLength),o=this.jpoint(null,null,null),c=a.length-1;c>=0;c--){for(var h=0;c>=0&&a[c]===0;c--)h++;if(c>=0&&h++,o=o.dblp(h),c<0)break;var f=a[c];ka(f!==0),e.type==="affine"?f>0?o=o.mixedAdd(n[f-1>>1]):o=o.mixedAdd(n[-f-1>>1].neg()):f>0?o=o.add(n[f-1>>1]):o=o.add(n[-f-1>>1].neg())}return e.type==="affine"?o.toP():o};vi.prototype._wnafMulAdd=function(e,r,i,s,n){var a=this._wnafT1,o=this._wnafT2,c=this._wnafT3,h=0,f,l,v;for(f=0;f<s;f++){v=r[f];var _=v._getNAFPoints(e);a[f]=_.wnd,o[f]=_.points}for(f=s-1;f>=1;f-=2){var m=f-1,$=f;if(a[m]!==1||a[$]!==1){c[m]=za(i[m],a[m],this._bitLength),c[$]=za(i[$],a[$],this._bitLength),h=Math.max(c[m].length,h),h=Math.max(c[$].length,h);continue}var O=[r[m],null,null,r[$]];r[m].y.cmp(r[$].y)===0?(O[1]=r[m].add(r[$]),O[2]=r[m].toJ().mixedAdd(r[$].neg())):r[m].y.cmp(r[$].y.redNeg())===0?(O[1]=r[m].toJ().mixedAdd(r[$]),O[2]=r[m].add(r[$].neg())):(O[1]=r[m].toJ().mixedAdd(r[$]),O[2]=r[m].toJ().mixedAdd(r[$].neg()));var D=[-3,-1,-5,-7,0,7,5,1,3],P=x2(i[m],i[$]);for(h=Math.max(P[0].length,h),c[m]=new Array(h),c[$]=new Array(h),l=0;l<h;l++){var C=P[0][l]|0,T=P[1][l]|0;c[m][l]=D[(C+1)*3+(T+1)],c[$][l]=0,o[m]=O}}var N=this.jpoint(null,null,null),z=this._wnafT4;for(f=h;f>=0;f--){for(var H=0;f>=0;){var U=!0;for(l=0;l<s;l++)z[l]=c[l][f]|0,z[l]!==0&&(U=!1);if(!U)break;H++,f--}if(f>=0&&H++,N=N.dblp(H),f<0)break;for(l=0;l<s;l++){var B=z[l];B!==0&&(B>0?v=o[l][B-1>>1]:B<0&&(v=o[l][-B-1>>1].neg()),v.type==="affine"?N=N.mixedAdd(v):N=N.add(v))}}for(f=0;f<s;f++)o[f]=null;return n?N:N.toP()};function sr(t,e){this.curve=t,this.type=e,this.precomputed=null}vi.BasePoint=sr;sr.prototype.eq=function(){throw new Error("Not implemented")};sr.prototype.validate=function(){return this.curve.validate(this)};vi.prototype.decodePoint=function(e,r){e=Wn.toArray(e,r);var i=this.p.byteLength();if((e[0]===4||e[0]===6||e[0]===7)&&e.length-1===2*i){e[0]===6?ka(e[e.length-1]%2===0):e[0]===7&&ka(e[e.length-1]%2===1);var s=this.point(e.slice(1,1+i),e.slice(1+i,1+2*i));return s}else if((e[0]===2||e[0]===3)&&e.length-1===i)return this.pointFromX(e.slice(1,1+i),e[0]===3);throw new Error("Unknown point format")};sr.prototype.encodeCompressed=function(e){return this.encode(e,!0)};sr.prototype._encode=function(e){var r=this.curve.p.byteLength(),i=this.getX().toArray("be",r);return e?[this.getY().isEven()?2:3].concat(i):[4].concat(i,this.getY().toArray("be",r))};sr.prototype.encode=function(e,r){return Wn.encode(this._encode(r),e)};sr.prototype.precompute=function(e){if(this.precomputed)return this;var r={doubles:null,naf:null,beta:null};return r.naf=this._getNAFPoints(8),r.doubles=this._getDoubles(4,e),r.beta=this._getBeta(),this.precomputed=r,this};sr.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var r=this.precomputed.doubles;return r?r.points.length>=Math.ceil((e.bitLength()+1)/r.step):!1};sr.prototype._getDoubles=function(e,r){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var i=[this],s=this,n=0;n<r;n+=e){for(var a=0;a<e;a++)s=s.dbl();i.push(s)}return{step:e,points:i}};sr.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var r=[this],i=(1<<e)-1,s=i===1?null:this.dbl(),n=1;n<i;n++)r[n]=r[n-1].add(s);return{wnd:e,points:r}};sr.prototype._getBeta=function(){return null};sr.prototype.dblp=function(e){for(var r=this,i=0;i<e;i++)r=r.dbl();return r};var $2=Wt,et=ei,Th=ro,Us=ho,S2=$2.assert;function nr(t){Us.call(this,"short",t),this.a=new et(t.a,16).toRed(this.red),this.b=new et(t.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(t),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}Th(nr,Us);var I2=nr;nr.prototype._getEndomorphism=function(e){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var r,i;if(e.beta)r=new et(e.beta,16).toRed(this.red);else{var s=this._getEndoRoots(this.p);r=s[0].cmp(s[1])<0?s[0]:s[1],r=r.toRed(this.red)}if(e.lambda)i=new et(e.lambda,16);else{var n=this._getEndoRoots(this.n);this.g.mul(n[0]).x.cmp(this.g.x.redMul(r))===0?i=n[0]:(i=n[1],S2(this.g.mul(i).x.cmp(this.g.x.redMul(r))===0))}var a;return e.basis?a=e.basis.map(function(o){return{a:new et(o.a,16),b:new et(o.b,16)}}):a=this._getEndoBasis(i),{beta:r,lambda:i,basis:a}}};nr.prototype._getEndoRoots=function(e){var r=e===this.p?this.red:et.mont(e),i=new et(2).toRed(r).redInvm(),s=i.redNeg(),n=new et(3).toRed(r).redNeg().redSqrt().redMul(i),a=s.redAdd(n).fromRed(),o=s.redSub(n).fromRed();return[a,o]};nr.prototype._getEndoBasis=function(e){for(var r=this.n.ushrn(Math.floor(this.n.bitLength()/2)),i=e,s=this.n.clone(),n=new et(1),a=new et(0),o=new et(0),c=new et(1),h,f,l,v,_,m,$,O=0,D,P;i.cmpn(0)!==0;){var C=s.div(i);D=s.sub(C.mul(i)),P=o.sub(C.mul(n));var T=c.sub(C.mul(a));if(!l&&D.cmp(r)<0)h=$.neg(),f=n,l=D.neg(),v=P;else if(l&&++O===2)break;$=D,s=i,i=D,o=n,n=P,c=a,a=T}_=D.neg(),m=P;var N=l.sqr().add(v.sqr()),z=_.sqr().add(m.sqr());return z.cmp(N)>=0&&(_=h,m=f),l.negative&&(l=l.neg(),v=v.neg()),_.negative&&(_=_.neg(),m=m.neg()),[{a:l,b:v},{a:_,b:m}]};nr.prototype._endoSplit=function(e){var r=this.endo.basis,i=r[0],s=r[1],n=s.b.mul(e).divRound(this.n),a=i.b.neg().mul(e).divRound(this.n),o=n.mul(i.a),c=a.mul(s.a),h=n.mul(i.b),f=a.mul(s.b),l=e.sub(o).sub(c),v=h.add(f).neg();return{k1:l,k2:v}};nr.prototype.pointFromX=function(e,r){e=new et(e,16),e.red||(e=e.toRed(this.red));var i=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),s=i.redSqrt();if(s.redSqr().redSub(i).cmp(this.zero)!==0)throw new Error("invalid point");var n=s.fromRed().isOdd();return(r&&!n||!r&&n)&&(s=s.redNeg()),this.point(e,s)};nr.prototype.validate=function(e){if(e.inf)return!0;var r=e.x,i=e.y,s=this.a.redMul(r),n=r.redSqr().redMul(r).redIAdd(s).redIAdd(this.b);return i.redSqr().redISub(n).cmpn(0)===0};nr.prototype._endoWnafMulAdd=function(e,r,i){for(var s=this._endoWnafT1,n=this._endoWnafT2,a=0;a<e.length;a++){var o=this._endoSplit(r[a]),c=e[a],h=c._getBeta();o.k1.negative&&(o.k1.ineg(),c=c.neg(!0)),o.k2.negative&&(o.k2.ineg(),h=h.neg(!0)),s[a*2]=c,s[a*2+1]=h,n[a*2]=o.k1,n[a*2+1]=o.k2}for(var f=this._wnafMulAdd(1,s,n,a*2,i),l=0;l<a*2;l++)s[l]=null,n[l]=null;return f};function pt(t,e,r,i){Us.BasePoint.call(this,t,"affine"),e===null&&r===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new et(e,16),this.y=new et(r,16),i&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}Th(pt,Us.BasePoint);nr.prototype.point=function(e,r,i){return new pt(this,e,r,i)};nr.prototype.pointFromJSON=function(e,r){return pt.fromJSON(this,e,r)};pt.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var r=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var i=this.curve,s=function(n){return i.point(n.x.redMul(i.endo.beta),n.y)};e.beta=r,r.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(s)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(s)}}}return r}};pt.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]};pt.fromJSON=function(e,r,i){typeof r=="string"&&(r=JSON.parse(r));var s=e.point(r[0],r[1],i);if(!r[2])return s;function n(o){return e.point(o[0],o[1],i)}var a=r[2];return s.precomputed={beta:null,doubles:a.doubles&&{step:a.doubles.step,points:[s].concat(a.doubles.points.map(n))},naf:a.naf&&{wnd:a.naf.wnd,points:[s].concat(a.naf.points.map(n))}},s};pt.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"};pt.prototype.isInfinity=function(){return this.inf};pt.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(this.x.cmp(e.x)===0)return this.curve.point(null,null);var r=this.y.redSub(e.y);r.cmpn(0)!==0&&(r=r.redMul(this.x.redSub(e.x).redInvm()));var i=r.redSqr().redISub(this.x).redISub(e.x),s=r.redMul(this.x.redSub(i)).redISub(this.y);return this.curve.point(i,s)};pt.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(e.cmpn(0)===0)return this.curve.point(null,null);var r=this.curve.a,i=this.x.redSqr(),s=e.redInvm(),n=i.redAdd(i).redIAdd(i).redIAdd(r).redMul(s),a=n.redSqr().redISub(this.x.redAdd(this.x)),o=n.redMul(this.x.redSub(a)).redISub(this.y);return this.curve.point(a,o)};pt.prototype.getX=function(){return this.x.fromRed()};pt.prototype.getY=function(){return this.y.fromRed()};pt.prototype.mul=function(e){return e=new et(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)};pt.prototype.mulAdd=function(e,r,i){var s=[this,r],n=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(s,n):this.curve._wnafMulAdd(1,s,n,2)};pt.prototype.jmulAdd=function(e,r,i){var s=[this,r],n=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(s,n,!0):this.curve._wnafMulAdd(1,s,n,2,!0)};pt.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||this.x.cmp(e.x)===0&&this.y.cmp(e.y)===0)};pt.prototype.neg=function(e){if(this.inf)return this;var r=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var i=this.precomputed,s=function(n){return n.neg()};r.precomputed={naf:i.naf&&{wnd:i.naf.wnd,points:i.naf.points.map(s)},doubles:i.doubles&&{step:i.doubles.step,points:i.doubles.points.map(s)}}}return r};pt.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var e=this.curve.jpoint(this.x,this.y,this.curve.one);return e};function Et(t,e,r,i){Us.BasePoint.call(this,t,"jacobian"),e===null&&r===null&&i===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new et(0)):(this.x=new et(e,16),this.y=new et(r,16),this.z=new et(i,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}Th(Et,Us.BasePoint);nr.prototype.jpoint=function(e,r,i){return new Et(this,e,r,i)};Et.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),r=e.redSqr(),i=this.x.redMul(r),s=this.y.redMul(r).redMul(e);return this.curve.point(i,s)};Et.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)};Et.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var r=e.z.redSqr(),i=this.z.redSqr(),s=this.x.redMul(r),n=e.x.redMul(i),a=this.y.redMul(r.redMul(e.z)),o=e.y.redMul(i.redMul(this.z)),c=s.redSub(n),h=a.redSub(o);if(c.cmpn(0)===0)return h.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var f=c.redSqr(),l=f.redMul(c),v=s.redMul(f),_=h.redSqr().redIAdd(l).redISub(v).redISub(v),m=h.redMul(v.redISub(_)).redISub(a.redMul(l)),$=this.z.redMul(e.z).redMul(c);return this.curve.jpoint(_,m,$)};Et.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var r=this.z.redSqr(),i=this.x,s=e.x.redMul(r),n=this.y,a=e.y.redMul(r).redMul(this.z),o=i.redSub(s),c=n.redSub(a);if(o.cmpn(0)===0)return c.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var h=o.redSqr(),f=h.redMul(o),l=i.redMul(h),v=c.redSqr().redIAdd(f).redISub(l).redISub(l),_=c.redMul(l.redISub(v)).redISub(n.redMul(f)),m=this.z.redMul(o);return this.curve.jpoint(v,_,m)};Et.prototype.dblp=function(e){if(e===0)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var r;if(this.curve.zeroA||this.curve.threeA){var i=this;for(r=0;r<e;r++)i=i.dbl();return i}var s=this.curve.a,n=this.curve.tinv,a=this.x,o=this.y,c=this.z,h=c.redSqr().redSqr(),f=o.redAdd(o);for(r=0;r<e;r++){var l=a.redSqr(),v=f.redSqr(),_=v.redSqr(),m=l.redAdd(l).redIAdd(l).redIAdd(s.redMul(h)),$=a.redMul(v),O=m.redSqr().redISub($.redAdd($)),D=$.redISub(O),P=m.redMul(D);P=P.redIAdd(P).redISub(_);var C=f.redMul(c);r+1<e&&(h=h.redMul(_)),a=O,c=C,f=P}return this.curve.jpoint(a,f.redMul(n),c)};Et.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()};Et.prototype._zeroDbl=function(){var e,r,i;if(this.zOne){var s=this.x.redSqr(),n=this.y.redSqr(),a=n.redSqr(),o=this.x.redAdd(n).redSqr().redISub(s).redISub(a);o=o.redIAdd(o);var c=s.redAdd(s).redIAdd(s),h=c.redSqr().redISub(o).redISub(o),f=a.redIAdd(a);f=f.redIAdd(f),f=f.redIAdd(f),e=h,r=c.redMul(o.redISub(h)).redISub(f),i=this.y.redAdd(this.y)}else{var l=this.x.redSqr(),v=this.y.redSqr(),_=v.redSqr(),m=this.x.redAdd(v).redSqr().redISub(l).redISub(_);m=m.redIAdd(m);var $=l.redAdd(l).redIAdd(l),O=$.redSqr(),D=_.redIAdd(_);D=D.redIAdd(D),D=D.redIAdd(D),e=O.redISub(m).redISub(m),r=$.redMul(m.redISub(e)).redISub(D),i=this.y.redMul(this.z),i=i.redIAdd(i)}return this.curve.jpoint(e,r,i)};Et.prototype._threeDbl=function(){var e,r,i;if(this.zOne){var s=this.x.redSqr(),n=this.y.redSqr(),a=n.redSqr(),o=this.x.redAdd(n).redSqr().redISub(s).redISub(a);o=o.redIAdd(o);var c=s.redAdd(s).redIAdd(s).redIAdd(this.curve.a),h=c.redSqr().redISub(o).redISub(o);e=h;var f=a.redIAdd(a);f=f.redIAdd(f),f=f.redIAdd(f),r=c.redMul(o.redISub(h)).redISub(f),i=this.y.redAdd(this.y)}else{var l=this.z.redSqr(),v=this.y.redSqr(),_=this.x.redMul(v),m=this.x.redSub(l).redMul(this.x.redAdd(l));m=m.redAdd(m).redIAdd(m);var $=_.redIAdd(_);$=$.redIAdd($);var O=$.redAdd($);e=m.redSqr().redISub(O),i=this.y.redAdd(this.z).redSqr().redISub(v).redISub(l);var D=v.redSqr();D=D.redIAdd(D),D=D.redIAdd(D),D=D.redIAdd(D),r=m.redMul($.redISub(e)).redISub(D)}return this.curve.jpoint(e,r,i)};Et.prototype._dbl=function(){var e=this.curve.a,r=this.x,i=this.y,s=this.z,n=s.redSqr().redSqr(),a=r.redSqr(),o=i.redSqr(),c=a.redAdd(a).redIAdd(a).redIAdd(e.redMul(n)),h=r.redAdd(r);h=h.redIAdd(h);var f=h.redMul(o),l=c.redSqr().redISub(f.redAdd(f)),v=f.redISub(l),_=o.redSqr();_=_.redIAdd(_),_=_.redIAdd(_),_=_.redIAdd(_);var m=c.redMul(v).redISub(_),$=i.redAdd(i).redMul(s);return this.curve.jpoint(l,m,$)};Et.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),r=this.y.redSqr(),i=this.z.redSqr(),s=r.redSqr(),n=e.redAdd(e).redIAdd(e),a=n.redSqr(),o=this.x.redAdd(r).redSqr().redISub(e).redISub(s);o=o.redIAdd(o),o=o.redAdd(o).redIAdd(o),o=o.redISub(a);var c=o.redSqr(),h=s.redIAdd(s);h=h.redIAdd(h),h=h.redIAdd(h),h=h.redIAdd(h);var f=n.redIAdd(o).redSqr().redISub(a).redISub(c).redISub(h),l=r.redMul(f);l=l.redIAdd(l),l=l.redIAdd(l);var v=this.x.redMul(c).redISub(l);v=v.redIAdd(v),v=v.redIAdd(v);var _=this.y.redMul(f.redMul(h.redISub(f)).redISub(o.redMul(c)));_=_.redIAdd(_),_=_.redIAdd(_),_=_.redIAdd(_);var m=this.z.redAdd(o).redSqr().redISub(i).redISub(c);return this.curve.jpoint(v,_,m)};Et.prototype.mul=function(e,r){return e=new et(e,r),this.curve._wnafMul(this,e)};Et.prototype.eq=function(e){if(e.type==="affine")return this.eq(e.toJ());if(this===e)return!0;var r=this.z.redSqr(),i=e.z.redSqr();if(this.x.redMul(i).redISub(e.x.redMul(r)).cmpn(0)!==0)return!1;var s=r.redMul(this.z),n=i.redMul(e.z);return this.y.redMul(n).redISub(e.y.redMul(s)).cmpn(0)===0};Et.prototype.eqXToP=function(e){var r=this.z.redSqr(),i=e.toRed(this.curve.red).redMul(r);if(this.x.cmp(i)===0)return!0;for(var s=e.clone(),n=this.curve.redN.redMul(r);;){if(s.iadd(this.curve.n),s.cmp(this.curve.p)>=0)return!1;if(i.redIAdd(n),this.x.cmp(i)===0)return!0}};Et.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"};Et.prototype.isInfinity=function(){return this.z.cmpn(0)===0};var As=ei,mp=ro,uo=ho,A2=Wt;function zs(t){uo.call(this,"mont",t),this.a=new As(t.a,16).toRed(this.red),this.b=new As(t.b,16).toRed(this.red),this.i4=new As(4).toRed(this.red).redInvm(),this.two=new As(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}mp(zs,uo);var D2=zs;zs.prototype.validate=function(e){var r=e.normalize().x,i=r.redSqr(),s=i.redMul(r).redAdd(i.redMul(this.a)).redAdd(r),n=s.redSqrt();return n.redSqr().cmp(s)===0};function lt(t,e,r){uo.BasePoint.call(this,t,"projective"),e===null&&r===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new As(e,16),this.z=new As(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}mp(lt,uo.BasePoint);zs.prototype.decodePoint=function(e,r){return this.point(A2.toArray(e,r),1)};zs.prototype.point=function(e,r){return new lt(this,e,r)};zs.prototype.pointFromJSON=function(e){return lt.fromJSON(this,e)};lt.prototype.precompute=function(){};lt.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())};lt.fromJSON=function(e,r){return new lt(e,r[0],r[1]||e.one)};lt.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};lt.prototype.isInfinity=function(){return this.z.cmpn(0)===0};lt.prototype.dbl=function(){var e=this.x.redAdd(this.z),r=e.redSqr(),i=this.x.redSub(this.z),s=i.redSqr(),n=r.redSub(s),a=r.redMul(s),o=n.redMul(s.redAdd(this.curve.a24.redMul(n)));return this.curve.point(a,o)};lt.prototype.add=function(){throw new Error("Not supported on Montgomery curve")};lt.prototype.diffAdd=function(e,r){var i=this.x.redAdd(this.z),s=this.x.redSub(this.z),n=e.x.redAdd(e.z),a=e.x.redSub(e.z),o=a.redMul(i),c=n.redMul(s),h=r.z.redMul(o.redAdd(c).redSqr()),f=r.x.redMul(o.redISub(c).redSqr());return this.curve.point(h,f)};lt.prototype.mul=function(e){for(var r=e.clone(),i=this,s=this.curve.point(null,null),n=this,a=[];r.cmpn(0)!==0;r.iushrn(1))a.push(r.andln(1));for(var o=a.length-1;o>=0;o--)a[o]===0?(i=i.diffAdd(s,n),s=s.dbl()):(s=i.diffAdd(s,n),i=i.dbl());return s};lt.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")};lt.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")};lt.prototype.eq=function(e){return this.getX().cmp(e.getX())===0};lt.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this};lt.prototype.getX=function(){return this.normalize(),this.x.fromRed()};var P2=Wt,Jr=ei,wp=ro,fo=ho,O2=P2.assert;function qr(t){this.twisted=(t.a|0)!==1,this.mOneA=this.twisted&&(t.a|0)===-1,this.extended=this.mOneA,fo.call(this,"edwards",t),this.a=new Jr(t.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new Jr(t.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new Jr(t.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),O2(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=(t.c|0)===1}wp(qr,fo);var M2=qr;qr.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)};qr.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)};qr.prototype.jpoint=function(e,r,i,s){return this.point(e,r,i,s)};qr.prototype.pointFromX=function(e,r){e=new Jr(e,16),e.red||(e=e.toRed(this.red));var i=e.redSqr(),s=this.c2.redSub(this.a.redMul(i)),n=this.one.redSub(this.c2.redMul(this.d).redMul(i)),a=s.redMul(n.redInvm()),o=a.redSqrt();if(o.redSqr().redSub(a).cmp(this.zero)!==0)throw new Error("invalid point");var c=o.fromRed().isOdd();return(r&&!c||!r&&c)&&(o=o.redNeg()),this.point(e,o)};qr.prototype.pointFromY=function(e,r){e=new Jr(e,16),e.red||(e=e.toRed(this.red));var i=e.redSqr(),s=i.redSub(this.c2),n=i.redMul(this.d).redMul(this.c2).redSub(this.a),a=s.redMul(n.redInvm());if(a.cmp(this.zero)===0){if(r)throw new Error("invalid point");return this.point(this.zero,e)}var o=a.redSqrt();if(o.redSqr().redSub(a).cmp(this.zero)!==0)throw new Error("invalid point");return o.fromRed().isOdd()!==r&&(o=o.redNeg()),this.point(o,e)};qr.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var r=e.x.redSqr(),i=e.y.redSqr(),s=r.redMul(this.a).redAdd(i),n=this.c2.redMul(this.one.redAdd(this.d.redMul(r).redMul(i)));return s.cmp(n)===0};function Ee(t,e,r,i,s){fo.BasePoint.call(this,t,"projective"),e===null&&r===null&&i===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new Jr(e,16),this.y=new Jr(r,16),this.z=i?new Jr(i,16):this.curve.one,this.t=s&&new Jr(s,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}wp(Ee,fo.BasePoint);qr.prototype.pointFromJSON=function(e){return Ee.fromJSON(this,e)};qr.prototype.point=function(e,r,i,s){return new Ee(this,e,r,i,s)};Ee.fromJSON=function(e,r){return new Ee(e,r[0],r[1],r[2])};Ee.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};Ee.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)};Ee.prototype._extDbl=function(){var e=this.x.redSqr(),r=this.y.redSqr(),i=this.z.redSqr();i=i.redIAdd(i);var s=this.curve._mulA(e),n=this.x.redAdd(this.y).redSqr().redISub(e).redISub(r),a=s.redAdd(r),o=a.redSub(i),c=s.redSub(r),h=n.redMul(o),f=a.redMul(c),l=n.redMul(c),v=o.redMul(a);return this.curve.point(h,f,v,l)};Ee.prototype._projDbl=function(){var e=this.x.redAdd(this.y).redSqr(),r=this.x.redSqr(),i=this.y.redSqr(),s,n,a,o,c,h;if(this.curve.twisted){o=this.curve._mulA(r);var f=o.redAdd(i);this.zOne?(s=e.redSub(r).redSub(i).redMul(f.redSub(this.curve.two)),n=f.redMul(o.redSub(i)),a=f.redSqr().redSub(f).redSub(f)):(c=this.z.redSqr(),h=f.redSub(c).redISub(c),s=e.redSub(r).redISub(i).redMul(h),n=f.redMul(o.redSub(i)),a=f.redMul(h))}else o=r.redAdd(i),c=this.curve._mulC(this.z).redSqr(),h=o.redSub(c).redSub(c),s=this.curve._mulC(e.redISub(o)).redMul(h),n=this.curve._mulC(o).redMul(r.redISub(i)),a=o.redMul(h);return this.curve.point(s,n,a)};Ee.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()};Ee.prototype._extAdd=function(e){var r=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),i=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),s=this.t.redMul(this.curve.dd).redMul(e.t),n=this.z.redMul(e.z.redAdd(e.z)),a=i.redSub(r),o=n.redSub(s),c=n.redAdd(s),h=i.redAdd(r),f=a.redMul(o),l=c.redMul(h),v=a.redMul(h),_=o.redMul(c);return this.curve.point(f,l,_,v)};Ee.prototype._projAdd=function(e){var r=this.z.redMul(e.z),i=r.redSqr(),s=this.x.redMul(e.x),n=this.y.redMul(e.y),a=this.curve.d.redMul(s).redMul(n),o=i.redSub(a),c=i.redAdd(a),h=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(s).redISub(n),f=r.redMul(o).redMul(h),l,v;return this.curve.twisted?(l=r.redMul(c).redMul(n.redSub(this.curve._mulA(s))),v=o.redMul(c)):(l=r.redMul(c).redMul(n.redSub(s)),v=this.curve._mulC(o).redMul(c)),this.curve.point(f,l,v)};Ee.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)};Ee.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)};Ee.prototype.mulAdd=function(e,r,i){return this.curve._wnafMulAdd(1,[this,r],[e,i],2,!1)};Ee.prototype.jmulAdd=function(e,r,i){return this.curve._wnafMulAdd(1,[this,r],[e,i],2,!0)};Ee.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this};Ee.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())};Ee.prototype.getX=function(){return this.normalize(),this.x.fromRed()};Ee.prototype.getY=function(){return this.normalize(),this.y.fromRed()};Ee.prototype.eq=function(e){return this===e||this.getX().cmp(e.getX())===0&&this.getY().cmp(e.getY())===0};Ee.prototype.eqXToP=function(e){var r=e.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(r)===0)return!0;for(var i=e.clone(),s=this.curve.redN.redMul(this.z);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(s),this.x.cmp(r)===0)return!0}};Ee.prototype.toP=Ee.prototype.normalize;Ee.prototype.mixedAdd=Ee.prototype.add;(function(t){var e=t;e.base=ho,e.short=I2,e.mont=D2,e.edwards=M2})(Ch);var lo={},po={},re={},C2=Hi,T2=ro;re.inherits=T2;function R2(t,e){return(t.charCodeAt(e)&64512)!==55296||e<0||e+1>=t.length?!1:(t.charCodeAt(e+1)&64512)===56320}function N2(t,e){if(Array.isArray(t))return t.slice();if(!t)return[];var r=[];if(typeof t=="string")if(e){if(e==="hex")for(t=t.replace(/[^a-z0-9]+/ig,""),t.length%2!==0&&(t="0"+t),s=0;s<t.length;s+=2)r.push(parseInt(t[s]+t[s+1],16))}else for(var i=0,s=0;s<t.length;s++){var n=t.charCodeAt(s);n<128?r[i++]=n:n<2048?(r[i++]=n>>6|192,r[i++]=n&63|128):R2(t,s)?(n=65536+((n&1023)<<10)+(t.charCodeAt(++s)&1023),r[i++]=n>>18|240,r[i++]=n>>12&63|128,r[i++]=n>>6&63|128,r[i++]=n&63|128):(r[i++]=n>>12|224,r[i++]=n>>6&63|128,r[i++]=n&63|128)}else for(s=0;s<t.length;s++)r[s]=t[s]|0;return r}re.toArray=N2;function F2(t){for(var e="",r=0;r<t.length;r++)e+=Ep(t[r].toString(16));return e}re.toHex=F2;function _p(t){var e=t>>>24|t>>>8&65280|t<<8&16711680|(t&255)<<24;return e>>>0}re.htonl=_p;function B2(t,e){for(var r="",i=0;i<t.length;i++){var s=t[i];e==="little"&&(s=_p(s)),r+=xp(s.toString(16))}return r}re.toHex32=B2;function Ep(t){return t.length===1?"0"+t:t}re.zero2=Ep;function xp(t){return t.length===7?"0"+t:t.length===6?"00"+t:t.length===5?"000"+t:t.length===4?"0000"+t:t.length===3?"00000"+t:t.length===2?"000000"+t:t.length===1?"0000000"+t:t}re.zero8=xp;function q2(t,e,r,i){var s=r-e;C2(s%4===0);for(var n=new Array(s/4),a=0,o=e;a<n.length;a++,o+=4){var c;i==="big"?c=t[o]<<24|t[o+1]<<16|t[o+2]<<8|t[o+3]:c=t[o+3]<<24|t[o+2]<<16|t[o+1]<<8|t[o],n[a]=c>>>0}return n}re.join32=q2;function L2(t,e){for(var r=new Array(t.length*4),i=0,s=0;i<t.length;i++,s+=4){var n=t[i];e==="big"?(r[s]=n>>>24,r[s+1]=n>>>16&255,r[s+2]=n>>>8&255,r[s+3]=n&255):(r[s+3]=n>>>24,r[s+2]=n>>>16&255,r[s+1]=n>>>8&255,r[s]=n&255)}return r}re.split32=L2;function j2(t,e){return t>>>e|t<<32-e}re.rotr32=j2;function U2(t,e){return t<<e|t>>>32-e}re.rotl32=U2;function z2(t,e){return t+e>>>0}re.sum32=z2;function k2(t,e,r){return t+e+r>>>0}re.sum32_3=k2;function H2(t,e,r,i){return t+e+r+i>>>0}re.sum32_4=H2;function K2(t,e,r,i,s){return t+e+r+i+s>>>0}re.sum32_5=K2;function V2(t,e,r,i){var s=t[e],n=t[e+1],a=i+n>>>0,o=(a<i?1:0)+r+s;t[e]=o>>>0,t[e+1]=a}re.sum64=V2;function W2(t,e,r,i){var s=e+i>>>0,n=(s<e?1:0)+t+r;return n>>>0}re.sum64_hi=W2;function G2(t,e,r,i){var s=e+i;return s>>>0}re.sum64_lo=G2;function J2(t,e,r,i,s,n,a,o){var c=0,h=e;h=h+i>>>0,c+=h<e?1:0,h=h+n>>>0,c+=h<n?1:0,h=h+o>>>0,c+=h<o?1:0;var f=t+r+s+a+c;return f>>>0}re.sum64_4_hi=J2;function Y2(t,e,r,i,s,n,a,o){var c=e+i+n+o;return c>>>0}re.sum64_4_lo=Y2;function X2(t,e,r,i,s,n,a,o,c,h){var f=0,l=e;l=l+i>>>0,f+=l<e?1:0,l=l+n>>>0,f+=l<n?1:0,l=l+o>>>0,f+=l<o?1:0,l=l+h>>>0,f+=l<h?1:0;var v=t+r+s+a+c+f;return v>>>0}re.sum64_5_hi=X2;function Z2(t,e,r,i,s,n,a,o,c,h){var f=e+i+n+o+h;return f>>>0}re.sum64_5_lo=Z2;function Q2(t,e,r){var i=e<<32-r|t>>>r;return i>>>0}re.rotr64_hi=Q2;function e3(t,e,r){var i=t<<32-r|e>>>r;return i>>>0}re.rotr64_lo=e3;function t3(t,e,r){return t>>>r}re.shr64_hi=t3;function r3(t,e,r){var i=t<<32-r|e>>>r;return i>>>0}re.shr64_lo=r3;var ks={},ef=re,i3=Hi;function bo(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}ks.BlockHash=bo;bo.prototype.update=function(e,r){if(e=ef.toArray(e,r),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){e=this.pending;var i=e.length%this._delta8;this.pending=e.slice(e.length-i,e.length),this.pending.length===0&&(this.pending=null),e=ef.join32(e,0,e.length-i,this.endian);for(var s=0;s<e.length;s+=this._delta32)this._update(e,s,s+this._delta32)}return this};bo.prototype.digest=function(e){return this.update(this._pad()),i3(this.pending===null),this._digest(e)};bo.prototype._pad=function(){var e=this.pendingTotal,r=this._delta8,i=r-(e+this.padLength)%r,s=new Array(i+this.padLength);s[0]=128;for(var n=1;n<i;n++)s[n]=0;if(e<<=3,this.endian==="big"){for(var a=8;a<this.padLength;a++)s[n++]=0;s[n++]=0,s[n++]=0,s[n++]=0,s[n++]=0,s[n++]=e>>>24&255,s[n++]=e>>>16&255,s[n++]=e>>>8&255,s[n++]=e&255}else for(s[n++]=e&255,s[n++]=e>>>8&255,s[n++]=e>>>16&255,s[n++]=e>>>24&255,s[n++]=0,s[n++]=0,s[n++]=0,s[n++]=0,a=8;a<this.padLength;a++)s[n++]=0;return s};var Hs={},Lr={},s3=re,Pr=s3.rotr32;function n3(t,e,r,i){if(t===0)return $p(e,r,i);if(t===1||t===3)return Ip(e,r,i);if(t===2)return Sp(e,r,i)}Lr.ft_1=n3;function $p(t,e,r){return t&e^~t&r}Lr.ch32=$p;function Sp(t,e,r){return t&e^t&r^e&r}Lr.maj32=Sp;function Ip(t,e,r){return t^e^r}Lr.p32=Ip;function a3(t){return Pr(t,2)^Pr(t,13)^Pr(t,22)}Lr.s0_256=a3;function o3(t){return Pr(t,6)^Pr(t,11)^Pr(t,25)}Lr.s1_256=o3;function c3(t){return Pr(t,7)^Pr(t,18)^t>>>3}Lr.g0_256=c3;function h3(t){return Pr(t,17)^Pr(t,19)^t>>>10}Lr.g1_256=h3;var Os=re,u3=ks,f3=Lr,Qo=Os.rotl32,wn=Os.sum32,d3=Os.sum32_5,l3=f3.ft_1,Ap=u3.BlockHash,p3=[1518500249,1859775393,2400959708,3395469782];function Tr(){if(!(this instanceof Tr))return new Tr;Ap.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}Os.inherits(Tr,Ap);var b3=Tr;Tr.blockSize=512;Tr.outSize=160;Tr.hmacStrength=80;Tr.padLength=64;Tr.prototype._update=function(e,r){for(var i=this.W,s=0;s<16;s++)i[s]=e[r+s];for(;s<i.length;s++)i[s]=Qo(i[s-3]^i[s-8]^i[s-14]^i[s-16],1);var n=this.h[0],a=this.h[1],o=this.h[2],c=this.h[3],h=this.h[4];for(s=0;s<i.length;s++){var f=~~(s/20),l=d3(Qo(n,5),l3(f,a,o,c),h,i[s],p3[f]);h=c,c=o,o=Qo(a,30),a=n,n=l}this.h[0]=wn(this.h[0],n),this.h[1]=wn(this.h[1],a),this.h[2]=wn(this.h[2],o),this.h[3]=wn(this.h[3],c),this.h[4]=wn(this.h[4],h)};Tr.prototype._digest=function(e){return e==="hex"?Os.toHex32(this.h,"big"):Os.split32(this.h,"big")};var Ms=re,g3=ks,Ks=Lr,v3=Hi,fr=Ms.sum32,y3=Ms.sum32_4,m3=Ms.sum32_5,w3=Ks.ch32,_3=Ks.maj32,E3=Ks.s0_256,x3=Ks.s1_256,$3=Ks.g0_256,S3=Ks.g1_256,Dp=g3.BlockHash,I3=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Rr(){if(!(this instanceof Rr))return new Rr;Dp.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=I3,this.W=new Array(64)}Ms.inherits(Rr,Dp);var Pp=Rr;Rr.blockSize=512;Rr.outSize=256;Rr.hmacStrength=192;Rr.padLength=64;Rr.prototype._update=function(e,r){for(var i=this.W,s=0;s<16;s++)i[s]=e[r+s];for(;s<i.length;s++)i[s]=y3(S3(i[s-2]),i[s-7],$3(i[s-15]),i[s-16]);var n=this.h[0],a=this.h[1],o=this.h[2],c=this.h[3],h=this.h[4],f=this.h[5],l=this.h[6],v=this.h[7];for(v3(this.k.length===i.length),s=0;s<i.length;s++){var _=m3(v,x3(h),w3(h,f,l),this.k[s],i[s]),m=fr(E3(n),_3(n,a,o));v=l,l=f,f=h,h=fr(c,_),c=o,o=a,a=n,n=fr(_,m)}this.h[0]=fr(this.h[0],n),this.h[1]=fr(this.h[1],a),this.h[2]=fr(this.h[2],o),this.h[3]=fr(this.h[3],c),this.h[4]=fr(this.h[4],h),this.h[5]=fr(this.h[5],f),this.h[6]=fr(this.h[6],l),this.h[7]=fr(this.h[7],v)};Rr.prototype._digest=function(e){return e==="hex"?Ms.toHex32(this.h,"big"):Ms.split32(this.h,"big")};var Lc=re,Op=Pp;function Zr(){if(!(this instanceof Zr))return new Zr;Op.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}Lc.inherits(Zr,Op);var A3=Zr;Zr.blockSize=512;Zr.outSize=224;Zr.hmacStrength=192;Zr.padLength=64;Zr.prototype._digest=function(e){return e==="hex"?Lc.toHex32(this.h.slice(0,7),"big"):Lc.split32(this.h.slice(0,7),"big")};var Bt=re,D3=ks,P3=Hi,Or=Bt.rotr64_hi,Mr=Bt.rotr64_lo,Mp=Bt.shr64_hi,Cp=Bt.shr64_lo,oi=Bt.sum64,ec=Bt.sum64_hi,tc=Bt.sum64_lo,O3=Bt.sum64_4_hi,M3=Bt.sum64_4_lo,C3=Bt.sum64_5_hi,T3=Bt.sum64_5_lo,Tp=D3.BlockHash,R3=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function yr(){if(!(this instanceof yr))return new yr;Tp.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=R3,this.W=new Array(160)}Bt.inherits(yr,Tp);var Rp=yr;yr.blockSize=1024;yr.outSize=512;yr.hmacStrength=192;yr.padLength=128;yr.prototype._prepareBlock=function(e,r){for(var i=this.W,s=0;s<32;s++)i[s]=e[r+s];for(;s<i.length;s+=2){var n=K3(i[s-4],i[s-3]),a=V3(i[s-4],i[s-3]),o=i[s-14],c=i[s-13],h=k3(i[s-30],i[s-29]),f=H3(i[s-30],i[s-29]),l=i[s-32],v=i[s-31];i[s]=O3(n,a,o,c,h,f,l,v),i[s+1]=M3(n,a,o,c,h,f,l,v)}};yr.prototype._update=function(e,r){this._prepareBlock(e,r);var i=this.W,s=this.h[0],n=this.h[1],a=this.h[2],o=this.h[3],c=this.h[4],h=this.h[5],f=this.h[6],l=this.h[7],v=this.h[8],_=this.h[9],m=this.h[10],$=this.h[11],O=this.h[12],D=this.h[13],P=this.h[14],C=this.h[15];P3(this.k.length===i.length);for(var T=0;T<i.length;T+=2){var N=P,z=C,H=U3(v,_),U=z3(v,_),B=N3(v,_,m,$,O),J=F3(v,_,m,$,O,D),S=this.k[T],u=this.k[T+1],b=i[T],w=i[T+1],p=C3(N,z,H,U,B,J,S,u,b,w),g=T3(N,z,H,U,B,J,S,u,b,w);N=L3(s,n),z=j3(s,n),H=B3(s,n,a,o,c),U=q3(s,n,a,o,c,h);var E=ec(N,z,H,U),I=tc(N,z,H,U);P=O,C=D,O=m,D=$,m=v,$=_,v=ec(f,l,p,g),_=tc(l,l,p,g),f=c,l=h,c=a,h=o,a=s,o=n,s=ec(p,g,E,I),n=tc(p,g,E,I)}oi(this.h,0,s,n),oi(this.h,2,a,o),oi(this.h,4,c,h),oi(this.h,6,f,l),oi(this.h,8,v,_),oi(this.h,10,m,$),oi(this.h,12,O,D),oi(this.h,14,P,C)};yr.prototype._digest=function(e){return e==="hex"?Bt.toHex32(this.h,"big"):Bt.split32(this.h,"big")};function N3(t,e,r,i,s){var n=t&r^~t&s;return n<0&&(n+=4294967296),n}function F3(t,e,r,i,s,n){var a=e&i^~e&n;return a<0&&(a+=4294967296),a}function B3(t,e,r,i,s){var n=t&r^t&s^r&s;return n<0&&(n+=4294967296),n}function q3(t,e,r,i,s,n){var a=e&i^e&n^i&n;return a<0&&(a+=4294967296),a}function L3(t,e){var r=Or(t,e,28),i=Or(e,t,2),s=Or(e,t,7),n=r^i^s;return n<0&&(n+=4294967296),n}function j3(t,e){var r=Mr(t,e,28),i=Mr(e,t,2),s=Mr(e,t,7),n=r^i^s;return n<0&&(n+=4294967296),n}function U3(t,e){var r=Or(t,e,14),i=Or(t,e,18),s=Or(e,t,9),n=r^i^s;return n<0&&(n+=4294967296),n}function z3(t,e){var r=Mr(t,e,14),i=Mr(t,e,18),s=Mr(e,t,9),n=r^i^s;return n<0&&(n+=4294967296),n}function k3(t,e){var r=Or(t,e,1),i=Or(t,e,8),s=Mp(t,e,7),n=r^i^s;return n<0&&(n+=4294967296),n}function H3(t,e){var r=Mr(t,e,1),i=Mr(t,e,8),s=Cp(t,e,7),n=r^i^s;return n<0&&(n+=4294967296),n}function K3(t,e){var r=Or(t,e,19),i=Or(e,t,29),s=Mp(t,e,6),n=r^i^s;return n<0&&(n+=4294967296),n}function V3(t,e){var r=Mr(t,e,19),i=Mr(e,t,29),s=Cp(t,e,6),n=r^i^s;return n<0&&(n+=4294967296),n}var jc=re,Np=Rp;function Qr(){if(!(this instanceof Qr))return new Qr;Np.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}jc.inherits(Qr,Np);var W3=Qr;Qr.blockSize=1024;Qr.outSize=384;Qr.hmacStrength=192;Qr.padLength=128;Qr.prototype._digest=function(e){return e==="hex"?jc.toHex32(this.h.slice(0,12),"big"):jc.split32(this.h.slice(0,12),"big")};Hs.sha1=b3;Hs.sha224=A3;Hs.sha256=Pp;Hs.sha384=W3;Hs.sha512=Rp;var Fp={},ji=re,G3=ks,ma=ji.rotl32,tf=ji.sum32,_n=ji.sum32_3,rf=ji.sum32_4,Bp=G3.BlockHash;function Nr(){if(!(this instanceof Nr))return new Nr;Bp.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}ji.inherits(Nr,Bp);Fp.ripemd160=Nr;Nr.blockSize=512;Nr.outSize=160;Nr.hmacStrength=192;Nr.padLength=64;Nr.prototype._update=function(e,r){for(var i=this.h[0],s=this.h[1],n=this.h[2],a=this.h[3],o=this.h[4],c=i,h=s,f=n,l=a,v=o,_=0;_<80;_++){var m=tf(ma(rf(i,sf(_,s,n,a),e[X3[_]+r],J3(_)),Q3[_]),o);i=o,o=a,a=ma(n,10),n=s,s=m,m=tf(ma(rf(c,sf(79-_,h,f,l),e[Z3[_]+r],Y3(_)),ew[_]),v),c=v,v=l,l=ma(f,10),f=h,h=m}m=_n(this.h[1],n,l),this.h[1]=_n(this.h[2],a,v),this.h[2]=_n(this.h[3],o,c),this.h[3]=_n(this.h[4],i,h),this.h[4]=_n(this.h[0],s,f),this.h[0]=m};Nr.prototype._digest=function(e){return e==="hex"?ji.toHex32(this.h,"little"):ji.split32(this.h,"little")};function sf(t,e,r,i){return t<=15?e^r^i:t<=31?e&r|~e&i:t<=47?(e|~r)^i:t<=63?e&i|r&~i:e^(r|~i)}function J3(t){return t<=15?0:t<=31?1518500249:t<=47?1859775393:t<=63?2400959708:2840853838}function Y3(t){return t<=15?1352829926:t<=31?1548603684:t<=47?1836072691:t<=63?2053994217:0}var X3=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],Z3=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],Q3=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],ew=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],tw=re,rw=Hi;function Cs(t,e,r){if(!(this instanceof Cs))return new Cs(t,e,r);this.Hash=t,this.blockSize=t.blockSize/8,this.outSize=t.outSize/8,this.inner=null,this.outer=null,this._init(tw.toArray(e,r))}var iw=Cs;Cs.prototype._init=function(e){e.length>this.blockSize&&(e=new this.Hash().update(e).digest()),rw(e.length<=this.blockSize);for(var r=e.length;r<this.blockSize;r++)e.push(0);for(r=0;r<e.length;r++)e[r]^=54;for(this.inner=new this.Hash().update(e),r=0;r<e.length;r++)e[r]^=106;this.outer=new this.Hash().update(e)};Cs.prototype.update=function(e,r){return this.inner.update(e,r),this};Cs.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)};(function(t){var e=t;e.utils=re,e.common=ks,e.sha=Hs,e.ripemd=Fp,e.hmac=iw,e.sha1=e.sha.sha1,e.sha256=e.sha.sha256,e.sha224=e.sha.sha224,e.sha384=e.sha.sha384,e.sha512=e.sha.sha512,e.ripemd160=e.ripemd.ripemd160})(po);var rc,nf;function sw(){return nf||(nf=1,rc={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}),rc}(function(t){var e=t,r=po,i=Ch,s=Wt,n=s.assert;function a(h){h.type==="short"?this.curve=new i.short(h):h.type==="edwards"?this.curve=new i.edwards(h):this.curve=new i.mont(h),this.g=this.curve.g,this.n=this.curve.n,this.hash=h.hash,n(this.g.validate(),"Invalid curve"),n(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}e.PresetCurve=a;function o(h,f){Object.defineProperty(e,h,{configurable:!0,enumerable:!0,get:function(){var l=new a(f);return Object.defineProperty(e,h,{configurable:!0,enumerable:!0,value:l}),l}})}o("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:r.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),o("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:r.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),o("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:r.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),o("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:r.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),o("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:r.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),o("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:r.sha256,gRed:!1,g:["9"]}),o("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:r.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var c;try{c=sw()}catch{c=void 0}o("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:r.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",c]})})(lo);var nw=po,Bi=Oh,qp=Hi;function gi(t){if(!(this instanceof gi))return new gi(t);this.hash=t.hash,this.predResist=!!t.predResist,this.outLen=this.hash.outSize,this.minEntropy=t.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var e=Bi.toArray(t.entropy,t.entropyEnc||"hex"),r=Bi.toArray(t.nonce,t.nonceEnc||"hex"),i=Bi.toArray(t.pers,t.persEnc||"hex");qp(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(e,r,i)}var aw=gi;gi.prototype._init=function(e,r,i){var s=e.concat(r).concat(i);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var n=0;n<this.V.length;n++)this.K[n]=0,this.V[n]=1;this._update(s),this._reseed=1,this.reseedInterval=281474976710656};gi.prototype._hmac=function(){return new nw.hmac(this.hash,this.K)};gi.prototype._update=function(e){var r=this._hmac().update(this.V).update([0]);e&&(r=r.update(e)),this.K=r.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())};gi.prototype.reseed=function(e,r,i,s){typeof r!="string"&&(s=i,i=r,r=null),e=Bi.toArray(e,r),i=Bi.toArray(i,s),qp(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(i||[])),this._reseed=1};gi.prototype.generate=function(e,r,i,s){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof r!="string"&&(s=i,i=r,r=null),i&&(i=Bi.toArray(i,s||"hex"),this._update(i));for(var n=[];n.length<e;)this.V=this._hmac().update(this.V).digest(),n=n.concat(this.V);var a=n.slice(0,e);return this._update(i),this._reseed++,Bi.encode(a,r)};var ow=ei,cw=Wt,Uc=cw.assert;function It(t,e){this.ec=t,this.priv=null,this.pub=null,e.priv&&this._importPrivate(e.priv,e.privEnc),e.pub&&this._importPublic(e.pub,e.pubEnc)}var hw=It;It.fromPublic=function(e,r,i){return r instanceof It?r:new It(e,{pub:r,pubEnc:i})};It.fromPrivate=function(e,r,i){return r instanceof It?r:new It(e,{priv:r,privEnc:i})};It.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}};It.prototype.getPublic=function(e,r){return typeof e=="string"&&(r=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),r?this.pub.encode(r,e):this.pub};It.prototype.getPrivate=function(e){return e==="hex"?this.priv.toString(16,2):this.priv};It.prototype._importPrivate=function(e,r){this.priv=new ow(e,r||16),this.priv=this.priv.umod(this.ec.curve.n)};It.prototype._importPublic=function(e,r){if(e.x||e.y){this.ec.curve.type==="mont"?Uc(e.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&Uc(e.x&&e.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(e.x,e.y);return}this.pub=this.ec.curve.decodePoint(e,r)};It.prototype.derive=function(e){return e.validate()||Uc(e.validate(),"public point not validated"),e.mul(this.priv).getX()};It.prototype.sign=function(e,r,i){return this.ec.sign(e,this,r,i)};It.prototype.verify=function(e,r,i){return this.ec.verify(e,r,this,void 0,i)};It.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"};var Ha=ei,Rh=Wt,uw=Rh.assert;function go(t,e){if(t instanceof go)return t;this._importDER(t,e)||(uw(t.r&&t.s,"Signature without r or s"),this.r=new Ha(t.r,16),this.s=new Ha(t.s,16),t.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=t.recoveryParam)}var fw=go;function dw(){this.place=0}function ic(t,e){var r=t[e.place++];if(!(r&128))return r;var i=r&15;if(i===0||i>4||t[e.place]===0)return!1;for(var s=0,n=0,a=e.place;n<i;n++,a++)s<<=8,s|=t[a],s>>>=0;return s<=127?!1:(e.place=a,s)}function af(t){for(var e=0,r=t.length-1;!t[e]&&!(t[e+1]&128)&&e<r;)e++;return e===0?t:t.slice(e)}go.prototype._importDER=function(e,r){e=Rh.toArray(e,r);var i=new dw;if(e[i.place++]!==48)return!1;var s=ic(e,i);if(s===!1||s+i.place!==e.length||e[i.place++]!==2)return!1;var n=ic(e,i);if(n===!1||e[i.place]&128)return!1;var a=e.slice(i.place,n+i.place);if(i.place+=n,e[i.place++]!==2)return!1;var o=ic(e,i);if(o===!1||e.length!==o+i.place||e[i.place]&128)return!1;var c=e.slice(i.place,o+i.place);if(a[0]===0)if(a[1]&128)a=a.slice(1);else return!1;if(c[0]===0)if(c[1]&128)c=c.slice(1);else return!1;return this.r=new Ha(a),this.s=new Ha(c),this.recoveryParam=null,!0};function sc(t,e){if(e<128){t.push(e);return}var r=1+(Math.log(e)/Math.LN2>>>3);for(t.push(r|128);--r;)t.push(e>>>(r<<3)&255);t.push(e)}go.prototype.toDER=function(e){var r=this.r.toArray(),i=this.s.toArray();for(r[0]&128&&(r=[0].concat(r)),i[0]&128&&(i=[0].concat(i)),r=af(r),i=af(i);!i[0]&&!(i[1]&128);)i=i.slice(1);var s=[2];sc(s,r.length),s=s.concat(r),s.push(2),sc(s,i.length);var n=s.concat(i),a=[48];return sc(a,n.length),a=a.concat(n),Rh.encode(a,e)};var vr=ei,Lp=aw,lw=Wt,nc=lo,pw=yp,Ti=lw.assert,Nh=hw,vo=fw;function rr(t){if(!(this instanceof rr))return new rr(t);typeof t=="string"&&(Ti(Object.prototype.hasOwnProperty.call(nc,t),"Unknown curve "+t),t=nc[t]),t instanceof nc.PresetCurve&&(t={curve:t}),this.curve=t.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=t.curve.g,this.g.precompute(t.curve.n.bitLength()+1),this.hash=t.hash||t.curve.hash}var bw=rr;rr.prototype.keyPair=function(e){return new Nh(this,e)};rr.prototype.keyFromPrivate=function(e,r){return Nh.fromPrivate(this,e,r)};rr.prototype.keyFromPublic=function(e,r){return Nh.fromPublic(this,e,r)};rr.prototype.genKeyPair=function(e){e||(e={});for(var r=new Lp({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||pw(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),i=this.n.byteLength(),s=this.n.sub(new vr(2));;){var n=new vr(r.generate(i));if(!(n.cmp(s)>0))return n.iaddn(1),this.keyFromPrivate(n)}};rr.prototype._truncateToN=function(e,r,i){var s;if(vr.isBN(e)||typeof e=="number")e=new vr(e,16),s=e.byteLength();else if(typeof e=="object")s=e.length,e=new vr(e,16);else{var n=e.toString();s=n.length+1>>>1,e=new vr(n,16)}typeof i!="number"&&(i=s*8);var a=i-this.n.bitLength();return a>0&&(e=e.ushrn(a)),!r&&e.cmp(this.n)>=0?e.sub(this.n):e};rr.prototype.sign=function(e,r,i,s){if(typeof i=="object"&&(s=i,i=null),s||(s={}),typeof e!="string"&&typeof e!="number"&&!vr.isBN(e)){Ti(typeof e=="object"&&e&&typeof e.length=="number","Expected message to be an array-like, a hex string, or a BN instance"),Ti(e.length>>>0===e.length);for(var n=0;n<e.length;n++)Ti((e[n]&255)===e[n])}r=this.keyFromPrivate(r,i),e=this._truncateToN(e,!1,s.msgBitLength),Ti(!e.isNeg(),"Can not sign a negative message");var a=this.n.byteLength(),o=r.getPrivate().toArray("be",a),c=e.toArray("be",a);Ti(new vr(c).eq(e),"Can not sign message");for(var h=new Lp({hash:this.hash,entropy:o,nonce:c,pers:s.pers,persEnc:s.persEnc||"utf8"}),f=this.n.sub(new vr(1)),l=0;;l++){var v=s.k?s.k(l):new vr(h.generate(this.n.byteLength()));if(v=this._truncateToN(v,!0),!(v.cmpn(1)<=0||v.cmp(f)>=0)){var _=this.g.mul(v);if(!_.isInfinity()){var m=_.getX(),$=m.umod(this.n);if($.cmpn(0)!==0){var O=v.invm(this.n).mul($.mul(r.getPrivate()).iadd(e));if(O=O.umod(this.n),O.cmpn(0)!==0){var D=(_.getY().isOdd()?1:0)|(m.cmp($)!==0?2:0);return s.canonical&&O.cmp(this.nh)>0&&(O=this.n.sub(O),D^=1),new vo({r:$,s:O,recoveryParam:D})}}}}}};rr.prototype.verify=function(e,r,i,s,n){n||(n={}),e=this._truncateToN(e,!1,n.msgBitLength),i=this.keyFromPublic(i,s),r=new vo(r,"hex");var a=r.r,o=r.s;if(a.cmpn(1)<0||a.cmp(this.n)>=0||o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;var c=o.invm(this.n),h=c.mul(e).umod(this.n),f=c.mul(a).umod(this.n),l;return this.curve._maxwellTrick?(l=this.g.jmulAdd(h,i.getPublic(),f),l.isInfinity()?!1:l.eqXToP(a)):(l=this.g.mulAdd(h,i.getPublic(),f),l.isInfinity()?!1:l.getX().umod(this.n).cmp(a)===0)};rr.prototype.recoverPubKey=function(t,e,r,i){Ti((3&r)===r,"The recovery param is more than two bits"),e=new vo(e,i);var s=this.n,n=new vr(t),a=e.r,o=e.s,c=r&1,h=r>>1;if(a.cmp(this.curve.p.umod(this.curve.n))>=0&&h)throw new Error("Unable to find sencond key candinate");h?a=this.curve.pointFromX(a.add(this.curve.n),c):a=this.curve.pointFromX(a,c);var f=e.r.invm(s),l=s.sub(n).mul(f).umod(s),v=o.mul(f).umod(s);return this.g.mulAdd(l,a,v)};rr.prototype.getKeyRecoveryParam=function(t,e,r,i){if(e=new vo(e,i),e.recoveryParam!==null)return e.recoveryParam;for(var s=0;s<4;s++){var n;try{n=this.recoverPubKey(t,e,s)}catch{continue}if(n.eq(r))return s}throw new Error("Unable to find valid recovery factor")};var Gn=Wt,jp=Gn.assert,of=Gn.parseBytes,Vs=Gn.cachedProperty;function dt(t,e){this.eddsa=t,this._secret=of(e.secret),t.isPoint(e.pub)?this._pub=e.pub:this._pubBytes=of(e.pub)}dt.fromPublic=function(e,r){return r instanceof dt?r:new dt(e,{pub:r})};dt.fromSecret=function(e,r){return r instanceof dt?r:new dt(e,{secret:r})};dt.prototype.secret=function(){return this._secret};Vs(dt,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())});Vs(dt,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())});Vs(dt,"privBytes",function(){var e=this.eddsa,r=this.hash(),i=e.encodingLength-1,s=r.slice(0,e.encodingLength);return s[0]&=248,s[i]&=127,s[i]|=64,s});Vs(dt,"priv",function(){return this.eddsa.decodeInt(this.privBytes())});Vs(dt,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()});Vs(dt,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)});dt.prototype.sign=function(e){return jp(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)};dt.prototype.verify=function(e,r){return this.eddsa.verify(e,r,this)};dt.prototype.getSecret=function(e){return jp(this._secret,"KeyPair is public only"),Gn.encode(this.secret(),e)};dt.prototype.getPublic=function(e){return Gn.encode(this.pubBytes(),e)};var gw=dt,vw=ei,yo=Wt,cf=yo.assert,mo=yo.cachedProperty,yw=yo.parseBytes;function Ki(t,e){this.eddsa=t,typeof e!="object"&&(e=yw(e)),Array.isArray(e)&&(cf(e.length===t.encodingLength*2,"Signature has invalid size"),e={R:e.slice(0,t.encodingLength),S:e.slice(t.encodingLength)}),cf(e.R&&e.S,"Signature without R or S"),t.isPoint(e.R)&&(this._R=e.R),e.S instanceof vw&&(this._S=e.S),this._Rencoded=Array.isArray(e.R)?e.R:e.Rencoded,this._Sencoded=Array.isArray(e.S)?e.S:e.Sencoded}mo(Ki,"S",function(){return this.eddsa.decodeInt(this.Sencoded())});mo(Ki,"R",function(){return this.eddsa.decodePoint(this.Rencoded())});mo(Ki,"Rencoded",function(){return this.eddsa.encodePoint(this.R())});mo(Ki,"Sencoded",function(){return this.eddsa.encodeInt(this.S())});Ki.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())};Ki.prototype.toHex=function(){return yo.encode(this.toBytes(),"hex").toUpperCase()};var mw=Ki,ww=po,_w=lo,Ts=Wt,Ew=Ts.assert,Up=Ts.parseBytes,zp=gw,hf=mw;function qt(t){if(Ew(t==="ed25519","only tested with ed25519 so far"),!(this instanceof qt))return new qt(t);t=_w[t].curve,this.curve=t,this.g=t.g,this.g.precompute(t.n.bitLength()+1),this.pointClass=t.point().constructor,this.encodingLength=Math.ceil(t.n.bitLength()/8),this.hash=ww.sha512}var xw=qt;qt.prototype.sign=function(e,r){e=Up(e);var i=this.keyFromSecret(r),s=this.hashInt(i.messagePrefix(),e),n=this.g.mul(s),a=this.encodePoint(n),o=this.hashInt(a,i.pubBytes(),e).mul(i.priv()),c=s.add(o).umod(this.curve.n);return this.makeSignature({R:n,S:c,Rencoded:a})};qt.prototype.verify=function(e,r,i){if(e=Up(e),r=this.makeSignature(r),r.S().gte(r.eddsa.curve.n)||r.S().isNeg())return!1;var s=this.keyFromPublic(i),n=this.hashInt(r.Rencoded(),s.pubBytes(),e),a=this.g.mul(r.S()),o=r.R().add(s.pub().mul(n));return o.eq(a)};qt.prototype.hashInt=function(){for(var e=this.hash(),r=0;r<arguments.length;r++)e.update(arguments[r]);return Ts.intFromLE(e.digest()).umod(this.curve.n)};qt.prototype.keyFromPublic=function(e){return zp.fromPublic(this,e)};qt.prototype.keyFromSecret=function(e){return zp.fromSecret(this,e)};qt.prototype.makeSignature=function(e){return e instanceof hf?e:new hf(this,e)};qt.prototype.encodePoint=function(e){var r=e.getY().toArray("le",this.encodingLength);return r[this.encodingLength-1]|=e.getX().isOdd()?128:0,r};qt.prototype.decodePoint=function(e){e=Ts.parseBytes(e);var r=e.length-1,i=e.slice(0,r).concat(e[r]&-129),s=(e[r]&128)!==0,n=Ts.intFromLE(i);return this.curve.pointFromY(n,s)};qt.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)};qt.prototype.decodeInt=function(e){return Ts.intFromLE(e)};qt.prototype.isPoint=function(e){return e instanceof this.pointClass};(function(t){var e=t;e.version=E2.version,e.utils=Wt,e.rand=yp,e.curve=Ch,e.curves=lo,e.ec=bw,e.eddsa=xw})(gp);const $w={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Sw={};const Iw=":";function Ps(t){const[e,r]=t.split(Iw);return{namespace:e,reference:r}}function uf(t,e=[]){const r=[];return Object.keys(t).forEach(i=>{if(e.length&&!e.includes(i))return;const s=t[i];r.push(...s.accounts)}),r}function kp(t,e){return t.includes(":")?[t]:e.chains||[]}const Aw="ReactNative",Kt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Dw="js";function Ka(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function yi(){return!Hn()&&!!mh()&&navigator.product===Aw}function Pw(){return yi()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Ow(){return yi()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Jn(){return!Ka()&&!!mh()&&!!Hn()}function Yn(){return yi()?Kt.reactNative:Ka()?Kt.node:Jn()?Kt.browser:Kt.unknown}function ff(){var t;try{return yi()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function Mw(t,e){const r=new URLSearchParams(t);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const s=e[i];s!==void 0&&r.set(i,s)}return r.toString()}function Hp(){return xl()||{name:"",description:"",url:"",icons:[""]}}function Cw(){if(Yn()===Kt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=tb();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Tw(){var t;const e=Yn();return e===Kt.browser?[e,((t=El())==null?void 0:t.host)||"unknown"].join(":"):e}function Kp(t,e,r){const i=Cw(),s=Tw();return[[t,e].join("-"),[Dw,r].join("-"),i,s].join("/")}function Rw({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:a,bundleId:o,packageName:c}){const h=r.split("?"),f=Kp(t,e,i),l={auth:s,ua:f,projectId:n,useOnCloseEvent:a,packageName:c||void 0,bundleId:o||void 0},v=Mw(h[1]||"",l);return h[0]+"?"+v}function Ni(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Vp(t){return Object.fromEntries(t.entries())}function Wp(t){return new Map(Object.entries(t))}function Mi(t=K.FIVE_MINUTES,e){const r=K.toMiliseconds(t||K.FIVE_MINUTES);let i,s,n,a;return{resolve:o=>{n&&i&&(clearTimeout(n),i(o),a=Promise.resolve(o))},reject:o=>{n&&s&&(clearTimeout(n),s(o))},done:()=>new Promise((o,c)=>{if(a)return o(a);n=setTimeout(()=>{const h=new Error(e);a=Promise.reject(h),c(h)},r),i=o,s=c})}}function di(t,e,r){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(r)),e);try{const a=await t;i(a)}catch(a){s(a)}clearTimeout(n)})}function Gp(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Nw(t){return Gp("topic",t)}function Fw(t){return Gp("id",t)}function Jp(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function st(t,e){return K.fromMiliseconds(Date.now()+K.toMiliseconds(t))}function ui(t){return Date.now()>=K.toMiliseconds(t)}function ue(t,e){return`${t}${e?`:${e}`:""}`}function Ta(t=[],e=[]){return[...new Set([...t,...e])]}async function Bw({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r,n=s==null?void 0:s.href;if(typeof n!="string")return;const a=qw(n,t,e),o=Yn();if(o===Kt.browser){if(!((i=Hn())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Lw(a)}else o===Kt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(a)}catch(s){console.error(s)}}function qw(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${kw(i,!0)}`}else s=`${s}/wc?${i}`;return s}function Lw(t){let e="_self";zw()?e="_top":(Uw()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function jw(t,e){let r="";try{if(Jn()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function df(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function lf(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Fh(){return typeof process<"u"&&Sw.IS_VITEST==="true"}function Uw(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function zw(){try{return window.self!==window.top}catch{return!1}}function kw(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function Yp(t){return Buffer.from(t,"base64").toString("utf-8")}function Hw(t){return new Promise(e=>setTimeout(e,t))}function Bn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Kw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function wo(t,...e){if(!Kw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Bh(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Bn(t.outputLen),Bn(t.blockLen)}function Rs(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Xp(t,e){wo(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const wa=BigInt(2**32-1),pf=BigInt(32);function Vw(t,e=!1){return e?{h:Number(t&wa),l:Number(t>>pf&wa)}:{h:Number(t>>pf&wa)|0,l:Number(t&wa)|0}}function Ww(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:a}=Vw(t[s],e);[r[s],i[s]]=[n,a]}return[r,i]}const Gw=(t,e,r)=>t<<r|e>>>32-r,Jw=(t,e,r)=>e<<r|t>>>32-r,Yw=(t,e,r)=>e<<r-32|t>>>64-r,Xw=(t,e,r)=>t<<r-32|e>>>64-r,is=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Zw(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ac(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Er(t,e){return t<<32-e|t>>>e}const bf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Qw(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function gf(t){for(let e=0;e<t.length;e++)t[e]=Qw(t[e])}function e6(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Ns(t){return typeof t=="string"&&(t=e6(t)),wo(t),t}let qh=class{clone(){return this._cloneInto()}};function Zp(t){const e=i=>t().update(Ns(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Xn(t=32){if(is&&typeof is.getRandomValues=="function")return is.getRandomValues(new Uint8Array(t));if(is&&typeof is.randomBytes=="function")return is.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const Qp=[],e0=[],t0=[],t6=BigInt(0),En=BigInt(1),r6=BigInt(2),i6=BigInt(7),s6=BigInt(256),n6=BigInt(113);for(let t=0,e=En,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Qp.push(2*(5*i+r)),e0.push((t+1)*(t+2)/2%64);let s=t6;for(let n=0;n<7;n++)e=(e<<En^(e>>i6)*n6)%s6,e&r6&&(s^=En<<(En<<BigInt(n))-En);t0.push(s)}const[a6,o6]=Ww(t0,!0),vf=(t,e,r)=>r>32?Yw(t,e,r):Gw(t,e,r),yf=(t,e,r)=>r>32?Xw(t,e,r):Jw(t,e,r);function c6(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let a=0;a<10;a++)r[a]=t[a]^t[a+10]^t[a+20]^t[a+30]^t[a+40];for(let a=0;a<10;a+=2){const o=(a+8)%10,c=(a+2)%10,h=r[c],f=r[c+1],l=vf(h,f,1)^r[o],v=yf(h,f,1)^r[o+1];for(let _=0;_<50;_+=10)t[a+_]^=l,t[a+_+1]^=v}let s=t[2],n=t[3];for(let a=0;a<24;a++){const o=e0[a],c=vf(s,n,o),h=yf(s,n,o),f=Qp[a];s=t[f],n=t[f+1],t[f]=c,t[f+1]=h}for(let a=0;a<50;a+=10){for(let o=0;o<10;o++)r[o]=t[a+o];for(let o=0;o<10;o++)t[a+o]^=~r[(o+2)%10]&r[(o+4)%10]}t[0]^=a6[i],t[1]^=o6[i]}r.fill(0)}let h6=class r0 extends qh{constructor(e,r,i,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Bn(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Zw(this.state)}keccak(){bf||gf(this.state32),c6(this.state32,this.rounds),bf||gf(this.state32),this.posOut=0,this.pos=0}update(e){Rs(this);const{blockLen:r,state:i}=this;e=Ns(e);const s=e.length;for(let n=0;n<s;){const a=Math.min(r-this.pos,s-n);for(let o=0;o<a;o++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,r&128&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Rs(this,!1),wo(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const a=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+a),s),this.posOut+=a,s+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Bn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Xp(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:a}=this;return e||(e=new r0(r,i,s,a,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=a,e.destroyed=this.destroyed,e}};const u6=(t,e,r)=>Zp(()=>new h6(e,t,r)),f6=u6(1,136,256/8),d6="https://rpc.walletconnect.org/v1";function i0(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(f6(r)).toString("hex")}async function l6(t,e,r,i,s,n){switch(r.t){case"eip191":return await p6(t,e,r.s);case"eip1271":return await b6(t,e,r.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function p6(t,e,r){return(await Cg({hash:i0(e),signature:r})).toLowerCase()===t.toLowerCase()}async function b6(t,e,r,i,s,n){const a=Ps(i);if(!a.namespace||!a.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const o="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",h="0000000000000000000000000000000000000000000000000000000000000041",f=r.substring(2),l=i0(e).substring(2),v=o+l+c+h+f,_=await fetch(`${n||d6}/?chainId=${i}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:g6(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:v},"latest"]})}),{result:m}=await _.json();return m?m.slice(0,o.length).toLowerCase()===o.toLowerCase():!1}catch(o){return console.error("isValidEip1271Signature: ",o),!1}}function g6(){return Date.now()+Math.floor(Math.random()*1e3)}var v6=Object.defineProperty,y6=Object.defineProperties,m6=Object.getOwnPropertyDescriptors,mf=Object.getOwnPropertySymbols,w6=Object.prototype.hasOwnProperty,_6=Object.prototype.propertyIsEnumerable,wf=(t,e,r)=>e in t?v6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,E6=(t,e)=>{for(var r in e||(e={}))w6.call(e,r)&&wf(t,r,e[r]);if(mf)for(var r of mf(e))_6.call(e,r)&&wf(t,r,e[r]);return t},x6=(t,e)=>y6(t,m6(e));const $6="did:pkh:",Lh=t=>t==null?void 0:t.split(":"),S6=t=>{const e=t&&Lh(t);if(e)return t.includes($6)?e[3]:e[1]},zc=t=>{const e=t&&Lh(t);if(e)return e[2]+":"+e[3]},Va=t=>{const e=t&&Lh(t);if(e)return e.pop()};async function _f(t){const{cacao:e,projectId:r}=t,{s:i,p:s}=e,n=s0(s,s.iss),a=Va(s.iss);return await l6(a,n,i,zc(s.iss),r)}const s0=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,i=Va(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,o=`Chain ID: ${S6(e)}`,c=`Nonce: ${t.nonce}`,h=`Issued At: ${t.iat}`,f=t.exp?`Expiration Time: ${t.exp}`:void 0,l=t.nbf?`Not Before: ${t.nbf}`:void 0,v=t.requestId?`Request ID: ${t.requestId}`:void 0,_=t.resources?`Resources:${t.resources.map($=>`
- ${$}`).join("")}`:void 0,m=Ra(t.resources);if(m){const $=qn(m);s=R6(s,$)}return[r,i,"",s,"",n,a,o,c,h,f,l,v,_].filter($=>$!=null).join(`
`)};function I6(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function A6(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Ui(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(a=>{if(typeof a!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${a}`)})})})}function D6(t,e,r,i={}){return r==null||r.sort((s,n)=>s.localeCompare(n)),{att:{[t]:P6(e,r,i)}}}function P6(t,e,r={}){e=e==null?void 0:e.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...i)}function n0(t){return Ui(t),`urn:recap:${I6(t).replace(/=/g,"")}`}function qn(t){const e=A6(t.replace("urn:recap:",""));return Ui(e),e}function O6(t,e,r){const i=D6(t,e,r);return n0(i)}function M6(t){return t&&t.includes("urn:recap:")}function C6(t,e){const r=qn(t),i=qn(e),s=T6(r,i);return n0(s)}function T6(t,e){Ui(t),Ui(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return r.forEach(s=>{var n,a;Object.keys(((n=t.att)==null?void 0:n[s])||{}).concat(Object.keys(((a=e.att)==null?void 0:a[s])||{})).sort((o,c)=>o.localeCompare(c)).forEach(o=>{var c,h;i.att[s]=x6(E6({},i.att[s]),{[o]:((c=t.att[s])==null?void 0:c[o])||((h=e.att[s])==null?void 0:h[o])})})}),i}function R6(t="",e){Ui(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let s=0;Object.keys(e.att).forEach(o=>{const c=Object.keys(e.att[o]).map(l=>({ability:l.split("/")[0],action:l.split("/")[1]}));c.sort((l,v)=>l.action.localeCompare(v.action));const h={};c.forEach(l=>{h[l.ability]||(h[l.ability]=[]),h[l.ability].push(l.action)});const f=Object.keys(h).map(l=>(s++,`(${s}) '${l}': '${h[l].join("', '")}' for '${o}'.`));i.push(f.join(", ").replace(".,","."))});const n=i.join(" "),a=`${r}${n}`;return`${t?t+" ":""}${a}`}function Ef(t){var e;const r=qn(t);Ui(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function xf(t){const e=qn(t);Ui(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s==null?void 0:s[0])!=null&&n.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function Ra(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return M6(e)?e:void 0}function oc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function a0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ht(t,...e){if(!a0(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function $f(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function N6(t,e){Ht(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Sf(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const bi=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),F6=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),B6=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!B6)throw new Error("Non little-endian hardware is not supported");function q6(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function kc(t){if(typeof t=="string")t=q6(t);else if(a0(t))t=Hc(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function L6(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function j6(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const U6=(t,e)=>{function r(i,...s){if(Ht(i),t.nonceLength!==void 0){const h=s[0];if(!h)throw new Error("nonce / iv required");t.varSizeNonce?Ht(h):Ht(h,t.nonceLength)}const n=t.tagLength;n&&s[1]!==void 0&&Ht(s[1]);const a=e(i,...s),o=(h,f)=>{if(f!==void 0){if(h!==2)throw new Error("cipher output not supported");Ht(f)}};let c=!1;return{encrypt(h,f){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ht(h),o(a.encrypt.length,f),a.encrypt(h,f)},decrypt(h,f){if(Ht(h),n&&h.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return o(a.decrypt.length,f),a.decrypt(h,f)}}}return Object.assign(r,t),r};function If(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!z6(e))throw new Error("invalid output, must be aligned");return e}function Af(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),a=Number(r>>s&n),o=Number(r&n);t.setUint32(e+4,a,i),t.setUint32(e+0,o,i)}function z6(t){return t.byteOffset%4===0}function Hc(t){return Uint8Array.from(t)}function Fs(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const o0=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),k6=o0("expand 16-byte k"),H6=o0("expand 32-byte k"),K6=bi(k6),V6=bi(H6);function oe(t,e){return t<<e|t>>>32-e}function Kc(t){return t.byteOffset%4===0}const _a=64,W6=16,c0=2**32-1,Df=new Uint32Array;function G6(t,e,r,i,s,n,a,o){const c=s.length,h=new Uint8Array(_a),f=bi(h),l=Kc(s)&&Kc(n),v=l?bi(s):Df,_=l?bi(n):Df;for(let m=0;m<c;a++){if(t(e,r,i,f,a,o),a>=c0)throw new Error("arx: counter overflow");const $=Math.min(_a,c-m);if(l&&$===_a){const O=m/4;if(m%4!==0)throw new Error("arx: invalid block position");for(let D=0,P;D<W6;D++)P=O+D,_[P]=v[P]^f[D];m+=_a;continue}for(let O=0,D;O<$;O++)D=m+O,n[D]=s[D]^h[O];m+=$}}function J6(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:s,counterRight:n,rounds:a}=L6({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return oc(s),oc(a),Sf(n),Sf(r),(o,c,h,f,l=0)=>{Ht(o),Ht(c),Ht(h);const v=h.length;if(f===void 0&&(f=new Uint8Array(v)),Ht(f),oc(l),l<0||l>=c0)throw new Error("arx: counter overflow");if(f.length<v)throw new Error(`arx: output (${f.length}) is shorter than data (${v})`);const _=[];let m=o.length,$,O;if(m===32)_.push($=Hc(o)),O=V6;else if(m===16&&r)$=new Uint8Array(32),$.set(o),$.set(o,16),O=K6,_.push($);else throw new Error(`arx: invalid 32-byte key, got length=${m}`);Kc(c)||_.push(c=Hc(c));const D=bi($);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(O,D,bi(c.subarray(0,16)),D),c=c.subarray(16)}const P=16-s;if(P!==c.length)throw new Error(`arx: nonce must be ${P} or 16 bytes`);if(P!==12){const T=new Uint8Array(12);T.set(c,n?0:12-c.length),c=T,_.push(c)}const C=bi(c);return G6(t,O,D,C,h,f,l,a),Fs(..._),f}}const vt=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let Y6=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=kc(e),Ht(e,32);const r=vt(e,0),i=vt(e,2),s=vt(e,4),n=vt(e,6),a=vt(e,8),o=vt(e,10),c=vt(e,12),h=vt(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|a<<12)&255,this.r[5]=a>>>1&8190,this.r[6]=(a>>>14|o<<2)&8191,this.r[7]=(o>>>11|c<<5)&8065,this.r[8]=(c>>>8|h<<8)&8191,this.r[9]=h>>>5&127;for(let f=0;f<8;f++)this.pad[f]=vt(e,16+2*f)}process(e,r,i=!1){const s=i?0:2048,{h:n,r:a}=this,o=a[0],c=a[1],h=a[2],f=a[3],l=a[4],v=a[5],_=a[6],m=a[7],$=a[8],O=a[9],D=vt(e,r+0),P=vt(e,r+2),C=vt(e,r+4),T=vt(e,r+6),N=vt(e,r+8),z=vt(e,r+10),H=vt(e,r+12),U=vt(e,r+14);let B=n[0]+(D&8191),J=n[1]+((D>>>13|P<<3)&8191),S=n[2]+((P>>>10|C<<6)&8191),u=n[3]+((C>>>7|T<<9)&8191),b=n[4]+((T>>>4|N<<12)&8191),w=n[5]+(N>>>1&8191),p=n[6]+((N>>>14|z<<2)&8191),g=n[7]+((z>>>11|H<<5)&8191),E=n[8]+((H>>>8|U<<8)&8191),I=n[9]+(U>>>5|s),y=0,d=y+B*o+J*(5*O)+S*(5*$)+u*(5*m)+b*(5*_);y=d>>>13,d&=8191,d+=w*(5*v)+p*(5*l)+g*(5*f)+E*(5*h)+I*(5*c),y+=d>>>13,d&=8191;let x=y+B*c+J*o+S*(5*O)+u*(5*$)+b*(5*m);y=x>>>13,x&=8191,x+=w*(5*_)+p*(5*v)+g*(5*l)+E*(5*f)+I*(5*h),y+=x>>>13,x&=8191;let R=y+B*h+J*c+S*o+u*(5*O)+b*(5*$);y=R>>>13,R&=8191,R+=w*(5*m)+p*(5*_)+g*(5*v)+E*(5*l)+I*(5*f),y+=R>>>13,R&=8191;let j=y+B*f+J*h+S*c+u*o+b*(5*O);y=j>>>13,j&=8191,j+=w*(5*$)+p*(5*m)+g*(5*_)+E*(5*v)+I*(5*l),y+=j>>>13,j&=8191;let F=y+B*l+J*f+S*h+u*c+b*o;y=F>>>13,F&=8191,F+=w*(5*O)+p*(5*$)+g*(5*m)+E*(5*_)+I*(5*v),y+=F>>>13,F&=8191;let q=y+B*v+J*l+S*f+u*h+b*c;y=q>>>13,q&=8191,q+=w*o+p*(5*O)+g*(5*$)+E*(5*m)+I*(5*_),y+=q>>>13,q&=8191;let G=y+B*_+J*v+S*l+u*f+b*h;y=G>>>13,G&=8191,G+=w*c+p*o+g*(5*O)+E*(5*$)+I*(5*m),y+=G>>>13,G&=8191;let X=y+B*m+J*_+S*v+u*l+b*f;y=X>>>13,X&=8191,X+=w*h+p*c+g*o+E*(5*O)+I*(5*$),y+=X>>>13,X&=8191;let Q=y+B*$+J*m+S*_+u*v+b*l;y=Q>>>13,Q&=8191,Q+=w*f+p*h+g*c+E*o+I*(5*O),y+=Q>>>13,Q&=8191;let Y=y+B*O+J*$+S*m+u*_+b*v;y=Y>>>13,Y&=8191,Y+=w*l+p*f+g*h+E*c+I*o,y+=Y>>>13,Y&=8191,y=(y<<2)+y|0,y=y+d|0,d=y&8191,y=y>>>13,x+=y,n[0]=d,n[1]=x,n[2]=R,n[3]=j,n[4]=F,n[5]=q,n[6]=G,n[7]=X,n[8]=Q,n[9]=Y}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let o=2;o<10;o++)e[o]+=s,s=e[o]>>>13,e[o]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let o=1;o<10;o++)i[o]=e[o]+s,s=i[o]>>>13,i[o]&=8191;i[9]-=8192;let n=(s^1)-1;for(let o=0;o<10;o++)i[o]&=n;n=~n;for(let o=0;o<10;o++)e[o]=e[o]&n|i[o];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let a=e[0]+r[0];e[0]=a&65535;for(let o=1;o<8;o++)a=(e[o]+r[o]|0)+(a>>>16)|0,e[o]=a&65535;Fs(i)}update(e){$f(this);const{buffer:r,blockLen:i}=this;e=kc(e);const s=e.length;for(let n=0;n<s;){const a=Math.min(i-this.pos,s-n);if(a===i){for(;i<=s-n;n+=i)this.process(e,n);continue}r.set(e.subarray(n,n+a),this.pos),this.pos+=a,n+=a,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Fs(this.h,this.r,this.buffer,this.pad)}digestInto(e){$f(this),N6(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let n=0;for(let a=0;a<8;a++)e[n++]=i[a]>>>0,e[n++]=i[a]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}};function X6(t){const e=(i,s)=>t(s).update(kc(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const Z6=X6(t=>new Y6(t));function Q6(t,e,r,i,s,n=20){let a=t[0],o=t[1],c=t[2],h=t[3],f=e[0],l=e[1],v=e[2],_=e[3],m=e[4],$=e[5],O=e[6],D=e[7],P=s,C=r[0],T=r[1],N=r[2],z=a,H=o,U=c,B=h,J=f,S=l,u=v,b=_,w=m,p=$,g=O,E=D,I=P,y=C,d=T,x=N;for(let j=0;j<n;j+=2)z=z+J|0,I=oe(I^z,16),w=w+I|0,J=oe(J^w,12),z=z+J|0,I=oe(I^z,8),w=w+I|0,J=oe(J^w,7),H=H+S|0,y=oe(y^H,16),p=p+y|0,S=oe(S^p,12),H=H+S|0,y=oe(y^H,8),p=p+y|0,S=oe(S^p,7),U=U+u|0,d=oe(d^U,16),g=g+d|0,u=oe(u^g,12),U=U+u|0,d=oe(d^U,8),g=g+d|0,u=oe(u^g,7),B=B+b|0,x=oe(x^B,16),E=E+x|0,b=oe(b^E,12),B=B+b|0,x=oe(x^B,8),E=E+x|0,b=oe(b^E,7),z=z+S|0,x=oe(x^z,16),g=g+x|0,S=oe(S^g,12),z=z+S|0,x=oe(x^z,8),g=g+x|0,S=oe(S^g,7),H=H+u|0,I=oe(I^H,16),E=E+I|0,u=oe(u^E,12),H=H+u|0,I=oe(I^H,8),E=E+I|0,u=oe(u^E,7),U=U+b|0,y=oe(y^U,16),w=w+y|0,b=oe(b^w,12),U=U+b|0,y=oe(y^U,8),w=w+y|0,b=oe(b^w,7),B=B+J|0,d=oe(d^B,16),p=p+d|0,J=oe(J^p,12),B=B+J|0,d=oe(d^B,8),p=p+d|0,J=oe(J^p,7);let R=0;i[R++]=a+z|0,i[R++]=o+H|0,i[R++]=c+U|0,i[R++]=h+B|0,i[R++]=f+J|0,i[R++]=l+S|0,i[R++]=v+u|0,i[R++]=_+b|0,i[R++]=m+w|0,i[R++]=$+p|0,i[R++]=O+g|0,i[R++]=D+E|0,i[R++]=P+I|0,i[R++]=C+y|0,i[R++]=T+d|0,i[R++]=N+x|0}const e8=J6(Q6,{counterRight:!1,counterLength:4,allowShortKeys:!1}),t8=new Uint8Array(16),Pf=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(t8.subarray(r))},r8=new Uint8Array(32);function Of(t,e,r,i,s){const n=t(e,r,r8),a=Z6.create(n);s&&Pf(a,s),Pf(a,i);const o=new Uint8Array(16),c=F6(o);Af(c,0,BigInt(s?s.length:0),!0),Af(c,8,BigInt(i.length),!0),a.update(o);const h=a.digest();return Fs(n,o),h}const i8=t=>(e,r,i)=>({encrypt(s,n){const a=s.length;n=If(a+16,n,!1),n.set(s);const o=n.subarray(0,-16);t(e,r,o,o,1);const c=Of(t,e,r,o,i);return n.set(c,a),Fs(c),n},decrypt(s,n){n=If(s.length-16,n,!1);const a=s.subarray(0,-16),o=s.subarray(-16),c=Of(t,e,r,a,i);if(!j6(o,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),t(e,r,n,n,1),Fs(c),n}}),h0=U6({blockSize:64,nonceLength:12,tagLength:16},i8(e8));let u0=class extends qh{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Bh(e);const i=Ns(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let a=0;a<n.length;a++)n[a]^=54;this.iHash.update(n),this.oHash=e.create();for(let a=0;a<n.length;a++)n[a]^=106;this.oHash.update(n),n.fill(0)}update(e){return Rs(this),this.iHash.update(e),this}digestInto(e){Rs(this),wo(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:a,outputLen:o}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=a,e.outputLen=o,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const jh=(t,e,r)=>new u0(t,e).update(r).digest();jh.create=(t,e)=>new u0(t,e);function s8(t,e,r){return Bh(t),r===void 0&&(r=new Uint8Array(t.outputLen)),jh(t,Ns(r),Ns(e))}const cc=new Uint8Array([0]),Mf=new Uint8Array;function n8(t,e,r,i=32){if(Bh(t),Bn(i),i>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/t.outputLen);r===void 0&&(r=Mf);const n=new Uint8Array(s*t.outputLen),a=jh.create(t,e),o=a._cloneInto(),c=new Uint8Array(a.outputLen);for(let h=0;h<s;h++)cc[0]=h+1,o.update(h===0?Mf:c).update(r).update(cc).digestInto(c),n.set(c,t.outputLen*h),a._cloneInto(o);return a.destroy(),o.destroy(),c.fill(0),cc.fill(0),n.slice(0,i)}const a8=(t,e,r,i,s)=>n8(t,s8(t,e,r),i,s);function o8(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),a=Number(r>>s&n),o=Number(r&n),c=i?4:0,h=i?0:4;t.setUint32(e+c,a,i),t.setUint32(e+h,o,i)}function c8(t,e,r){return t&e^~t&r}function h8(t,e,r){return t&e^t&r^e&r}let u8=class extends qh{constructor(e,r,i,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ac(this.buffer)}update(e){Rs(this);const{view:r,buffer:i,blockLen:s}=this;e=Ns(e);const n=e.length;for(let a=0;a<n;){const o=Math.min(s-this.pos,n-a);if(o===s){const c=ac(e);for(;s<=n-a;a+=s)this.process(c,a);continue}i.set(e.subarray(a,a+o),this.pos),this.pos+=o,a+=o,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Rs(this),Xp(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:a}=this;r[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(i,0),a=0);for(let l=a;l<s;l++)r[l]=0;o8(i,s-8,BigInt(this.length*8),n),this.process(i,0);const o=ac(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=c/4,f=this.get();if(h>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<h;l++)o.setUint32(4*l,f[l],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:a,pos:o}=this;return e.length=s,e.pos=o,e.finished=n,e.destroyed=a,s%r&&e.buffer.set(i),e}};const f8=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ci=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),hi=new Uint32Array(64);let d8=class extends u8{constructor(){super(64,32,8,!1),this.A=ci[0]|0,this.B=ci[1]|0,this.C=ci[2]|0,this.D=ci[3]|0,this.E=ci[4]|0,this.F=ci[5]|0,this.G=ci[6]|0,this.H=ci[7]|0}get(){const{A:e,B:r,C:i,D:s,E:n,F:a,G:o,H:c}=this;return[e,r,i,s,n,a,o,c]}set(e,r,i,s,n,a,o,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=a|0,this.G=o|0,this.H=c|0}process(e,r){for(let l=0;l<16;l++,r+=4)hi[l]=e.getUint32(r,!1);for(let l=16;l<64;l++){const v=hi[l-15],_=hi[l-2],m=Er(v,7)^Er(v,18)^v>>>3,$=Er(_,17)^Er(_,19)^_>>>10;hi[l]=$+hi[l-7]+m+hi[l-16]|0}let{A:i,B:s,C:n,D:a,E:o,F:c,G:h,H:f}=this;for(let l=0;l<64;l++){const v=Er(o,6)^Er(o,11)^Er(o,25),_=f+v+c8(o,c,h)+f8[l]+hi[l]|0,m=(Er(i,2)^Er(i,13)^Er(i,22))+h8(i,s,n)|0;f=h,h=c,c=o,o=a+_|0,a=n,n=s,s=i,i=_+m|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,a=a+this.D|0,o=o+this.E|0,c=c+this.F|0,h=h+this.G|0,f=f+this.H|0,this.set(i,s,n,a,o,c,h,f)}roundClean(){hi.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const _o=Zp(()=>new d8);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const f0=BigInt(0);function Uh(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function d0(t){if(!Uh(t))throw new Error("Uint8Array expected")}const l8=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function p8(t){d0(t);let e="";for(let r=0;r<t.length;r++)e+=l8[t[r]];return e}function b8(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?f0:BigInt("0x"+t)}const Hr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Cf(t){if(t>=Hr._0&&t<=Hr._9)return t-Hr._0;if(t>=Hr.A&&t<=Hr.F)return t-(Hr.A-10);if(t>=Hr.a&&t<=Hr.f)return t-(Hr.a-10)}function l0(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const a=Cf(t.charCodeAt(n)),o=Cf(t.charCodeAt(n+1));if(a===void 0||o===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=a*16+o}return i}function Tf(t){return d0(t),b8(p8(Uint8Array.from(t).reverse()))}function g8(t,e){return l0(t.toString(16).padStart(e*2,"0"))}function v8(t,e){return g8(t,e).reverse()}function Rf(t,e,r){let i;if(typeof e=="string")try{i=l0(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(Uh(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}const hc=t=>typeof t=="bigint"&&f0<=t;function y8(t,e,r){return hc(t)&&hc(e)&&hc(r)&&e<=t&&t<r}function Nf(t,e,r,i){if(!y8(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}const m8={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Uh(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function w8(t,e,r={}){const i=(s,n,a)=>{const o=m8[n];if(typeof o!="function")throw new Error("invalid validator function");const c=t[s];if(!(a&&c===void 0)&&!o(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}const Ds=BigInt(0),Ea=BigInt(1);function p0(t,e){const r=t%e;return r>=Ds?r:e+r}function _8(t,e,r){if(e<Ds)throw new Error("invalid exponent, negatives unsupported");if(r<=Ds)throw new Error("invalid modulus");if(r===Ea)return Ds;let i=Ea;for(;e>Ds;)e&Ea&&(i=i*t%r),t=t*t%r,e>>=Ea;return i}function gr(t,e,r){let i=t;for(;e-- >Ds;)i*=i,i%=r;return i}BigInt(0),BigInt(1),BigInt(0),BigInt(1),BigInt(2),BigInt(8);const ss=BigInt(0),uc=BigInt(1);function E8(t){return w8(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function x8(t){const e=E8(t),{P:r}=e,i=P=>p0(P,r),s=e.montgomeryBits,n=Math.ceil(s/8),a=e.nByteLength,o=e.adjustScalarBytes||(P=>P),c=e.powPminus2||(P=>_8(P,r-BigInt(2),r));function h(P,C,T){const N=i(P*(C-T));return C=i(C-N),T=i(T+N),[C,T]}const f=(e.a-BigInt(2))/BigInt(4);function l(P,C){Nf("u",P,ss,r),Nf("scalar",C,ss,r);const T=C,N=P;let z=uc,H=ss,U=P,B=uc,J=ss,S;for(let b=BigInt(s-1);b>=ss;b--){const w=T>>b&uc;J^=w,S=h(J,z,U),z=S[0],U=S[1],S=h(J,H,B),H=S[0],B=S[1],J=w;const p=z+H,g=i(p*p),E=z-H,I=i(E*E),y=g-I,d=U+B,x=U-B,R=i(x*p),j=i(d*E),F=R+j,q=R-j;U=i(F*F),B=i(N*i(q*q)),z=i(g*I),H=i(y*(g+i(f*y)))}S=h(J,z,U),z=S[0],U=S[1],S=h(J,H,B),H=S[0],B=S[1];const u=c(H);return i(z*u)}function v(P){return v8(i(P),n)}function _(P){const C=Rf("u coordinate",P,n);return a===32&&(C[31]&=127),Tf(C)}function m(P){const C=Rf("scalar",P),T=C.length;if(T!==n&&T!==a){let N=""+n+" or "+a;throw new Error("invalid scalar, expected "+N+" bytes, got "+T)}return Tf(o(C))}function $(P,C){const T=_(C),N=m(P),z=l(T,N);if(z===ss)throw new Error("invalid private or public key received");return v(z)}const O=v(e.Gu);function D(P){return $(P,O)}return{scalarMult:$,scalarMultBase:D,getSharedSecret:(P,C)=>$(P,C),getPublicKey:P=>D(P),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:O}}const Vc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const $8=BigInt(1),Ff=BigInt(2),S8=BigInt(3),I8=BigInt(5);BigInt(8);function A8(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=Vc,a=t*t%n*t%n,o=gr(a,Ff,n)*a%n,c=gr(o,$8,n)*t%n,h=gr(c,I8,n)*c%n,f=gr(h,e,n)*h%n,l=gr(f,r,n)*f%n,v=gr(l,i,n)*l%n,_=gr(v,s,n)*v%n,m=gr(_,s,n)*v%n,$=gr(m,e,n)*h%n;return{pow_p_5_8:gr($,Ff,n)*t%n,b2:a}}function D8(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Wc=x8({P:Vc,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=Vc,{pow_p_5_8:r,b2:i}=A8(t);return p0(gr(r,S8,e)*i,e)},adjustScalarBytes:D8,randomBytes:Xn}),b0="base10",At="base16",li="base64pad",xn="base64url",Zn="utf8",g0=0,Yr=1,Qn=2,P8=0,Bf=1,Cn=12,zh=32;function O8(){const t=Wc.utils.randomPrivateKey(),e=Wc.getPublicKey(t);return{privateKey:Ot(t,At),publicKey:Ot(e,At)}}function Gc(){const t=Xn(zh);return Ot(t,At)}function M8(t,e){const r=Wc.getSharedSecret(tr(t,At),tr(e,At)),i=a8(_o,r,void 0,void 0,zh);return Ot(i,At)}function Na(t){const e=_o(tr(t,At));return Ot(e,At)}function Gr(t){const e=_o(tr(t,Zn));return Ot(e,At)}function v0(t){return tr(`${t}`,b0)}function zi(t){return Number(Ot(t,b0))}function C8(t){const e=v0(typeof t.type<"u"?t.type:g0);if(zi(e)===Yr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?tr(t.senderPublicKey,At):void 0,i=typeof t.iv<"u"?tr(t.iv,At):Xn(Cn),s=tr(t.symKey,At),n=h0(s,i).encrypt(tr(t.message,Zn));return y0({type:e,sealed:n,iv:i,senderPublicKey:r,encoding:t.encoding})}function T8(t){const e=tr(t.symKey,At),{sealed:r,iv:i}=Ln(t),s=h0(e,i).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return Ot(s,Zn)}function R8(t,e){const r=v0(Qn),i=Xn(Cn),s=tr(t,Zn);return y0({type:r,sealed:s,iv:i,encoding:e})}function N8(t,e){const{sealed:r}=Ln({encoded:t,encoding:e});return Ot(r,Zn)}function y0(t){const{encoding:e=li}=t;if(zi(t.type)===Qn)return Ot(Yo([t.type,t.sealed]),e);if(zi(t.type)===Yr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Ot(Yo([t.type,t.senderPublicKey,t.iv,t.sealed]),e)}return Ot(Yo([t.type,t.iv,t.sealed]),e)}function Ln(t){const{encoded:e,encoding:r=li}=t,i=tr(e,r),s=i.slice(P8,Bf),n=Bf;if(zi(s)===Yr){const h=n+zh,f=h+Cn,l=i.slice(n,h),v=i.slice(h,f),_=i.slice(f);return{type:s,sealed:_,iv:v,senderPublicKey:l}}if(zi(s)===Qn){const h=i.slice(n),f=Xn(Cn);return{type:s,sealed:h,iv:f}}const a=n+Cn,o=i.slice(n,a),c=i.slice(a);return{type:s,sealed:c,iv:o}}function F8(t,e){const r=Ln({encoded:t,encoding:e==null?void 0:e.encoding});return m0({type:zi(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Ot(r.senderPublicKey,At):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function m0(t){const e=(t==null?void 0:t.type)||g0;if(e===Yr){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function qf(t){return t.type===Yr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Lf(t){return t.type===Qn}function B8(t){return new gp.ec("p256").keyFromPublic({x:Buffer.from(t.x,"base64").toString("hex"),y:Buffer.from(t.y,"base64").toString("hex")},"hex")}function q8(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const r=e.length%4;return r>0&&(e+="=".repeat(4-r)),e}function L8(t){return Buffer.from(q8(t),"base64")}function j8(t,e){const[r,i,s]=t.split("."),n=L8(s);if(n.length!==64)throw new Error("Invalid signature length");const a=n.slice(0,32).toString("hex"),o=n.slice(32,64).toString("hex"),c=`${r}.${i}`,h=_o(c),f=B8(e),l=Ot(h,At);if(!f.verify(l,{r:a,s:o}))throw new Error("Invalid signature");return qc(t).payload}const U8="irn";function Wa(t){return(t==null?void 0:t.relay)||{protocol:U8}}function On(t){const e=$w[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function z8(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),a=t[s];r[n]=a}}),r}function jf(t){if(!t.includes("wc:")){const h=Yp(t);h!=null&&h.includes("wc:")&&(t=h)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),n=typeof r<"u"?t.substring(r):"",a=new URLSearchParams(n),o={};a.forEach((h,f)=>{o[f]=h});const c=typeof o.methods=="string"?o.methods.split(","):void 0;return{protocol:i,topic:k8(s[0]),version:parseInt(s[1],10),symKey:o.symKey,relay:z8(o),methods:c,expiryTimestamp:o.expiryTimestamp?parseInt(o.expiryTimestamp,10):void 0}}function k8(t){return t.startsWith("//")?t.substring(2):t}function H8(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const n=s,a=r+e+n;t[n]&&(i[a]=t[n])}),i}function Uf(t){const e=new URLSearchParams,r=H8(t.relay);Object.keys(r).sort().forEach(s=>{e.set(s,r[s])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const i=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${i}`}function xa(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}function Ws(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function K8(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Ws(r.accounts))}),e}function V8(t,e){const r=[];return Object.values(t).forEach(i=>{Ws(i.accounts).includes(e)&&r.push(...i.methods)}),r}function W8(t,e){const r=[];return Object.values(t).forEach(i=>{Ws(i.accounts).includes(e)&&r.push(...i.events)}),r}function kh(t){return t.includes(":")}function Mn(t){return kh(t)?t.split(":")[0]:t}function G8(t){const e={};return t==null||t.forEach(r=>{var i;const[s,n]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function zf(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=G8(e);for(const[i,s]of Object.entries(r))s.methods?s.methods=Ta(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}const J8={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Y8={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function V(t,e){const{message:r,code:i}=Y8[t];return{message:e?`${r} ${e}`:r,code:i}}function fe(t,e){const{message:r,code:i}=J8[t];return{message:e?`${r} ${e}`:r,code:i}}function Fr(t,e){return!!Array.isArray(t)}function jn(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Pt(t){return typeof t>"u"}function tt(t,e){return e&&Pt(t)?!0:typeof t=="string"&&!!t.trim().length}function Hh(t,e){return e&&Pt(t)?!0:typeof t=="number"&&!isNaN(t)}function X8(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let n=!0;return Ni(s,i)?(i.forEach(a=>{const{accounts:o,methods:c,events:h}=t.namespaces[a],f=Ws(o),l=r[a];(!Ni(kp(a,l),f)||!Ni(l.methods,c)||!Ni(l.events,h))&&(n=!1)}),n):!1}function Ga(t){return tt(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Z8(t){if(tt(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Ga(r)}}return!1}function Q8(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(tt(t,!1)){if(e(t))return!0;const r=Yp(t);return e(r)}}catch{}return!1}function e4(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function t4(t){return t==null?void 0:t.topic}function r4(t,e){let r=null;return tt(t==null?void 0:t.publicKey,!1)||(r=V("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function kf(t){let e=!0;return Fr(t)?t.length&&(e=t.every(r=>tt(r,!1))):e=!1,e}function i4(t,e,r){let i=null;return Fr(e)&&e.length?e.forEach(s=>{i||Ga(s)||(i=fe("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):Ga(t)||(i=fe("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function s4(t,e,r){let i=null;return Object.entries(t).forEach(([s,n])=>{if(i)return;const a=i4(s,kp(s,n),`${e} ${r}`);a&&(i=a)}),i}function n4(t,e){let r=null;return Fr(t)?t.forEach(i=>{r||Z8(i)||(r=fe("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=fe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function a4(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=n4(i==null?void 0:i.accounts,`${e} namespace`);s&&(r=s)}),r}function o4(t,e){let r=null;return kf(t==null?void 0:t.methods)?kf(t==null?void 0:t.events)||(r=fe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=fe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function w0(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=o4(i,`${e}, namespace`);s&&(r=s)}),r}function c4(t,e,r){let i=null;if(t&&jn(t)){const s=w0(t,e);s&&(i=s);const n=s4(t,e,r);n&&(i=n)}else i=V("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function fc(t,e){let r=null;if(t&&jn(t)){const i=w0(t,e);i&&(r=i);const s=a4(t,e);s&&(r=s)}else r=V("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function _0(t){return tt(t.protocol,!0)}function h4(t,e){let r=!1;return t?t&&Fr(t)&&t.length&&t.forEach(i=>{r=_0(i)}):r=!0,r}function u4(t){return typeof t=="number"}function Ft(t){return typeof t<"u"&&typeof t!==null}function f4(t){return!(!t||typeof t!="object"||!t.code||!Hh(t.code,!1)||!t.message||!tt(t.message,!1))}function d4(t){return!(Pt(t)||!tt(t.method,!1))}function l4(t){return!(Pt(t)||Pt(t.result)&&Pt(t.error)||!Hh(t.id,!1)||!tt(t.jsonrpc,!1))}function p4(t){return!(Pt(t)||!tt(t.name,!1))}function Hf(t,e){return!(!Ga(e)||!K8(t).includes(e))}function b4(t,e,r){return tt(r,!1)?V8(t,e).includes(r):!1}function g4(t,e,r){return tt(r,!1)?W8(t,e).includes(r):!1}function Kf(t,e,r){let i=null;const s=v4(t),n=y4(e),a=Object.keys(s),o=Object.keys(n),c=Vf(Object.keys(t)),h=Vf(Object.keys(e)),f=c.filter(l=>!h.includes(l));return f.length&&(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${f.toString()}
      Received: ${Object.keys(e).toString()}`)),Ni(a,o)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${a.toString()}
      Approved: ${o.toString()}`)),Object.keys(e).forEach(l=>{if(!l.includes(":")||i)return;const v=Ws(e[l].accounts);v.includes(l)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${l}
        Required: ${l}
        Approved: ${v.toString()}`))}),a.forEach(l=>{i||(Ni(s[l].methods,n[l].methods)?Ni(s[l].events,n[l].events)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${l}`)):i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${l}`))}),i}function v4(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function Vf(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function y4(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=Ws(t[r].accounts);i==null||i.forEach(s=>{e[s]={accounts:t[r].accounts.filter(n=>n.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function m4(t,e){return Hh(t,!1)&&t<=e.max&&t>=e.min}function Wf(){const t=Yn();return new Promise(e=>{switch(t){case Kt.browser:e(w4());break;case Kt.reactNative:e(_4());break;case Kt.node:e(E4());break;default:e(!0)}})}function w4(){return Jn()&&(navigator==null?void 0:navigator.onLine)}async function _4(){if(yi()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function E4(){return!0}function x4(t){switch(Yn()){case Kt.browser:$4(t);break;case Kt.reactNative:S4(t);break}}function $4(t){!yi()&&Jn()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function S4(t){yi()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}const dc={};let $n=class{static get(e){return dc[e]}static set(e,r){dc[e]=r}static delete(e){delete dc[e]}};class Vi{}let I4=class extends Vi{constructor(e){super()}};const Gf=K.FIVE_SECONDS,Gs={pulse:"heartbeat_pulse"};let A4=class E0 extends I4{constructor(e){super(e),this.events=new ir.EventEmitter,this.interval=Gf,this.interval=(e==null?void 0:e.interval)||Gf}static async init(e){const r=new E0(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),K.toMiliseconds(this.interval))}pulse(){this.events.emit(Gs.pulse)}};const D4=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,P4=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,O4=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function M4(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){C4(t);return}return e}function C4(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function $a(t,e={}){if(typeof t!="string")return t;const r=t.trim();if(t[0]==='"'&&t.endsWith('"')&&!t.includes("\\"))return r.slice(1,-1);if(r.length<=9){const i=r.toLowerCase();if(i==="true")return!0;if(i==="false")return!1;if(i==="undefined")return;if(i==="null")return null;if(i==="nan")return Number.NaN;if(i==="infinity")return Number.POSITIVE_INFINITY;if(i==="-infinity")return Number.NEGATIVE_INFINITY}if(!O4.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(D4.test(t)||P4.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,M4)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function T4(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function ht(t,...e){try{return T4(t(...e))}catch(r){return Promise.reject(r)}}function R4(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function N4(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Fa(t){if(R4(t))return String(t);if(N4(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Fa(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Jc="base64:";function F4(t){return typeof t=="string"?t:Jc+L4(t)}function B4(t){return typeof t!="string"||!t.startsWith(Jc)?t:q4(t.slice(Jc.length))}function q4(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function L4(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Nt(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function j4(...t){return Nt(t.join(":"))}function Sa(t){return t=Nt(t),t?t+":":""}function U4(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function z4(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const k4="memory",H4=()=>{const t=new Map;return{name:k4,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function K4(t={}){const e={mounts:{"":t.driver||H4()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=h=>{for(const f of e.mountpoints)if(h.startsWith(f))return{base:f,relativeKey:h.slice(f.length),driver:e.mounts[f]};return{base:"",relativeKey:h,driver:e.mounts[""]}},i=(h,f)=>e.mountpoints.filter(l=>l.startsWith(h)||f&&h.startsWith(l)).map(l=>({relativeBase:h.length>l.length?h.slice(l.length):void 0,mountpoint:l,driver:e.mounts[l]})),s=(h,f)=>{if(e.watching){f=Nt(f);for(const l of e.watchListeners)l(h,f)}},n=async()=>{if(!e.watching){e.watching=!0;for(const h in e.mounts)e.unwatch[h]=await Jf(e.mounts[h],s,h)}},a=async()=>{if(e.watching){for(const h in e.unwatch)await e.unwatch[h]();e.unwatch={},e.watching=!1}},o=(h,f,l)=>{const v=new Map,_=m=>{let $=v.get(m.base);return $||($={driver:m.driver,base:m.base,items:[]},v.set(m.base,$)),$};for(const m of h){const $=typeof m=="string",O=Nt($?m:m.key),D=$?void 0:m.value,P=$||!m.options?f:{...f,...m.options},C=r(O);_(C).items.push({key:O,value:D,relativeKey:C.relativeKey,options:P})}return Promise.all([...v.values()].map(m=>l(m))).then(m=>m.flat())},c={hasItem(h,f={}){h=Nt(h);const{relativeKey:l,driver:v}=r(h);return ht(v.hasItem,l,f)},getItem(h,f={}){h=Nt(h);const{relativeKey:l,driver:v}=r(h);return ht(v.getItem,l,f).then(_=>$a(_))},getItems(h,f={}){return o(h,f,l=>l.driver.getItems?ht(l.driver.getItems,l.items.map(v=>({key:v.relativeKey,options:v.options})),f).then(v=>v.map(_=>({key:j4(l.base,_.key),value:$a(_.value)}))):Promise.all(l.items.map(v=>ht(l.driver.getItem,v.relativeKey,v.options).then(_=>({key:v.key,value:$a(_)})))))},getItemRaw(h,f={}){h=Nt(h);const{relativeKey:l,driver:v}=r(h);return v.getItemRaw?ht(v.getItemRaw,l,f):ht(v.getItem,l,f).then(_=>B4(_))},async setItem(h,f,l={}){if(f===void 0)return c.removeItem(h);h=Nt(h);const{relativeKey:v,driver:_}=r(h);_.setItem&&(await ht(_.setItem,v,Fa(f),l),_.watch||s("update",h))},async setItems(h,f){await o(h,f,async l=>{if(l.driver.setItems)return ht(l.driver.setItems,l.items.map(v=>({key:v.relativeKey,value:Fa(v.value),options:v.options})),f);l.driver.setItem&&await Promise.all(l.items.map(v=>ht(l.driver.setItem,v.relativeKey,Fa(v.value),v.options)))})},async setItemRaw(h,f,l={}){if(f===void 0)return c.removeItem(h,l);h=Nt(h);const{relativeKey:v,driver:_}=r(h);if(_.setItemRaw)await ht(_.setItemRaw,v,f,l);else if(_.setItem)await ht(_.setItem,v,F4(f),l);else return;_.watch||s("update",h)},async removeItem(h,f={}){typeof f=="boolean"&&(f={removeMeta:f}),h=Nt(h);const{relativeKey:l,driver:v}=r(h);v.removeItem&&(await ht(v.removeItem,l,f),(f.removeMeta||f.removeMata)&&await ht(v.removeItem,l+"$",f),v.watch||s("remove",h))},async getMeta(h,f={}){typeof f=="boolean"&&(f={nativeOnly:f}),h=Nt(h);const{relativeKey:l,driver:v}=r(h),_=Object.create(null);if(v.getMeta&&Object.assign(_,await ht(v.getMeta,l,f)),!f.nativeOnly){const m=await ht(v.getItem,l+"$",f).then($=>$a($));m&&typeof m=="object"&&(typeof m.atime=="string"&&(m.atime=new Date(m.atime)),typeof m.mtime=="string"&&(m.mtime=new Date(m.mtime)),Object.assign(_,m))}return _},setMeta(h,f,l={}){return this.setItem(h+"$",f,l)},removeMeta(h,f={}){return this.removeItem(h+"$",f)},async getKeys(h,f={}){var O;h=Sa(h);const l=i(h,!0);let v=[];const _=[];let m=!0;for(const D of l){(O=D.driver.flags)!=null&&O.maxDepth||(m=!1);const P=await ht(D.driver.getKeys,D.relativeBase,f);for(const C of P){const T=D.mountpoint+Nt(C);v.some(N=>T.startsWith(N))||_.push(T)}v=[D.mountpoint,...v.filter(C=>!C.startsWith(D.mountpoint))]}const $=f.maxDepth!==void 0&&!m;return _.filter(D=>(!$||U4(D,f.maxDepth))&&z4(D,h))},async clear(h,f={}){h=Sa(h),await Promise.all(i(h,!1).map(async l=>{if(l.driver.clear)return ht(l.driver.clear,l.relativeBase,f);if(l.driver.removeItem){const v=await l.driver.getKeys(l.relativeBase||"",f);return Promise.all(v.map(_=>l.driver.removeItem(_,f)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(h=>Yf(h)))},async watch(h){return await n(),e.watchListeners.push(h),async()=>{e.watchListeners=e.watchListeners.filter(f=>f!==h),e.watchListeners.length===0&&await a()}},async unwatch(){e.watchListeners=[],await a()},mount(h,f){if(h=Sa(h),h&&e.mounts[h])throw new Error(`already mounted at ${h}`);return h&&(e.mountpoints.push(h),e.mountpoints.sort((l,v)=>v.length-l.length)),e.mounts[h]=f,e.watching&&Promise.resolve(Jf(f,s,h)).then(l=>{e.unwatch[h]=l}).catch(console.error),c},async unmount(h,f=!0){var l,v;h=Sa(h),!(!h||!e.mounts[h])&&(e.watching&&h in e.unwatch&&((v=(l=e.unwatch)[h])==null||v.call(l),delete e.unwatch[h]),f&&await Yf(e.mounts[h]),e.mountpoints=e.mountpoints.filter(_=>_!==h),delete e.mounts[h])},getMount(h=""){h=Nt(h)+":";const f=r(h);return{driver:f.driver,base:f.base}},getMounts(h="",f={}){return h=Nt(h),i(h,f.parents).map(v=>({driver:v.driver,base:v.mountpoint}))},keys:(h,f={})=>c.getKeys(h,f),get:(h,f={})=>c.getItem(h,f),set:(h,f,l={})=>c.setItem(h,f,l),has:(h,f={})=>c.hasItem(h,f),del:(h,f={})=>c.removeItem(h,f),remove:(h,f={})=>c.removeItem(h,f)};return c}function Jf(t,e,r){return t.watch?t.watch((i,s)=>e(i,r+s)):()=>{}}async function Yf(t){typeof t.dispose=="function"&&await ht(t.dispose)}function Wi(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function x0(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const i=Wi(r);return(s,n)=>i.then(a=>n(a.transaction(e,s).objectStore(e)))}let lc;function ea(){return lc||(lc=x0("keyval-store","keyval")),lc}function Xf(t,e=ea()){return e("readonly",r=>Wi(r.get(t)))}function V4(t,e,r=ea()){return r("readwrite",i=>(i.put(e,t),Wi(i.transaction)))}function W4(t,e=ea()){return e("readwrite",r=>(r.delete(t),Wi(r.transaction)))}function G4(t=ea()){return t("readwrite",e=>(e.clear(),Wi(e.transaction)))}function J4(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Wi(t.transaction)}function Y4(t=ea()){return t("readonly",e=>{if(e.getAllKeys)return Wi(e.getAllKeys());const r=[];return J4(e,i=>r.push(i.key)).then(()=>r)})}const X4="idb-keyval";var Z4=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=s=>e+s;let i;return t.dbName&&t.storeName&&(i=x0(t.dbName,t.storeName)),{name:X4,options:t,async hasItem(s){return!(typeof await Xf(r(s),i)>"u")},async getItem(s){return await Xf(r(s),i)??null},setItem(s,n){return V4(r(s),n,i)},removeItem(s){return W4(r(s),i)},getKeys(){return Y4(i)},clear(){return G4(i)}}};const Q4="WALLET_CONNECT_V2_INDEXED_DB",e5="keyvaluestorage";let t5=class{constructor(){this.indexedDb=K4({driver:Z4({dbName:Q4,storeName:e5})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Xr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var pc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ba={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof pc<"u"&&pc.localStorage?Ba.exports=pc.localStorage:typeof window<"u"&&window.localStorage?Ba.exports=window.localStorage:Ba.exports=new e})();function r5(t){var e;return[t[0],Li((e=t[1])!=null?e:"")]}let i5=class{constructor(){this.localStorage=Ba.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(r5)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Li(r)}async setItem(e,r){this.localStorage.setItem(e,Xr(r))}async removeItem(e){this.localStorage.removeItem(e)}};const s5="wc_storage_version",Zf=1,n5=async(t,e,r)=>{const i=s5,s=await e.getItem(i);if(s&&s>=Zf){r(e);return}const n=await t.getKeys();if(!n.length){r(e);return}const a=[];for(;n.length;){const o=n.shift();if(!o)continue;const c=o.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const h=await t.getItem(o);await e.setItem(o,h),a.push(o)}}await e.setItem(i,Zf),r(e),a5(t,a)},a5=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let o5=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new i5;this.storage=e;try{const r=new t5;n5(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};function c5(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var h5=u5;function u5(t,e,r){var i=r&&r.stringify||c5,s=1;if(typeof t=="object"&&t!==null){var n=e.length+s;if(n===1)return t;var a=new Array(n);a[0]=i(t);for(var o=1;o<n;o++)a[o]=i(e[o]);return a.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var h="",f=1-s,l=-1,v=t&&t.length||0,_=0;_<v;){if(t.charCodeAt(_)===37&&_+1<v){switch(l=l>-1?l:0,t.charCodeAt(_+1)){case 100:case 102:if(f>=c||e[f]==null)break;l<_&&(h+=t.slice(l,_)),h+=Number(e[f]),l=_+2,_++;break;case 105:if(f>=c||e[f]==null)break;l<_&&(h+=t.slice(l,_)),h+=Math.floor(Number(e[f])),l=_+2,_++;break;case 79:case 111:case 106:if(f>=c||e[f]===void 0)break;l<_&&(h+=t.slice(l,_));var m=typeof e[f];if(m==="string"){h+="'"+e[f]+"'",l=_+2,_++;break}if(m==="function"){h+=e[f].name||"<anonymous>",l=_+2,_++;break}h+=i(e[f]),l=_+2,_++;break;case 115:if(f>=c)break;l<_&&(h+=t.slice(l,_)),h+=String(e[f]),l=_+2,_++;break;case 37:l<_&&(h+=t.slice(l,_)),h+="%",l=_+2,_++,f--;break}++f}++_}return l===-1?t:(l<v&&(h+=t.slice(l)),h)}const Qf=h5;var ws=Cr;const Un=w5().console||{},f5={mapHttpRequest:Ia,mapHttpResponse:Ia,wrapRequestSerializer:bc,wrapResponseSerializer:bc,wrapErrorSerializer:bc,req:Ia,res:Ia,err:g5};function d5(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Cr(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Un;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},s=d5(t.browser.serialize,i);let n=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(n=!1);const a=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const o=t.level||"info",c=Object.create(r);c.log||(c.log=zn),Object.defineProperty(c,"levelVal",{get:f}),Object.defineProperty(c,"level",{get:l,set:v});const h={transmit:e,serialize:s,asObject:t.browser.asObject,levels:a,timestamp:v5(t)};c.levels=Cr.levels,c.level=o,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=zn,c.serializers=i,c._serialize=s,c._stdErrSerialize=n,c.child=_,e&&(c._logEvent=Yc());function f(){return this.level==="silent"?1/0:this.levels.values[this.level]}function l(){return this._level}function v(m){if(m!=="silent"&&!this.levels.values[m])throw Error("unknown level "+m);this._level=m,ns(h,c,"error","log"),ns(h,c,"fatal","error"),ns(h,c,"warn","error"),ns(h,c,"info","log"),ns(h,c,"debug","log"),ns(h,c,"trace","log")}function _(m,$){if(!m)throw new Error("missing bindings for child Pino");$=$||{},s&&m.serializers&&($.serializers=m.serializers);const O=$.serializers;if(s&&O){var D=Object.assign({},i,O),P=t.browser.serialize===!0?Object.keys(D):s;delete m.serializers,Eo([m],P,D,this._stdErrSerialize)}function C(T){this._childLevel=(T._childLevel|0)+1,this.error=as(T,m,"error"),this.fatal=as(T,m,"fatal"),this.warn=as(T,m,"warn"),this.info=as(T,m,"info"),this.debug=as(T,m,"debug"),this.trace=as(T,m,"trace"),D&&(this.serializers=D,this._serialize=P),e&&(this._logEvent=Yc([].concat(T._logEvent.bindings,m)))}return C.prototype=this,new C(this)}return c}Cr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Cr.stdSerializers=f5;Cr.stdTimeFunctions=Object.assign({},{nullTime:$0,epochTime:S0,unixTime:y5,isoTime:m5});function ns(t,e,r,i){const s=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?zn:s[r]?s[r]:Un[r]||Un[i]||zn,l5(t,e,r)}function l5(t,e,r){!t.transmit&&e[r]===zn||(e[r]=function(i){return function(){const n=t.timestamp(),a=new Array(arguments.length),o=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Un?Un:this;for(var c=0;c<a.length;c++)a[c]=arguments[c];if(t.serialize&&!t.asObject&&Eo(a,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(o,p5(this,r,a,n)):i.apply(o,a),t.transmit){const h=t.transmit.level||e.level,f=Cr.levels.values[h],l=Cr.levels.values[r];if(l<f)return;b5(this,{ts:n,methodLevel:r,methodValue:l,transmitValue:Cr.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},a)}}}(e[r]))}function p5(t,e,r,i){t._serialize&&Eo(r,t._serialize,t.serializers,t._stdErrSerialize);const s=r.slice();let n=s[0];const a={};i&&(a.time=i),a.level=Cr.levels.values[e];let o=(t._childLevel|0)+1;if(o<1&&(o=1),n!==null&&typeof n=="object"){for(;o--&&typeof s[0]=="object";)Object.assign(a,s.shift());n=s.length?Qf(s.shift(),s):void 0}else typeof n=="string"&&(n=Qf(s.shift(),s));return n!==void 0&&(a.msg=n),a}function Eo(t,e,r,i){for(const s in t)if(i&&t[s]instanceof Error)t[s]=Cr.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s]))for(const n in t[s])e&&e.indexOf(n)>-1&&n in r&&(t[s][n]=r[n](t[s][n]))}function as(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var s=1;s<i.length;s++)i[s]=arguments[s-1];return t[r].apply(this,i)}}function b5(t,e,r){const i=e.send,s=e.ts,n=e.methodLevel,a=e.methodValue,o=e.val,c=t._logEvent.bindings;Eo(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(h){return c.indexOf(h)===-1}),t._logEvent.level.label=n,t._logEvent.level.value=a,i(n,t._logEvent,o),t._logEvent=Yc(c)}function Yc(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function g5(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function v5(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?$0:S0}function Ia(){return{}}function bc(t){return t}function zn(){}function $0(){return!1}function S0(){return Date.now()}function y5(){return Math.round(Date.now()/1e3)}function m5(){return new Date(Date.now()).toISOString()}function w5(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const ta=vh(ws),_5={level:"info"},ra="custom_context",Kh=1e3*1024;let E5=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},ed=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new E5(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}},I0=class{constructor(e,r=Kh){this.level=e??"error",this.levelValue=ws.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new ed(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===ws.levels.values.error?console.error(e):r===ws.levels.values.warn?console.warn(e):r===ws.levels.values.debug?console.debug(e):r===ws.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Xr({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new ed(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Xr({extraMetadata:e})),new Blob(r,{type:"application/json"})}},x5=class{constructor(e,r=Kh){this.baseChunkLogger=new I0(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}},$5=class{constructor(e,r=Kh){this.baseChunkLogger=new I0(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var S5=Object.defineProperty,I5=Object.defineProperties,A5=Object.getOwnPropertyDescriptors,td=Object.getOwnPropertySymbols,D5=Object.prototype.hasOwnProperty,P5=Object.prototype.propertyIsEnumerable,rd=(t,e,r)=>e in t?S5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ja=(t,e)=>{for(var r in e||(e={}))D5.call(e,r)&&rd(t,r,e[r]);if(td)for(var r of td(e))P5.call(e,r)&&rd(t,r,e[r]);return t},Ya=(t,e)=>I5(t,A5(e));function xo(t){return Ya(Ja({},t),{level:(t==null?void 0:t.level)||_5.level})}function O5(t,e=ra){return t[e]||""}function M5(t,e,r=ra){return t[r]=e,t}function Lt(t,e=ra){let r="";return typeof t.bindings>"u"?r=O5(t,e):r=t.bindings().context||"",r}function C5(t,e,r=ra){const i=Lt(t,r);return i.trim()?`${i}/${e}`:e}function Mt(t,e,r=ra){const i=C5(t,e,r),s=t.child({context:i});return M5(s,i,r)}function T5(t){var e,r;const i=new x5((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:ta(Ya(Ja({},t.opts),{level:"trace",browser:Ya(Ja({},(r=t.opts)==null?void 0:r.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function R5(t){var e;const r=new $5((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:ta(Ya(Ja({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function N5(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?T5(t):R5(t)}var F5=Object.defineProperty,B5=(t,e,r)=>e in t?F5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,id=(t,e,r)=>B5(t,typeof e!="symbol"?e+"":e,r);let q5=class extends Vi{constructor(e){super(),this.opts=e,id(this,"protocol","wc"),id(this,"version",2)}};var L5=Object.defineProperty,j5=(t,e,r)=>e in t?L5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,U5=(t,e,r)=>j5(t,e+"",r);let z5=class extends Vi{constructor(e,r){super(),this.core=e,this.logger=r,U5(this,"records",new Map)}},k5=class{constructor(e,r){this.logger=e,this.core=r}},H5=class extends Vi{constructor(e,r){super(),this.relayer=e,this.logger=r}},K5=class extends Vi{constructor(e){super()}},V5=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}},W5=class extends Vi{constructor(e,r){super(),this.relayer=e,this.logger=r}},G5=class extends Vi{constructor(e,r){super(),this.core=e,this.logger=r}},J5=class{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}},Y5=class{constructor(e,r){this.projectId=e,this.logger=r}},X5=class{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}};var Z5=Object.defineProperty,Q5=(t,e,r)=>e in t?Z5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sd=(t,e,r)=>Q5(t,typeof e!="symbol"?e+"":e,r);let e9=class{constructor(e){this.opts=e,sd(this,"protocol","wc"),sd(this,"version",2)}},t9=class{constructor(e){this.client=e}};const r9="PARSE_ERROR",i9="INVALID_REQUEST",s9="METHOD_NOT_FOUND",n9="INVALID_PARAMS",A0="INTERNAL_ERROR",Vh="SERVER_ERROR",a9=[-32700,-32600,-32601,-32602,-32603],Tn={[r9]:{code:-32700,message:"Parse error"},[i9]:{code:-32600,message:"Invalid Request"},[s9]:{code:-32601,message:"Method not found"},[n9]:{code:-32602,message:"Invalid params"},[A0]:{code:-32603,message:"Internal error"},[Vh]:{code:-32e3,message:"Server error"}},D0=Vh;function o9(t){return a9.includes(t)}function nd(t){return Object.keys(Tn).includes(t)?Tn[t]:Tn[D0]}function c9(t){const e=Object.values(Tn).find(r=>r.code===t);return e||Tn[D0]}function P0(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var O0={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Xc=function(t,e){return Xc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},Xc(t,e)};function h9(t,e){Xc(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Zc=function(){return Zc=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++){r=arguments[i];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Zc.apply(this,arguments)};function u9(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r}function f9(t,e,r,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(n=(s<3?a(n):s>3?a(e,r,n):a(e,r))||n);return s>3&&n&&Object.defineProperty(e,r,n),n}function d9(t,e){return function(r,i){e(r,i,t)}}function l9(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function p9(t,e,r,i){function s(n){return n instanceof r?n:new r(function(a){a(n)})}return new(r||(r=Promise))(function(n,a){function o(f){try{h(i.next(f))}catch(l){a(l)}}function c(f){try{h(i.throw(f))}catch(l){a(l)}}function h(f){f.done?n(f.value):s(f.value).then(o,c)}h((i=i.apply(t,e||[])).next())})}function b9(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(h){return function(f){return c([h,f])}}function c(h){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=h[0]&2?s.return:h[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,h[1])).done)return n;switch(s=0,n&&(h=[h[0]&2,n.value]),h[0]){case 0:case 1:n=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,s=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){r.label=h[1];break}if(h[0]===6&&r.label<n[1]){r.label=n[1],n=h;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(h);break}n[2]&&r.ops.pop(),r.trys.pop();continue}h=e.call(t,r)}catch(f){h=[6,f],s=0}finally{i=n=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function g9(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function v9(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Qc(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function M0(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),s,n=[],a;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return n}function y9(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(M0(arguments[e]));return t}function m9(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),s=0,e=0;e<r;e++)for(var n=arguments[e],a=0,o=n.length;a<o;a++,s++)i[s]=n[a];return i}function kn(t){return this instanceof kn?(this.v=t,this):new kn(t)}function w9(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),s,n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(v){i[v]&&(s[v]=function(_){return new Promise(function(m,$){n.push([v,_,m,$])>1||o(v,_)})})}function o(v,_){try{c(i[v](_))}catch(m){l(n[0][3],m)}}function c(v){v.value instanceof kn?Promise.resolve(v.value.v).then(h,f):l(n[0][2],v)}function h(v){o("next",v)}function f(v){o("throw",v)}function l(v,_){v(_),n.shift(),n.length&&o(n[0][0],n[0][1])}}function _9(t){var e,r;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=t[s]?function(a){return(r=!r)?{value:kn(t[s](a)),done:s==="return"}:n?n(a):a}:n}}function E9(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Qc=="function"?Qc(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(n){r[n]=t[n]&&function(a){return new Promise(function(o,c){a=t[n](a),s(o,c,a.done,a.value)})}}function s(n,a,o,c){Promise.resolve(c).then(function(h){n({value:h,done:o})},a)}}function x9(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function $9(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function S9(t){return t&&t.__esModule?t:{default:t}}function I9(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function A9(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const D9=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Zc},__asyncDelegator:_9,__asyncGenerator:w9,__asyncValues:E9,__await:kn,__awaiter:p9,__classPrivateFieldGet:I9,__classPrivateFieldSet:A9,__createBinding:g9,__decorate:f9,__exportStar:v9,__extends:h9,__generator:b9,__importDefault:S9,__importStar:$9,__makeTemplateObject:x9,__metadata:l9,__param:d9,__read:M0,__rest:u9,__spread:y9,__spreadArrays:m9,__values:Qc},Symbol.toStringTag,{value:"Module"})),P9=vl(D9);var Kr={},ad;function O9(){if(ad)return Kr;ad=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.isBrowserCryptoAvailable=Kr.getSubtleCrypto=Kr.getBrowerCrypto=void 0;function t(){return(Dt===null||Dt===void 0?void 0:Dt.crypto)||(Dt===null||Dt===void 0?void 0:Dt.msCrypto)||{}}Kr.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Kr.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Kr.isBrowserCryptoAvailable=r,Kr}var Vr={},od;function M9(){if(od)return Vr;od=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.isBrowser=Vr.isNode=Vr.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Vr.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Vr.isNode=e;function r(){return!t()&&!e()}return Vr.isBrowser=r,Vr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=P9;e.__exportStar(O9(),t),e.__exportStar(M9(),t)})(O0);function Ar(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Fi(t=6){return BigInt(Ar(t))}function pi(t,e,r){return{id:r||Ar(),jsonrpc:"2.0",method:t,params:e}}function $o(t,e){return{id:t,jsonrpc:"2.0",result:e}}function So(t,e,r){return{id:t,jsonrpc:"2.0",error:C9(e)}}function C9(t,e){return typeof t>"u"?nd(A0):(typeof t=="string"&&(t=Object.assign(Object.assign({},nd(Vh)),{message:t})),o9(t.code)&&(t=c9(t.code)),t)}class T9{}class R9 extends T9{constructor(){super()}}class N9 extends R9{constructor(e){super()}}const F9="^https?:",B9="^wss?:";function q9(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function C0(t,e){const r=q9(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function cd(t){return C0(t,F9)}function hd(t){return C0(t,B9)}function L9(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function T0(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Wh(t){return T0(t)&&"method"in t}function Io(t){return T0(t)&&(Dr(t)||er(t))}function Dr(t){return"result"in t}function er(t){return"error"in t}let ar=class extends N9{constructor(e){super(e),this.events=new ir.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(pi(e.method,e.params||[],e.id||Fi().toString()),r)}async requestStrict(e,r){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{er(n)?s(n.error):i(n.result)});try{await this.connection.send(e,r)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Io(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const j9=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),U9=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ud=t=>t.split("?")[0],fd=10,z9=j9();let k9=class{constructor(e){if(this.url=e,this.events=new ir.EventEmitter,this.registering=!1,!hd(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Xr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!hd(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=O0.isReactNative()?void 0:{rejectUnauthorized:!L9(e)},n=new z9(e,[],s);U9()?n.onerror=a=>{const o=a;i(this.emitError(o.error))}:n.on("error",a=>{i(this.emitError(a))}),n.onopen=()=>{this.onOpen(n),r(n)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Li(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=So(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return P0(e,ud(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>fd&&this.events.setMaxListeners(fd)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${ud(this.url)}`));return this.events.emit("register_error",r),r}};var Xa={exports:{}};Xa.exports;(function(t,e){var r=200,i="__lodash_hash_undefined__",s=1,n=2,a=9007199254740991,o="[object Arguments]",c="[object Array]",h="[object AsyncFunction]",f="[object Boolean]",l="[object Date]",v="[object Error]",_="[object Function]",m="[object GeneratorFunction]",$="[object Map]",O="[object Number]",D="[object Null]",P="[object Object]",C="[object Promise]",T="[object Proxy]",N="[object RegExp]",z="[object Set]",H="[object String]",U="[object Symbol]",B="[object Undefined]",J="[object WeakMap]",S="[object ArrayBuffer]",u="[object DataView]",b="[object Float32Array]",w="[object Float64Array]",p="[object Int8Array]",g="[object Int16Array]",E="[object Int32Array]",I="[object Uint8Array]",y="[object Uint8ClampedArray]",d="[object Uint16Array]",x="[object Uint32Array]",R=/[\\^$.*+?()[\]{}|]/g,j=/^\[object .+?Constructor\]$/,F=/^(?:0|[1-9]\d*)$/,q={};q[b]=q[w]=q[p]=q[g]=q[E]=q[I]=q[y]=q[d]=q[x]=!0,q[o]=q[c]=q[S]=q[f]=q[u]=q[l]=q[v]=q[_]=q[$]=q[O]=q[P]=q[N]=q[z]=q[H]=q[J]=!1;var G=typeof Dt=="object"&&Dt&&Dt.Object===Object&&Dt,X=typeof self=="object"&&self&&self.Object===Object&&self,Q=G||X||Function("return this")(),Y=e&&!e.nodeType&&e,ee=Y&&!0&&t&&!t.nodeType&&t,bt=ee&&ee.exports===Y,ae=bt&&G.process,de=function(){try{return ae&&ae.binding&&ae.binding("util")}catch{}}(),Gt=de&&de.isTypedArray;function ge(A,M){for(var L=-1,W=A==null?0:A.length,Ae=0,Z=[];++L<W;){var Qe=A[L];M(Qe,L,A)&&(Z[Ae++]=Qe)}return Z}function Oe(A,M){for(var L=-1,W=M.length,Ae=A.length;++L<W;)A[Ae+L]=M[L];return A}function Xi(A,M){for(var L=-1,W=A==null?0:A.length;++L<W;)if(M(A[L],L,A))return!0;return!1}function Me(A,M){for(var L=-1,W=Array(A);++L<A;)W[L]=M(L);return W}function xe(A){return function(M){return A(M)}}function mi(A,M){return A.has(M)}function ve(A,M){return A==null?void 0:A[M]}function $e(A){var M=-1,L=Array(A.size);return A.forEach(function(W,Ae){L[++M]=[Ae,W]}),L}function wi(A,M){return function(L){return A(M(L))}}function Se(A){var M=-1,L=Array(A.size);return A.forEach(function(W){L[++M]=W}),L}var Ie=Array.prototype,_i=Function.prototype,be=Object.prototype,ye=Q["__core-js_shared__"],Ei=_i.toString,ne=be.hasOwnProperty,Fe=function(){var A=/[^.]+$/.exec(ye&&ye.keys&&ye.keys.IE_PROTO||"");return A?"Symbol(src)_1."+A:""}(),Ys=be.toString,He=RegExp("^"+Ei.call(ne).replace(R,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Be=bt?Q.Buffer:void 0,xi=Q.Symbol,qe=Q.Uint8Array,Le=be.propertyIsEnumerable,na=Ie.splice,le=xi?xi.toStringTag:void 0,je=Object.getOwnPropertySymbols,aa=Be?Be.isBuffer:void 0,Ke=wi(Object.keys,Object),Ce=Qi(Q,"DataView"),ti=Qi(Q,"Map"),Te=Qi(Q,"Promise"),Re=Qi(Q,"Set"),Zi=Qi(Q,"WeakMap"),me=Qi(Object,"create"),Ve=$i(Ce),oa=$i(ti),We=$i(Te),Ge=$i(Re),ca=$i(Zi),Ue=xi?xi.prototype:void 0,Ne=Ue?Ue.valueOf:void 0;function wr(A){var M=-1,L=A==null?0:A.length;for(this.clear();++M<L;){var W=A[M];this.set(W[0],W[1])}}function Je(){this.__data__=me?me(null):{},this.size=0}function Ye(A){var M=this.has(A)&&delete this.__data__[A];return this.size-=M?1:0,M}function ha(A){var M=this.__data__;if(me){var L=M[A];return L===i?void 0:L}return ne.call(M,A)?M[A]:void 0}function Xe(A){var M=this.__data__;return me?M[A]!==void 0:ne.call(M,A)}function Ze(A,M){var L=this.__data__;return this.size+=this.has(A)?0:1,L[A]=me&&M===void 0?i:M,this}wr.prototype.clear=Je,wr.prototype.delete=Ye,wr.prototype.get=ha,wr.prototype.has=Xe,wr.prototype.set=Ze;function jt(A){var M=-1,L=A==null?0:A.length;for(this.clear();++M<L;){var W=A[M];this.set(W[0],W[1])}}function Xs(){this.__data__=[],this.size=0}function Zs(A){var M=this.__data__,L=ua(M,A);if(L<0)return!1;var W=M.length-1;return L==W?M.pop():na.call(M,L,1),--this.size,!0}function Qs(A){var M=this.__data__,L=ua(M,A);return L<0?void 0:M[L][1]}function en(A){return ua(this.__data__,A)>-1}function tn(A,M){var L=this.__data__,W=ua(L,A);return W<0?(++this.size,L.push([A,M])):L[W][1]=M,this}jt.prototype.clear=Xs,jt.prototype.delete=Zs,jt.prototype.get=Qs,jt.prototype.has=en,jt.prototype.set=tn;function cr(A){var M=-1,L=A==null?0:A.length;for(this.clear();++M<L;){var W=A[M];this.set(W[0],W[1])}}function rn(){this.size=0,this.__data__={hash:new wr,map:new(ti||jt),string:new wr}}function sn(A){var M=fa(this,A).delete(A);return this.size-=M?1:0,M}function nn(A){return fa(this,A).get(A)}function an(A){return fa(this,A).has(A)}function on(A,M){var L=fa(this,A),W=L.size;return L.set(A,M),this.size+=L.size==W?0:1,this}cr.prototype.clear=rn,cr.prototype.delete=sn,cr.prototype.get=nn,cr.prototype.has=an,cr.prototype.set=on;function ri(A){var M=-1,L=A==null?0:A.length;for(this.__data__=new cr;++M<L;)this.add(A[M])}function cn(A){return this.__data__.set(A,i),this}function hn(A){return this.__data__.has(A)}ri.prototype.add=ri.prototype.push=cn,ri.prototype.has=hn;function Jt(A){var M=this.__data__=new jt(A);this.size=M.size}function un(){this.__data__=new jt,this.size=0}function fn(A){var M=this.__data__,L=M.delete(A);return this.size=M.size,L}function dn(A){return this.__data__.get(A)}function $1(A){return this.__data__.has(A)}function S1(A,M){var L=this.__data__;if(L instanceof jt){var W=L.__data__;if(!ti||W.length<r-1)return W.push([A,M]),this.size=++L.size,this;L=this.__data__=new cr(W)}return L.set(A,M),this.size=L.size,this}Jt.prototype.clear=un,Jt.prototype.delete=fn,Jt.prototype.get=dn,Jt.prototype.has=$1,Jt.prototype.set=S1;function I1(A,M){var L=da(A),W=!L&&U1(A),Ae=!L&&!W&&Fo(A),Z=!L&&!W&&!Ae&&cu(A),Qe=L||W||Ae||Z,at=Qe?Me(A.length,String):[],gt=at.length;for(var ze in A)ne.call(A,ze)&&!(Qe&&(ze=="length"||Ae&&(ze=="offset"||ze=="parent")||Z&&(ze=="buffer"||ze=="byteLength"||ze=="byteOffset")||F1(ze,gt)))&&at.push(ze);return at}function ua(A,M){for(var L=A.length;L--;)if(su(A[L][0],M))return L;return-1}function A1(A,M,L){var W=M(A);return da(A)?W:Oe(W,L(A))}function ln(A){return A==null?A===void 0?B:D:le&&le in Object(A)?R1(A):j1(A)}function eu(A){return pn(A)&&ln(A)==o}function tu(A,M,L,W,Ae){return A===M?!0:A==null||M==null||!pn(A)&&!pn(M)?A!==A&&M!==M:D1(A,M,L,W,tu,Ae)}function D1(A,M,L,W,Ae,Z){var Qe=da(A),at=da(M),gt=Qe?c:ii(A),ze=at?c:ii(M);gt=gt==o?P:gt,ze=ze==o?P:ze;var Ut=gt==P,hr=ze==P,$t=gt==ze;if($t&&Fo(A)){if(!Fo(M))return!1;Qe=!0,Ut=!1}if($t&&!Ut)return Z||(Z=new Jt),Qe||cu(A)?ru(A,M,L,W,Ae,Z):C1(A,M,gt,L,W,Ae,Z);if(!(L&s)){var Yt=Ut&&ne.call(A,"__wrapped__"),Xt=hr&&ne.call(M,"__wrapped__");if(Yt||Xt){var si=Yt?A.value():A,jr=Xt?M.value():M;return Z||(Z=new Jt),Ae(si,jr,L,W,Z)}}return $t?(Z||(Z=new Jt),T1(A,M,L,W,Ae,Z)):!1}function P1(A){if(!ou(A)||q1(A))return!1;var M=nu(A)?He:j;return M.test($i(A))}function O1(A){return pn(A)&&au(A.length)&&!!q[ln(A)]}function M1(A){if(!L1(A))return Ke(A);var M=[];for(var L in Object(A))ne.call(A,L)&&L!="constructor"&&M.push(L);return M}function ru(A,M,L,W,Ae,Z){var Qe=L&s,at=A.length,gt=M.length;if(at!=gt&&!(Qe&&gt>at))return!1;var ze=Z.get(A);if(ze&&Z.get(M))return ze==M;var Ut=-1,hr=!0,$t=L&n?new ri:void 0;for(Z.set(A,M),Z.set(M,A);++Ut<at;){var Yt=A[Ut],Xt=M[Ut];if(W)var si=Qe?W(Xt,Yt,Ut,M,A,Z):W(Yt,Xt,Ut,A,M,Z);if(si!==void 0){if(si)continue;hr=!1;break}if($t){if(!Xi(M,function(jr,Si){if(!mi($t,Si)&&(Yt===jr||Ae(Yt,jr,L,W,Z)))return $t.push(Si)})){hr=!1;break}}else if(!(Yt===Xt||Ae(Yt,Xt,L,W,Z))){hr=!1;break}}return Z.delete(A),Z.delete(M),hr}function C1(A,M,L,W,Ae,Z,Qe){switch(L){case u:if(A.byteLength!=M.byteLength||A.byteOffset!=M.byteOffset)return!1;A=A.buffer,M=M.buffer;case S:return!(A.byteLength!=M.byteLength||!Z(new qe(A),new qe(M)));case f:case l:case O:return su(+A,+M);case v:return A.name==M.name&&A.message==M.message;case N:case H:return A==M+"";case $:var at=$e;case z:var gt=W&s;if(at||(at=Se),A.size!=M.size&&!gt)return!1;var ze=Qe.get(A);if(ze)return ze==M;W|=n,Qe.set(A,M);var Ut=ru(at(A),at(M),W,Ae,Z,Qe);return Qe.delete(A),Ut;case U:if(Ne)return Ne.call(A)==Ne.call(M)}return!1}function T1(A,M,L,W,Ae,Z){var Qe=L&s,at=iu(A),gt=at.length,ze=iu(M),Ut=ze.length;if(gt!=Ut&&!Qe)return!1;for(var hr=gt;hr--;){var $t=at[hr];if(!(Qe?$t in M:ne.call(M,$t)))return!1}var Yt=Z.get(A);if(Yt&&Z.get(M))return Yt==M;var Xt=!0;Z.set(A,M),Z.set(M,A);for(var si=Qe;++hr<gt;){$t=at[hr];var jr=A[$t],Si=M[$t];if(W)var hu=Qe?W(Si,jr,$t,M,A,Z):W(jr,Si,$t,A,M,Z);if(!(hu===void 0?jr===Si||Ae(jr,Si,L,W,Z):hu)){Xt=!1;break}si||(si=$t=="constructor")}if(Xt&&!si){var la=A.constructor,pa=M.constructor;la!=pa&&"constructor"in A&&"constructor"in M&&!(typeof la=="function"&&la instanceof la&&typeof pa=="function"&&pa instanceof pa)&&(Xt=!1)}return Z.delete(A),Z.delete(M),Xt}function iu(A){return A1(A,H1,N1)}function fa(A,M){var L=A.__data__;return B1(M)?L[typeof M=="string"?"string":"hash"]:L.map}function Qi(A,M){var L=ve(A,M);return P1(L)?L:void 0}function R1(A){var M=ne.call(A,le),L=A[le];try{A[le]=void 0;var W=!0}catch{}var Ae=Ys.call(A);return W&&(M?A[le]=L:delete A[le]),Ae}var N1=je?function(A){return A==null?[]:(A=Object(A),ge(je(A),function(M){return Le.call(A,M)}))}:K1,ii=ln;(Ce&&ii(new Ce(new ArrayBuffer(1)))!=u||ti&&ii(new ti)!=$||Te&&ii(Te.resolve())!=C||Re&&ii(new Re)!=z||Zi&&ii(new Zi)!=J)&&(ii=function(A){var M=ln(A),L=M==P?A.constructor:void 0,W=L?$i(L):"";if(W)switch(W){case Ve:return u;case oa:return $;case We:return C;case Ge:return z;case ca:return J}return M});function F1(A,M){return M=M??a,!!M&&(typeof A=="number"||F.test(A))&&A>-1&&A%1==0&&A<M}function B1(A){var M=typeof A;return M=="string"||M=="number"||M=="symbol"||M=="boolean"?A!=="__proto__":A===null}function q1(A){return!!Fe&&Fe in A}function L1(A){var M=A&&A.constructor,L=typeof M=="function"&&M.prototype||be;return A===L}function j1(A){return Ys.call(A)}function $i(A){if(A!=null){try{return Ei.call(A)}catch{}try{return A+""}catch{}}return""}function su(A,M){return A===M||A!==A&&M!==M}var U1=eu(function(){return arguments}())?eu:function(A){return pn(A)&&ne.call(A,"callee")&&!Le.call(A,"callee")},da=Array.isArray;function z1(A){return A!=null&&au(A.length)&&!nu(A)}var Fo=aa||V1;function k1(A,M){return tu(A,M)}function nu(A){if(!ou(A))return!1;var M=ln(A);return M==_||M==m||M==h||M==T}function au(A){return typeof A=="number"&&A>-1&&A%1==0&&A<=a}function ou(A){var M=typeof A;return A!=null&&(M=="object"||M=="function")}function pn(A){return A!=null&&typeof A=="object"}var cu=Gt?xe(Gt):O1;function H1(A){return z1(A)?I1(A):M1(A)}function K1(){return[]}function V1(){return!1}t.exports=k1})(Xa,Xa.exports);var H9=Xa.exports;const K9=vh(H9),R0="wc",N0=2,eh="core",Br=`${R0}@2:${eh}:`,V9={logger:"error"},W9={database:":memory:"},G9="crypto",dd="client_ed25519_seed",J9=K.ONE_DAY,Y9="keychain",X9="0.3",Z9="messages",Q9="0.3",ld=K.SIX_HOURS,e7="publisher",F0="irn",t7="error",B0="wss://relay.walletconnect.org",r7="relayer",ut={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},i7="_subscription",Zt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},s7=.1,th="2.19.0",Pe={link_mode:"link_mode",relay:"relay"},n7="0.3",a7="WALLETCONNECT_CLIENT_ID",pd="WALLETCONNECT_LINK_MODE_APPS",kt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},o7="subscription",c7="0.3",h7=K.FIVE_SECONDS*1e3,u7="pairing",f7="0.3",Sn={wc_pairingDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:K.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:K.ONE_DAY,prompt:!1,tag:0},res:{ttl:K.ONE_DAY,prompt:!1,tag:0}}},Ri={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},dr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},d7="history",l7="0.3",p7="expirer",Qt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},b7="0.3",g7="verify-api",v7="https://verify.walletconnect.com",q0="https://verify.walletconnect.org",Rn=q0,y7=`${Rn}/v3`,m7=[v7,q0],w7="echo",_7="https://echo.walletconnect.com",Ir={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Wr={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},lr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Pi={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Oi={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},In={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},E7=.1,x7="event-client",$7=86400,S7="https://pulse.walletconnect.org/batch";function I7(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),a=n.charCodeAt(0);if(r[a]!==255)throw new TypeError(n+" is ambiguous");r[a]=s}var o=t.length,c=t.charAt(0),h=Math.log(o)/Math.log(256),f=Math.log(256)/Math.log(o);function l(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var $=0,O=0,D=0,P=m.length;D!==P&&m[D]===0;)D++,$++;for(var C=(P-D)*f+1>>>0,T=new Uint8Array(C);D!==P;){for(var N=m[D],z=0,H=C-1;(N!==0||z<O)&&H!==-1;H--,z++)N+=256*T[H]>>>0,T[H]=N%o>>>0,N=N/o>>>0;if(N!==0)throw new Error("Non-zero carry");O=z,D++}for(var U=C-O;U!==C&&T[U]===0;)U++;for(var B=c.repeat($);U<C;++U)B+=t.charAt(T[U]);return B}function v(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var $=0;if(m[$]!==" "){for(var O=0,D=0;m[$]===c;)O++,$++;for(var P=(m.length-$)*h+1>>>0,C=new Uint8Array(P);m[$];){var T=r[m.charCodeAt($)];if(T===255)return;for(var N=0,z=P-1;(T!==0||N<D)&&z!==-1;z--,N++)T+=o*C[z]>>>0,C[z]=T%256>>>0,T=T/256>>>0;if(T!==0)throw new Error("Non-zero carry");D=N,$++}if(m[$]!==" "){for(var H=P-D;H!==P&&C[H]===0;)H++;for(var U=new Uint8Array(O+(P-H)),B=O;H!==P;)U[B++]=C[H++];return U}}}function _(m){var $=v(m);if($)return $;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:v,decode:_}}var A7=I7,D7=A7;const L0=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},P7=t=>new TextEncoder().encode(t),O7=t=>new TextDecoder().decode(t);let M7=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},C7=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return j0(this,e)}},T7=class{constructor(e){this.decoders=e}or(e){return j0(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const j0=(t,e)=>new T7({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let R7=class{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new M7(e,r,i),this.decoder=new C7(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Ao=({name:t,prefix:e,encode:r,decode:i})=>new R7(t,e,r,i),ia=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=D7(r,e);return Ao({prefix:t,name:e,encode:i,decode:n=>L0(s(n))})},N7=(t,e,r,i)=>{const s={};for(let f=0;f<e.length;++f)s[e[f]]=f;let n=t.length;for(;t[n-1]==="=";)--n;const a=new Uint8Array(n*r/8|0);let o=0,c=0,h=0;for(let f=0;f<n;++f){const l=s[t[f]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|l,o+=r,o>=8&&(o-=8,a[h++]=255&c>>o)}if(o>=r||255&c<<8-o)throw new SyntaxError("Unexpected end of data");return a},F7=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",a=0,o=0;for(let c=0;c<t.length;++c)for(o=o<<8|t[c],a+=8;a>r;)a-=r,n+=e[s&o>>a];if(a&&(n+=e[s&o<<r-a]),i)for(;n.length*r&7;)n+="=";return n},xt=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Ao({prefix:e,name:t,encode(s){return F7(s,i,r)},decode(s){return N7(s,i,r,t)}}),B7=Ao({prefix:"\0",name:"identity",encode:t=>O7(t),decode:t=>P7(t)});var q7=Object.freeze({__proto__:null,identity:B7});const L7=xt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var j7=Object.freeze({__proto__:null,base2:L7});const U7=xt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var z7=Object.freeze({__proto__:null,base8:U7});const k7=ia({prefix:"9",name:"base10",alphabet:"0123456789"});var H7=Object.freeze({__proto__:null,base10:k7});const K7=xt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),V7=xt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var W7=Object.freeze({__proto__:null,base16:K7,base16upper:V7});const G7=xt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),J7=xt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Y7=xt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),X7=xt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Z7=xt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Q7=xt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),e_=xt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),t_=xt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),r_=xt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var i_=Object.freeze({__proto__:null,base32:G7,base32upper:J7,base32pad:Y7,base32padupper:X7,base32hex:Z7,base32hexupper:Q7,base32hexpad:e_,base32hexpadupper:t_,base32z:r_});const s_=ia({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),n_=ia({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var a_=Object.freeze({__proto__:null,base36:s_,base36upper:n_});const o_=ia({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),c_=ia({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var h_=Object.freeze({__proto__:null,base58btc:o_,base58flickr:c_});const u_=xt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),f_=xt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),d_=xt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),l_=xt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var p_=Object.freeze({__proto__:null,base64:u_,base64pad:f_,base64url:d_,base64urlpad:l_});const U0=Array.from(""),b_=U0.reduce((t,e,r)=>(t[r]=e,t),[]),g_=U0.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function v_(t){return t.reduce((e,r)=>(e+=b_[r],e),"")}function y_(t){const e=[];for(const r of t){const i=g_[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const m_=Ao({prefix:"",name:"base256emoji",encode:v_,decode:y_});var w_=Object.freeze({__proto__:null,base256emoji:m_}),__=z0,bd=128,E_=-128,x_=Math.pow(2,31);function z0(t,e,r){e=e||[],r=r||0;for(var i=r;t>=x_;)e[r++]=t&255|bd,t/=128;for(;t&E_;)e[r++]=t&255|bd,t>>>=7;return e[r]=t|0,z0.bytes=r-i+1,e}var $_=rh,S_=128,gd=127;function rh(t,i){var r=0,i=i||0,s=0,n=i,a,o=t.length;do{if(n>=o)throw rh.bytes=0,new RangeError("Could not decode varint");a=t[n++],r+=s<28?(a&gd)<<s:(a&gd)*Math.pow(2,s),s+=7}while(a>=S_);return rh.bytes=n-i,r}var I_=Math.pow(2,7),A_=Math.pow(2,14),D_=Math.pow(2,21),P_=Math.pow(2,28),O_=Math.pow(2,35),M_=Math.pow(2,42),C_=Math.pow(2,49),T_=Math.pow(2,56),R_=Math.pow(2,63),N_=function(t){return t<I_?1:t<A_?2:t<D_?3:t<P_?4:t<O_?5:t<M_?6:t<C_?7:t<T_?8:t<R_?9:10},F_={encode:__,decode:$_,encodingLength:N_},k0=F_;const vd=(t,e,r=0)=>(k0.encode(t,e,r),e),yd=t=>k0.encodingLength(t),ih=(t,e)=>{const r=e.byteLength,i=yd(t),s=i+yd(r),n=new Uint8Array(s+r);return vd(t,n,0),vd(r,n,i),n.set(e,s),new B_(t,r,e,n)};let B_=class{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}};const H0=({name:t,code:e,encode:r})=>new q_(t,e,r);let q_=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?ih(this.code,r):r.then(i=>ih(this.code,i))}else throw Error("Unknown type, must be binary type")}};const K0=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),L_=H0({name:"sha2-256",code:18,encode:K0("SHA-256")}),j_=H0({name:"sha2-512",code:19,encode:K0("SHA-512")});var U_=Object.freeze({__proto__:null,sha256:L_,sha512:j_});const V0=0,z_="identity",W0=L0,k_=t=>ih(V0,W0(t)),H_={code:V0,name:z_,encode:W0,digest:k_};var K_=Object.freeze({__proto__:null,identity:H_});new TextEncoder,new TextDecoder;const md={...q7,...j7,...z7,...H7,...W7,...i_,...a_,...h_,...p_,...w_};({...U_,...K_});function V_(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function G0(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const wd=G0("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),gc=G0("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=V_(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),W_={utf8:wd,"utf-8":wd,hex:md.base16,latin1:gc,ascii:gc,binary:gc,...md};function G_(t,e="utf8"){const r=W_[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}var J_=Object.defineProperty,Y_=(t,e,r)=>e in t?J_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xr=(t,e,r)=>Y_(t,typeof e!="symbol"?e+"":e,r);let X_=class{constructor(e,r){this.core=e,this.logger=r,xr(this,"keychain",new Map),xr(this,"name",Y9),xr(this,"version",X9),xr(this,"initialized",!1),xr(this,"storagePrefix",Br),xr(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),xr(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),xr(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),xr(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=V("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),xr(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=Mt(r,this.name)}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Vp(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Wp(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}};var Z_=Object.defineProperty,Q_=(t,e,r)=>e in t?Z_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yt=(t,e,r)=>Q_(t,typeof e!="symbol"?e+"":e,r);let eE=class{constructor(e,r,i){this.core=e,this.logger=r,yt(this,"name",G9),yt(this,"keychain"),yt(this,"randomSessionIdentifier",Gc()),yt(this,"initialized",!1),yt(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),yt(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),yt(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=Yu(s);return up(n.publicKey)}),yt(this,"generateKeyPair",()=>{this.isInitialized();const s=O8();return this.setPrivateKey(s.publicKey,s.privateKey)}),yt(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),a=Yu(n),o=this.randomSessionIdentifier;return await $m(o,s,J9,a)}),yt(this,"generateSharedKey",(s,n,a)=>{this.isInitialized();const o=this.getPrivateKey(s),c=M8(o,n);return this.setSymKey(c,a)}),yt(this,"setSymKey",async(s,n)=>{this.isInitialized();const a=n||Na(s);return await this.keychain.set(a,s),a}),yt(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),yt(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),yt(this,"encode",async(s,n,a)=>{this.isInitialized();const o=m0(a),c=Xr(n);if(Lf(o))return R8(c,a==null?void 0:a.encoding);if(qf(o)){const v=o.senderPublicKey,_=o.receiverPublicKey;s=await this.generateSharedKey(v,_)}const h=this.getSymKey(s),{type:f,senderPublicKey:l}=o;return C8({type:f,symKey:h,message:c,senderPublicKey:l,encoding:a==null?void 0:a.encoding})}),yt(this,"decode",async(s,n,a)=>{this.isInitialized();const o=F8(n,a);if(Lf(o)){const c=N8(n,a==null?void 0:a.encoding);return Li(c)}if(qf(o)){const c=o.receiverPublicKey,h=o.senderPublicKey;s=await this.generateSharedKey(c,h)}try{const c=this.getSymKey(s),h=T8({symKey:c,encoded:n,encoding:a==null?void 0:a.encoding});return Li(h)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),yt(this,"getPayloadType",(s,n=li)=>{const a=Ln({encoded:s,encoding:n});return zi(a.type)}),yt(this,"getPayloadSenderPublicKey",(s,n=li)=>{const a=Ln({encoded:s,encoding:n});return a.senderPublicKey?Ot(a.senderPublicKey,At):void 0}),this.core=e,this.logger=Mt(r,this.name),this.keychain=i||new X_(this.core,this.logger)}get context(){return Lt(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(dd)}catch{e=Gc(),await this.keychain.set(dd,e)}return G_(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}};var tE=Object.defineProperty,rE=(t,e,r)=>e in t?tE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$r=(t,e,r)=>rE(t,typeof e!="symbol"?e+"":e,r);let iE=class extends k5{constructor(e,r){super(e,r),this.logger=e,this.core=r,$r(this,"messages",new Map),$r(this,"name",Z9),$r(this,"version",Q9),$r(this,"initialized",!1),$r(this,"storagePrefix",Br),$r(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),$r(this,"set",async(i,s)=>{this.isInitialized();const n=Gr(s);let a=this.messages.get(i);return typeof a>"u"&&(a={}),typeof a[n]<"u"||(a[n]=s,this.messages.set(i,a),await this.persist()),n}),$r(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),$r(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),a=Gr(s);return typeof n[a]<"u"}),$r(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()}),this.logger=Mt(e,this.name),this.core=r}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Vp(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Wp(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}};var sE=Object.defineProperty,nE=Object.defineProperties,aE=Object.getOwnPropertyDescriptors,_d=Object.getOwnPropertySymbols,oE=Object.prototype.hasOwnProperty,cE=Object.prototype.propertyIsEnumerable,sh=(t,e,r)=>e in t?sE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Aa=(t,e)=>{for(var r in e||(e={}))oE.call(e,r)&&sh(t,r,e[r]);if(_d)for(var r of _d(e))cE.call(e,r)&&sh(t,r,e[r]);return t},vc=(t,e)=>nE(t,aE(e)),pr=(t,e,r)=>sh(t,typeof e!="symbol"?e+"":e,r);let hE=class extends H5{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,pr(this,"events",new ir.EventEmitter),pr(this,"name",e7),pr(this,"queue",new Map),pr(this,"publishTimeout",K.toMiliseconds(K.ONE_MINUTE)),pr(this,"initialPublishTimeout",K.toMiliseconds(K.ONE_SECOND*15)),pr(this,"needsTransportRestart",!1),pr(this,"publish",async(i,s,n)=>{var a;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const o=(n==null?void 0:n.ttl)||ld,c=Wa(n),h=(n==null?void 0:n.prompt)||!1,f=(n==null?void 0:n.tag)||0,l=(n==null?void 0:n.id)||Fi().toString(),v={topic:i,message:s,opts:{ttl:o,relay:c,prompt:h,tag:f,id:l,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}},_=`Failed to publish payload, please try again. id:${l} tag:${f}`;try{const m=new Promise(async $=>{const O=({id:P})=>{v.opts.id===P&&(this.removeRequestFromQueue(P),this.relayer.events.removeListener(ut.publish,O),$(v))};this.relayer.events.on(ut.publish,O);const D=di(new Promise((P,C)=>{this.rpcPublish({topic:i,message:s,ttl:o,prompt:h,tag:f,id:l,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}).then(P).catch(T=>{this.logger.warn(T,T==null?void 0:T.message),C(T)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${f}`);try{await D,this.events.removeListener(ut.publish,O)}catch(P){this.queue.set(l,vc(Aa({},v),{attempt:1})),this.logger.warn(P,P==null?void 0:P.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:i,message:s,opts:n}}),await di(m,this.publishTimeout,_)}catch(m){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(m),(a=n==null?void 0:n.internal)!=null&&a.throwOnFailedPublish)throw m}finally{this.queue.delete(l)}}),pr(this,"on",(i,s)=>{this.events.on(i,s)}),pr(this,"once",(i,s)=>{this.events.once(i,s)}),pr(this,"off",(i,s)=>{this.events.off(i,s)}),pr(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=Mt(r,this.name),this.registerEventListeners()}get context(){return Lt(this.logger)}async rpcPublish(e){var r,i,s,n;const{topic:a,message:o,ttl:c=ld,prompt:h,tag:f,id:l,attestation:v,tvf:_}=e,m={method:On(Wa().protocol).publish,params:Aa({topic:a,message:o,ttl:c,prompt:h,tag:f,attestation:v},_),id:l};Pt((r=m.params)==null?void 0:r.prompt)&&((i=m.params)==null||delete i.prompt),Pt((s=m.params)==null?void 0:s.tag)&&((n=m.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:m});const $=await this.relayer.request(m);return this.relayer.events.emit(ut.publish,e),this.logger.debug("Successfully Published Payload"),$}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{const i=e.attempt+1;this.queue.set(r,vc(Aa({},e),{attempt:i}));const{topic:s,message:n,opts:a,attestation:o}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish(vc(Aa({},e),{topic:s,message:n,ttl:a.ttl,prompt:a.prompt,tag:a.tag,id:a.id,attestation:o,tvf:a.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Gs.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ut.connection_stalled);return}this.checkQueue()}),this.relayer.on(ut.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}};var uE=Object.defineProperty,fE=(t,e,r)=>e in t?uE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,os=(t,e,r)=>fE(t,typeof e!="symbol"?e+"":e,r);let dE=class{constructor(){os(this,"map",new Map),os(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),os(this,"get",e=>this.map.get(e)||[]),os(this,"exists",(e,r)=>this.get(e).includes(r)),os(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(n=>n!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),os(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}};var lE=Object.defineProperty,pE=Object.defineProperties,bE=Object.getOwnPropertyDescriptors,Ed=Object.getOwnPropertySymbols,gE=Object.prototype.hasOwnProperty,vE=Object.prototype.propertyIsEnumerable,nh=(t,e,r)=>e in t?lE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,An=(t,e)=>{for(var r in e||(e={}))gE.call(e,r)&&nh(t,r,e[r]);if(Ed)for(var r of Ed(e))vE.call(e,r)&&nh(t,r,e[r]);return t},yc=(t,e)=>pE(t,bE(e)),pe=(t,e,r)=>nh(t,typeof e!="symbol"?e+"":e,r);let yE=class extends W5{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,pe(this,"subscriptions",new Map),pe(this,"topicMap",new dE),pe(this,"events",new ir.EventEmitter),pe(this,"name",o7),pe(this,"version",c7),pe(this,"pending",new Map),pe(this,"cached",[]),pe(this,"initialized",!1),pe(this,"pendingSubscriptionWatchLabel","pending_sub_watch_label"),pe(this,"pollingInterval",20),pe(this,"storagePrefix",Br),pe(this,"subscribeTimeout",K.toMiliseconds(K.ONE_MINUTE)),pe(this,"initialSubscribeTimeout",K.toMiliseconds(K.ONE_SECOND*15)),pe(this,"clientId"),pe(this,"batchSubscribeTopicsLimit",500),pe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),pe(this,"subscribe",async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const n=Wa(s),a={topic:i,relay:n,transportType:s==null?void 0:s.transportType};this.pending.set(i,a);const o=await this.rpcSubscribe(i,n,s);return typeof o=="string"&&(this.onSubscribe(o,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),o}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),pe(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),pe(this,"isSubscribed",async i=>{if(this.topics.includes(i))return!0;const s=`${this.pendingSubscriptionWatchLabel}_${i}`;return await new Promise((n,a)=>{const o=new K.Watch;o.start(s);const c=setInterval(()=>{(!this.pending.has(i)&&this.topics.includes(i)||this.cached.some(h=>h.topic===i))&&(clearInterval(c),o.stop(s),n(!0)),o.elapsed(s)>=h7&&(clearInterval(c),o.stop(s),a(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)}),pe(this,"on",(i,s)=>{this.events.on(i,s)}),pe(this,"once",(i,s)=>{this.events.once(i,s)}),pe(this,"off",(i,s)=>{this.events.off(i,s)}),pe(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),pe(this,"start",async()=>{await this.onConnect()}),pe(this,"stop",async()=>{await this.onDisconnect()}),pe(this,"restart",async()=>{await this.restore(),await this.onRestart()}),pe(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),pe(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Gs.pulse,async()=>{await this.checkPending()}),this.events.on(kt.created,async i=>{const s=kt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(kt.deleted,async i=>{const s=kt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=Mt(r,this.name),this.clientId=""}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=Wa(i);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);const n=fe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,i){var s;(!i||(i==null?void 0:i.transportType)===Pe.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const n={method:On(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const a=(s=i==null?void 0:i.internal)==null?void 0:s.throwOnFailedPublish;try{const o=await this.getSubscriptionId(e);if((i==null?void 0:i.transportType)===Pe.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(f=>this.logger.warn(f))},K.toMiliseconds(K.ONE_SECOND)),o;const c=new Promise(async f=>{const l=v=>{v.topic===e&&(this.events.removeListener(kt.created,l),f(v.id))};this.events.on(kt.created,l);try{const v=await di(new Promise((_,m)=>{this.relayer.request(n).catch($=>{this.logger.warn($,$==null?void 0:$.message),m($)}).then(_)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(kt.created,l),f(v)}catch{}}),h=await di(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!h&&a)throw new Error(`Subscribing to ${e} failed, please try again`);return h?o:null}catch(o){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ut.connection_stalled),a)throw o}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:On(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await di(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(ut.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:On(r.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await di(new Promise((n,a)=>{this.relayer.request(i).catch(o=>{this.logger.warn(o),a(o)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(ut.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:On(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,yc(An({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,An({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,An({},r)),this.topicMap.set(r.topic,e),this.events.emit(kt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(kt.deleted,yc(An({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(kt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(kt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>yc(An({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await Hw(K.toMiliseconds(K.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Gr(e+await this.getClientId())}};var mE=Object.defineProperty,xd=Object.getOwnPropertySymbols,wE=Object.prototype.hasOwnProperty,_E=Object.prototype.propertyIsEnumerable,ah=(t,e,r)=>e in t?mE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$d=(t,e)=>{for(var r in e||(e={}))wE.call(e,r)&&ah(t,r,e[r]);if(xd)for(var r of xd(e))_E.call(e,r)&&ah(t,r,e[r]);return t},ce=(t,e,r)=>ah(t,typeof e!="symbol"?e+"":e,r);let EE=class extends K5{constructor(e){super(e),ce(this,"protocol","wc"),ce(this,"version",2),ce(this,"core"),ce(this,"logger"),ce(this,"events",new ir.EventEmitter),ce(this,"provider"),ce(this,"messages"),ce(this,"subscriber"),ce(this,"publisher"),ce(this,"name",r7),ce(this,"transportExplicitlyClosed",!1),ce(this,"initialized",!1),ce(this,"connectionAttemptInProgress",!1),ce(this,"relayUrl"),ce(this,"projectId"),ce(this,"packageName"),ce(this,"bundleId"),ce(this,"hasExperiencedNetworkDisruption",!1),ce(this,"pingTimeout"),ce(this,"heartBeatTimeout",K.toMiliseconds(K.THIRTY_SECONDS+K.FIVE_SECONDS)),ce(this,"reconnectTimeout"),ce(this,"connectPromise"),ce(this,"reconnectInProgress",!1),ce(this,"requestsInFlight",[]),ce(this,"connectTimeout",K.toMiliseconds(K.ONE_SECOND*15)),ce(this,"request",async r=>{var i,s;this.logger.debug("Publishing Request Payload");const n=r.id||Fi().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");const a=`${n}:${((s=r.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const o=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==a),o}catch(a){throw this.logger.debug(`Failed to Publish Request: ${n}`),a}}),ce(this,"resetPingTimeout",()=>{if(Ka())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s;this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||s.terminate()},this.heartBeatTimeout)}catch(r){this.logger.warn(r,r==null?void 0:r.message)}}),ce(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),ce(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(ut.connect)}),ce(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),ce(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(ut.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ce(this,"registerProviderListeners",()=>{this.provider.on(Zt.payload,this.onPayloadHandler),this.provider.on(Zt.connect,this.onConnectHandler),this.provider.on(Zt.disconnect,this.onDisconnectHandler),this.provider.on(Zt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Mt(e.logger,this.name):ta(xo({level:e.logger||t7})),this.messages=new iE(this.logger,e.core),this.subscriber=new yE(this,this.logger),this.publisher=new hE(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||B0,this.projectId=e.projectId,Pw()?this.packageName=ff():Ow()&&(this.bundleId=ff()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}get context(){return Lt(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:Pe.relay})}async subscribe(e,r){var i,s,n;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const a=typeof((i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=r==null?void 0:r.internal)==null?void 0:s.throwOnFailedPublish;let o=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const h=f=>{f.topic===e&&(this.subscriber.off(kt.created,h),c())};return await Promise.all([new Promise(f=>{c=f,this.subscriber.on(kt.created,h)}),new Promise(async(f,l)=>{o=await this.subscriber.subscribe(e,$d({internal:{throwOnFailedPublish:a}},r)).catch(v=>{a&&l(v)})||o,f()})]),o}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await di(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Wf())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const s=st(K.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(ut.message,e),await this.recordMessageEvent(e)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Zt.disconnect,n),await di(new Promise((a,o)=>{this.provider.connect().then(a).catch(o)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{s(a)}).finally(()=>{this.provider.off(Zt.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,o)=>{const c=()=>{o(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Zt.disconnect,c),await this.subscriber.start().then(a).catch(o).finally(()=>{this.provider.off(Zt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,K.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,s,n;if(Ka())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a==null?void 0:a.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ar(new k9(Rw({sdkVersion:th,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.warn(`Ignoring message for non-subscribed topic ${r}`),!0;const s=this.messages.has(r,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Wh(e)){if(!e.method.endsWith(i7))return;const r=e.params,{topic:i,message:s,publishedAt:n,attestation:a}=r.data,o={topic:i,message:s,publishedAt:n,transportType:Pe.relay,attestation:a};this.logger.debug("Emitting Relayer Payload"),this.logger.trace($d({type:"event",event:r.id},o)),this.events.emit(r.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else Io(e)&&this.events.emit(ut.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(ut.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=$o(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Zt.payload,this.onPayloadHandler),this.provider.off(Zt.connect,this.onConnectHandler),this.provider.off(Zt.disconnect,this.onDisconnectHandler),this.provider.off(Zt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Wf();x4(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(ut.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},K.toMiliseconds(s7)))))}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&await this.connect()}};var xE=Object.defineProperty,Sd=Object.getOwnPropertySymbols,$E=Object.prototype.hasOwnProperty,SE=Object.prototype.propertyIsEnumerable,oh=(t,e,r)=>e in t?xE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Id=(t,e)=>{for(var r in e||(e={}))$E.call(e,r)&&oh(t,r,e[r]);if(Sd)for(var r of Sd(e))SE.call(e,r)&&oh(t,r,e[r]);return t},Tt=(t,e,r)=>oh(t,typeof e!="symbol"?e+"":e,r);let Gi=class extends V5{constructor(e,r,i,s=Br,n=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,Tt(this,"map",new Map),Tt(this,"version",n7),Tt(this,"cached",[]),Tt(this,"initialized",!1),Tt(this,"getKey"),Tt(this,"storagePrefix",Br),Tt(this,"recentlyDeleted",[]),Tt(this,"recentlyDeletedLimit",200),Tt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!Pt(a)?this.map.set(this.getKey(a),a):e4(a)?this.map.set(a.id,a):t4(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),Tt(this,"set",async(a,o)=>{this.isInitialized(),this.map.has(a)?await this.update(a,o):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:o}),this.map.set(a,o),await this.persist())}),Tt(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),Tt(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(o=>Object.keys(a).every(c=>K9(o[c],a[c]))):this.values)),Tt(this,"update",async(a,o)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:o});const c=Id(Id({},this.getData(a)),o);this.map.set(a,c),await this.persist()}),Tt(this,"delete",async(a,o)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:o}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=Mt(r,this.name),this.storagePrefix=s,this.getKey=n}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:s}=V("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}};var IE=Object.defineProperty,AE=(t,e,r)=>e in t?IE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ie=(t,e,r)=>AE(t,typeof e!="symbol"?e+"":e,r);let DE=class{constructor(e,r){this.core=e,this.logger=r,ie(this,"name",u7),ie(this,"version",f7),ie(this,"events",new yh),ie(this,"pairings"),ie(this,"initialized",!1),ie(this,"storagePrefix",Br),ie(this,"ignoredPayloadTypes",[Yr]),ie(this,"registeredMethods",[]),ie(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ie(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),ie(this,"create",async i=>{this.isInitialized();const s=Gc(),n=await this.core.crypto.setSymKey(s),a=st(K.FIVE_MINUTES),o={protocol:F0},c={topic:n,expiry:a,relay:o,active:!1,methods:i==null?void 0:i.methods},h=Uf({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:o,expiryTimestamp:a,methods:i==null?void 0:i.methods});return this.events.emit(Ri.create,c),this.core.expirer.set(n,a),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i==null?void 0:i.transportType}),{topic:n,uri:h}}),ie(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[Ir.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:a,relay:o,expiryTimestamp:c,methods:h}=jf(i.uri);s.props.properties.topic=n,s.addTrace(Ir.pairing_uri_validation_success),s.addTrace(Ir.pairing_uri_not_expired);let f;if(this.pairings.keys.includes(n)){if(f=this.pairings.get(n),s.addTrace(Ir.existing_pairing),f.active)throw s.setError(Wr.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(Ir.pairing_not_expired)}const l=c||st(K.FIVE_MINUTES),v={topic:n,relay:o,expiry:l,active:!1,methods:h};this.core.expirer.set(n,l),await this.pairings.set(n,v),s.addTrace(Ir.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(Ri.create,v),s.addTrace(Ir.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(a,n),s.addTrace(Ir.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(Wr.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:o})}catch(_){throw s.setError(Wr.subscribe_pairing_topic_failure),_}return s.addTrace(Ir.subscribe_pairing_topic_success),v}),ie(this,"activate",async({topic:i})=>{this.isInitialized();const s=st(K.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),ie(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:a,resolve:o,reject:c}=Mi();this.events.once(ue("pairing_ping",n),({error:h})=>{h?c(h):o()}),await a()}}),ie(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),ie(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),ie(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ie(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",fe("USER_DISCONNECTED")),await this.deletePairing(s))}),ie(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:a,methods:o}=i,c=this.core.crypto.keychain.get(s);return Uf({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:a,methods:o})}),ie(this,"sendRequest",async(i,s,n)=>{const a=pi(s,n),o=await this.core.crypto.encode(i,a),c=Sn[s].req;return this.core.history.set(i,a),this.core.relayer.publish(i,o,c),a.id}),ie(this,"sendResult",async(i,s,n)=>{const a=$o(i,n),o=await this.core.crypto.encode(s,a),c=(await this.core.history.get(s,i)).request.method,h=Sn[c].res;await this.core.relayer.publish(s,o,h),await this.core.history.resolve(a)}),ie(this,"sendError",async(i,s,n)=>{const a=So(i,n),o=await this.core.crypto.encode(s,a),c=(await this.core.history.get(s,i)).request.method,h=Sn[c]?Sn[c].res:Sn.unregistered_method.res;await this.core.relayer.publish(s,o,h),await this.core.history.resolve(a)}),ie(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,fe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),ie(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>ui(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),ie(this,"onRelayEventRequest",i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return this.onPairingPingRequest(s,n);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,n);default:return this.onUnknownRpcMethodRequest(s,n)}}),ie(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,a=(await this.core.history.get(s,n.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(a)}}),ie(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(Ri.ping,{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),ie(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{Dr(s)?this.events.emit(ue("pairing_ping",n),{}):er(s)&&this.events.emit(ue("pairing_ping",n),{error:s.error})},500)}),ie(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Ri.delete,{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),ie(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:a}=s;try{if(this.registeredMethods.includes(a))return;const o=fe("WC_METHOD_UNSUPPORTED",a);await this.sendError(n,i,o),this.logger.error(o)}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),ie(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(fe("WC_METHOD_UNSUPPORTED",i))}),ie(this,"isValidPair",(i,s)=>{var n;if(!Ft(i)){const{message:o}=V("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(Wr.malformed_pairing_uri),new Error(o)}if(!Q8(i.uri)){const{message:o}=V("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(Wr.malformed_pairing_uri),new Error(o)}const a=jf(i==null?void 0:i.uri);if(!((n=a==null?void 0:a.relay)!=null&&n.protocol)){const{message:o}=V("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(Wr.malformed_pairing_uri),new Error(o)}if(!(a!=null&&a.symKey)){const{message:o}=V("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(Wr.malformed_pairing_uri),new Error(o)}if(a!=null&&a.expiryTimestamp&&K.toMiliseconds(a==null?void 0:a.expiryTimestamp)<Date.now()){s.setError(Wr.pairing_expired);const{message:o}=V("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(o)}}),ie(this,"isValidPing",async i=>{if(!Ft(i)){const{message:n}=V("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),ie(this,"isValidDisconnect",async i=>{if(!Ft(i)){const{message:n}=V("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),ie(this,"isValidPairingTopic",async i=>{if(!tt(i,!1)){const{message:s}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(ui(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=V("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=Mt(r,this.name),this.pairings=new Gi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Lt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ut.message,async e=>{const{topic:r,message:i,transportType:s}=e;if(!this.pairings.keys.includes(r)||s===Pe.link_mode||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);try{Wh(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Io(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id))}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(Qt.expired,async e=>{const{topic:r}=Jp(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Ri.expire,{topic:r}))})}};var PE=Object.defineProperty,OE=(t,e,r)=>e in t?PE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mt=(t,e,r)=>OE(t,typeof e!="symbol"?e+"":e,r);let ME=class extends z5{constructor(e,r){super(e,r),this.core=e,this.logger=r,mt(this,"records",new Map),mt(this,"events",new ir.EventEmitter),mt(this,"name",d7),mt(this,"version",l7),mt(this,"cached",[]),mt(this,"initialized",!1),mt(this,"storagePrefix",Br),mt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),mt(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const a={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:st(K.THIRTY_DAYS)};this.records.set(a.id,a),this.persist(),this.events.emit(dr.created,a)}),mt(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=er(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(dr.updated,s))}),mt(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),mt(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(dr.deleted,n)}}),this.persist()}),mt(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),mt(this,"on",(i,s)=>{this.events.on(i,s)}),mt(this,"once",(i,s)=>{this.events.once(i,s)}),mt(this,"off",(i,s)=>{this.events.off(i,s)}),mt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Mt(r,this.name)}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:pi(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(dr.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(dr.created,e=>{const r=dr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(dr.updated,e=>{const r=dr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(dr.deleted,e=>{const r=dr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Gs.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{K.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(dr.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}};var CE=Object.defineProperty,TE=(t,e,r)=>e in t?CE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,St=(t,e,r)=>TE(t,typeof e!="symbol"?e+"":e,r);let RE=class extends G5{constructor(e,r){super(e,r),this.core=e,this.logger=r,St(this,"expirations",new Map),St(this,"events",new ir.EventEmitter),St(this,"name",p7),St(this,"version",b7),St(this,"cached",[]),St(this,"initialized",!1),St(this,"storagePrefix",Br),St(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),St(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),St(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),a={target:n,expiry:s};this.expirations.set(n,a),this.checkExpiry(n,a),this.events.emit(Qt.created,{target:n,expiration:a})}),St(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),St(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Qt.deleted,{target:s,expiration:n})}}),St(this,"on",(i,s)=>{this.events.on(i,s)}),St(this,"once",(i,s)=>{this.events.once(i,s)}),St(this,"off",(i,s)=>{this.events.off(i,s)}),St(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Mt(r,this.name)}get context(){return Lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Nw(e);if(typeof e=="number")return Fw(e);const{message:r}=V("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Qt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;K.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Qt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Gs.pulse,()=>this.checkExpirations()),this.events.on(Qt.created,e=>{const r=Qt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Qt.expired,e=>{const r=Qt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Qt.deleted,e=>{const r=Qt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}};var NE=Object.defineProperty,FE=(t,e,r)=>e in t?NE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,it=(t,e,r)=>FE(t,typeof e!="symbol"?e+"":e,r);let BE=class extends J5{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,it(this,"name",g7),it(this,"abortController"),it(this,"isDevEnv"),it(this,"verifyUrlV3",y7),it(this,"storagePrefix",Br),it(this,"version",N0),it(this,"publicKey"),it(this,"fetchPromise"),it(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&K.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),it(this,"register",async s=>{if(!Jn()||this.isDevEnv)return;const n=window.location.origin,{id:a,decryptedId:o}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${a}&decryptedId=${o}`;try{const h=Hn(),f=this.startAbortTimer(K.ONE_SECOND*5),l=await new Promise((v,_)=>{const m=()=>{window.removeEventListener("message",O),h.body.removeChild($),_("attestation aborted")};this.abortController.signal.addEventListener("abort",m);const $=h.createElement("iframe");$.src=c,$.style.display="none",$.addEventListener("error",m,{signal:this.abortController.signal});const O=D=>{if(D.data&&typeof D.data=="string")try{const P=JSON.parse(D.data);if(P.type==="verify_attestation"){if(qc(P.attestation).payload.id!==a)return;clearInterval(f),h.body.removeChild($),this.abortController.signal.removeEventListener("abort",m),window.removeEventListener("message",O),v(P.attestation===null?"":P.attestation)}}catch(P){this.logger.warn(P)}};h.body.appendChild($),window.addEventListener("message",O,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",l),l}catch(h){this.logger.warn(h)}return""}),it(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:a,encryptedId:o}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(qc(n).payload.id!==o)return;const h=await this.isValidJwtAttestation(n);if(h){if(!h.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return h}}if(!a)return;const c=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(a,c)}),it(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const a=this.startAbortTimer(K.ONE_SECOND*5),o=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(a),o.status===200?await o.json():void 0}),it(this,"getVerifyUrl",s=>{let n=s||Rn;return m7.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Rn}`),n=Rn),n}),it(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(K.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),it(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),it(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),it(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(o){this.logger.error(o),this.logger.warn("error validating attestation")}const a=await this.fetchAndPersistPublicKey();try{if(a)return this.validateAttestation(s,a)}catch(o){this.logger.error(o),this.logger.warn("error validating attestation")}}),it(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),it(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const a=await this.fetchPublicKey();a&&(await this.persistPublicKey(a),n(a))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),it(this,"validateAttestation",(s,n)=>{const a=j8(s,n.publicKey),o={hasExpired:K.toMiliseconds(a.exp)<Date.now(),payload:a};if(o.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:o.payload.origin,isScam:o.payload.isScam,isVerified:o.payload.isVerified}}),this.logger=Mt(r,this.name),this.abortController=new AbortController,this.isDevEnv=Fh(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Lt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),K.toMiliseconds(e))}};var qE=Object.defineProperty,LE=(t,e,r)=>e in t?qE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ad=(t,e,r)=>LE(t,typeof e!="symbol"?e+"":e,r);let jE=class extends Y5{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Ad(this,"context",w7),Ad(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:a,enableEncrypted:o=!1}=i,c=`${_7}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:a,token:n,always_raw:o})})}),this.logger=Mt(r,this.context)}};var UE=Object.defineProperty,Dd=Object.getOwnPropertySymbols,zE=Object.prototype.hasOwnProperty,kE=Object.prototype.propertyIsEnumerable,ch=(t,e,r)=>e in t?UE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Dn=(t,e)=>{for(var r in e||(e={}))zE.call(e,r)&&ch(t,r,e[r]);if(Dd)for(var r of Dd(e))kE.call(e,r)&&ch(t,r,e[r]);return t},ot=(t,e,r)=>ch(t,typeof e!="symbol"?e+"":e,r);let HE=class extends X5{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,ot(this,"context",x7),ot(this,"storagePrefix",Br),ot(this,"storageVersion",E7),ot(this,"events",new Map),ot(this,"shouldPersist",!1),ot(this,"init",async()=>{if(!Fh())try{const s={eventId:lf(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Kp(this.core.relayer.protocol,this.core.relayer.version,th)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),ot(this,"createEvent",s=>{const{event:n="ERROR",type:a="",properties:{topic:o,trace:c}}=s,h=lf(),f=this.core.projectId||"",l=Date.now(),v=Dn({eventId:h,timestamp:l,props:{event:n,type:a,properties:{topic:o,trace:c}},bundleId:f,domain:this.getAppDomain()},this.setMethods(h));return this.telemetryEnabled&&(this.events.set(h,v),this.shouldPersist=!0),v}),ot(this,"getEvent",s=>{const{eventId:n,topic:a}=s;if(n)return this.events.get(n);const o=Array.from(this.events.values()).find(c=>c.props.properties.topic===a);if(o)return Dn(Dn({},o),this.setMethods(o.eventId))}),ot(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),ot(this,"setEventListeners",()=>{this.core.heartbeat.on(Gs.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{K.fromMiliseconds(Date.now())-K.fromMiliseconds(s.timestamp)>$7&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),ot(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),ot(this,"addTrace",(s,n)=>{const a=this.events.get(s);a&&(a.props.properties.trace.push(n),this.events.set(s,a),this.shouldPersist=!0)}),ot(this,"setError",(s,n)=>{const a=this.events.get(s);a&&(a.props.type=n,a.timestamp=Date.now(),this.events.set(s,a),this.shouldPersist=!0)}),ot(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ot(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,Dn(Dn({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),ot(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,a]of this.events)a.props.type&&s.push(a);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),ot(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${S7}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${th}${n}`,{method:"POST",body:JSON.stringify(s)})}),ot(this,"getAppDomain",()=>Hp().url),this.logger=Mt(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}};var KE=Object.defineProperty,Pd=Object.getOwnPropertySymbols,VE=Object.prototype.hasOwnProperty,WE=Object.prototype.propertyIsEnumerable,hh=(t,e,r)=>e in t?KE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Od=(t,e)=>{for(var r in e||(e={}))VE.call(e,r)&&hh(t,r,e[r]);if(Pd)for(var r of Pd(e))WE.call(e,r)&&hh(t,r,e[r]);return t},we=(t,e,r)=>hh(t,typeof e!="symbol"?e+"":e,r);let GE=class J0 extends q5{constructor(e){var r;super(e),we(this,"protocol",R0),we(this,"version",N0),we(this,"name",eh),we(this,"relayUrl"),we(this,"projectId"),we(this,"customStoragePrefix"),we(this,"events",new ir.EventEmitter),we(this,"logger"),we(this,"heartbeat"),we(this,"relayer"),we(this,"crypto"),we(this,"storage"),we(this,"history"),we(this,"expirer"),we(this,"pairing"),we(this,"verify"),we(this,"echoClient"),we(this,"linkModeSupportedApps"),we(this,"eventClient"),we(this,"initialized",!1),we(this,"logChunkController"),we(this,"on",(a,o)=>this.events.on(a,o)),we(this,"once",(a,o)=>this.events.once(a,o)),we(this,"off",(a,o)=>this.events.off(a,o)),we(this,"removeListener",(a,o)=>this.events.removeListener(a,o)),we(this,"dispatchEnvelope",({topic:a,message:o,sessionExists:c})=>{if(!a||!o)return;const h={topic:a,message:o,publishedAt:Date.now(),transportType:Pe.link_mode};this.relayer.onLinkMessageEvent(h,{sessionExists:c})}),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||B0,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=xo({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:V9.logger,name:eh}),{logger:s,chunkLoggerController:n}=N5({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=n,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,o;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((o=this.logChunkController)==null||o.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Mt(s,this.name),this.heartbeat=new A4,this.crypto=new eE(this,this.logger,e==null?void 0:e.keychain),this.history=new ME(this,this.logger),this.expirer=new RE(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new o5(Od(Od({},W9),e==null?void 0:e.storageOptions)),this.relayer=new EE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new DE(this,this.logger),this.verify=new BE(this,this.logger,this.storage),this.echoClient=new jE(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new HE(this,this.logger,e==null?void 0:e.telemetryEnabled)}static async init(e){const r=new J0(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(a7,i),r}get context(){return Lt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(pd,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(pd)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const JE=GE,Y0="wc",X0=2,Z0="client",Gh=`${Y0}@${X0}:${Z0}:`,mc={name:Z0,logger:"error"},Md="WALLETCONNECT_DEEPLINK_CHOICE",YE="proposal",Cd="Proposal expired",XE="session",cs=K.SEVEN_DAYS,ZE="engine",ct={wc_sessionPropose:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1104},res:{ttl:K.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1106},res:{ttl:K.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1112},res:{ttl:K.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1114},res:{ttl:K.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:K.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:K.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1119}}},wc={min:K.FIVE_MINUTES,max:K.SEVEN_DAYS},Sr={idle:"IDLE",active:"ACTIVE"},Td={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},QE="request",ex=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],tx="wc",rx="auth",ix="authKeys",sx="pairingTopics",nx="requests",Do=`${tx}@${1.5}:${rx}:`,qa=`${Do}:PUB_KEY`;var ax=Object.defineProperty,ox=Object.defineProperties,cx=Object.getOwnPropertyDescriptors,Rd=Object.getOwnPropertySymbols,hx=Object.prototype.hasOwnProperty,ux=Object.prototype.propertyIsEnumerable,uh=(t,e,r)=>e in t?ax(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ke=(t,e)=>{for(var r in e||(e={}))hx.call(e,r)&&uh(t,r,e[r]);if(Rd)for(var r of Rd(e))ux.call(e,r)&&uh(t,r,e[r]);return t},Rt=(t,e)=>ox(t,cx(e)),k=(t,e,r)=>uh(t,typeof e!="symbol"?e+"":e,r);let fx=class extends t9{constructor(e){super(e),k(this,"name",ZE),k(this,"events",new yh),k(this,"initialized",!1),k(this,"requestQueue",{state:Sr.idle,queue:[]}),k(this,"sessionRequestQueue",{state:Sr.idle,queue:[]}),k(this,"requestQueueDelay",K.ONE_SECOND),k(this,"expectedPairingMethodMap",new Map),k(this,"recentlyDeletedMap",new Map),k(this,"recentlyDeletedLimit",200),k(this,"relayMessageCache",[]),k(this,"pendingSessions",new Map),k(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(ct)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},K.toMiliseconds(this.requestQueueDelay)))}),k(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Rt(ke({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:a,sessionProperties:o,relays:c}=i;let h=s,f,l=!1;try{if(h){const N=this.client.core.pairing.pairings.get(h);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),l=N.active}}catch(N){throw this.client.logger.error(`connect() -> pairing.get(${h}) failed`),N}if(!h||!l){const{topic:N,uri:z}=await this.client.core.pairing.create();h=N,f=z}if(!h){const{message:N}=V("NO_MATCHING_KEY",`connect() pairing topic: ${h}`);throw new Error(N)}const v=await this.client.core.crypto.generateKeyPair(),_=ct.wc_sessionPropose.req.ttl||K.FIVE_MINUTES,m=st(_),$=Rt(ke({requiredNamespaces:n,optionalNamespaces:a,relays:c??[{protocol:F0}],proposer:{publicKey:v,metadata:this.client.metadata},expiryTimestamp:m,pairingTopic:h},o&&{sessionProperties:o}),{id:Ar()}),O=ue("session_connect",$.id),{reject:D,resolve:P,done:C}=Mi(_,Cd),T=({id:N})=>{N===$.id&&(this.client.events.off("proposal_expire",T),this.pendingSessions.delete($.id),this.events.emit(O,{error:{message:Cd,code:0}}))};return this.client.events.on("proposal_expire",T),this.events.once(O,({error:N,session:z})=>{this.client.events.off("proposal_expire",T),N?D(N):z&&P(z)}),await this.sendRequest({topic:h,method:"wc_sessionPropose",params:$,throwOnFailedPublish:!0,clientRpcId:$.id}),await this.setProposal($.id,$),{uri:f,approval:C}}),k(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),k(this,"approve",async r=>{var i,s,n;const a=this.client.core.eventClient.createEvent({properties:{topic:(i=r==null?void 0:r.id)==null?void 0:i.toString(),trace:[lr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(U){throw a.setError(Pi.no_internet_connection),U}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(U){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),a.setError(Pi.proposal_not_found),U}try{await this.isValidApprove(r)}catch(U){throw this.client.logger.error("approve() -> isValidApprove() failed"),a.setError(Pi.session_approve_namespace_validation_failure),U}const{id:o,relayProtocol:c,namespaces:h,sessionProperties:f,sessionConfig:l}=r,v=this.client.proposal.get(o);this.client.core.eventClient.deleteEvent({eventId:a.eventId});const{pairingTopic:_,proposer:m,requiredNamespaces:$,optionalNamespaces:O}=v;let D=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:_});D||(D=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:lr.session_approve_started,properties:{topic:_,trace:[lr.session_approve_started,lr.session_namespaces_validation_success]}}));const P=await this.client.core.crypto.generateKeyPair(),C=m.publicKey,T=await this.client.core.crypto.generateSharedKey(P,C),N=ke(ke({relay:{protocol:c??"irn"},namespaces:h,controller:{publicKey:P,metadata:this.client.metadata},expiry:st(cs)},f&&{sessionProperties:f}),l&&{sessionConfig:l}),z=Pe.relay;D.addTrace(lr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(T,{transportType:z})}catch(U){throw D.setError(Pi.subscribe_session_topic_failure),U}D.addTrace(lr.subscribe_session_topic_success);const H=Rt(ke({},N),{topic:T,requiredNamespaces:$,optionalNamespaces:O,pairingTopic:_,acknowledged:!1,self:N.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:P,transportType:Pe.relay});await this.client.session.set(T,H),D.addTrace(lr.store_session);try{D.addTrace(lr.publishing_session_settle),await this.sendRequest({topic:T,method:"wc_sessionSettle",params:N,throwOnFailedPublish:!0}).catch(U=>{throw D==null||D.setError(Pi.session_settle_publish_failure),U}),D.addTrace(lr.session_settle_publish_success),D.addTrace(lr.publishing_session_approve),await this.sendResult({id:o,topic:_,result:{relay:{protocol:c??"irn"},responderPublicKey:P},throwOnFailedPublish:!0}).catch(U=>{throw D==null||D.setError(Pi.session_approve_publish_failure),U}),D.addTrace(lr.session_approve_publish_success)}catch(U){throw this.client.logger.error(U),this.client.session.delete(T,fe("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(T),U}return this.client.core.eventClient.deleteEvent({eventId:D.eventId}),await this.client.core.pairing.updateMetadata({topic:_,metadata:m.metadata}),await this.client.proposal.delete(o,fe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:_}),await this.setExpiry(T,st(cs)),{topic:T,acknowledged:()=>Promise.resolve(this.client.session.get(T))}}),k(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}const{id:i,reason:s}=r;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),a}n&&(await this.sendError({id:i,topic:n,error:s,rpcOpts:ct.wc_sessionPropose.reject}),await this.client.proposal.delete(i,fe("USER_DISCONNECTED")))}),k(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}const{topic:i,namespaces:s}=r,{done:n,resolve:a,reject:o}=Mi(),c=Ar(),h=Fi().toString(),f=this.client.session.get(i).namespaces;return this.events.once(ue("session_update",c),({error:l})=>{l?o(l):a()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:h}).catch(l=>{this.client.logger.error(l),this.client.session.update(i,{namespaces:f}),o(l)}),{acknowledged:n}}),k(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,s=Ar(),{done:n,resolve:a,reject:o}=Mi();return this.events.once(ue("session_extend",s),({error:c})=>{c?o(c):a()}),await this.setExpiry(i,st(cs)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{o(c)}),{acknowledged:n}}),k(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(D){throw this.client.logger.error("request() -> isValidRequest() failed"),D}const{chainId:i,request:s,topic:n,expiry:a=ct.wc_sessionRequest.req.ttl}=r,o=this.client.session.get(n);(o==null?void 0:o.transportType)===Pe.relay&&await this.confirmOnlineStateOrThrow();const c=Ar(),h=Fi().toString(),{done:f,resolve:l,reject:v}=Mi(a,"Request expired. Please try again.");this.events.once(ue("session_request",c),({error:D,result:P})=>{D?v(D):l(P)});const _="wc_sessionRequest",m=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);if(m)return await this.sendRequest({clientRpcId:c,relayRpcId:h,topic:n,method:_,params:{request:Rt(ke({},s),{expiryTimestamp:st(a)}),chainId:i},expiry:a,throwOnFailedPublish:!0,appLink:m}).catch(D=>v(D)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),await f();const $={request:Rt(ke({},s),{expiryTimestamp:st(a)}),chainId:i},O=this.shouldSetTVF(_,$);return await Promise.all([new Promise(async D=>{await this.sendRequest(ke({clientRpcId:c,relayRpcId:h,topic:n,method:_,params:$,expiry:a,throwOnFailedPublish:!0},O&&{tvf:this.getTVFParams(c,$)})).catch(P=>v(P)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),D()}),new Promise(async D=>{var P;if(!((P=o.sessionConfig)!=null&&P.disableDeepLink)){const C=await jw(this.client.core.storage,Md);await Bw({id:c,topic:n,wcDeepLink:C})}D()}),f()]).then(D=>D[2])}),k(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:n}=s,a=this.client.session.get(i);a.transportType===Pe.relay&&await this.confirmOnlineStateOrThrow();const o=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);Dr(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:o}):er(s)&&await this.sendError({id:n,topic:i,error:s.error,appLink:o}),this.cleanupAfterResponse(r)}),k(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=Ar(),n=Fi().toString(),{done:a,resolve:o,reject:c}=Mi();this.events.once(ue("session_ping",s),({error:h})=>{h?c(h):o()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),a()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),k(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:s,chainId:n}=r,a=Fi().toString(),o=Ar();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:a,clientRpcId:o})}),k(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:fe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=V("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),k(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>X8(i,r)))),k(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),k(this,"authenticate",async(r,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),a=n?Pe.link_mode:Pe.relay;a===Pe.relay&&await this.confirmOnlineStateOrThrow();const{chains:o,statement:c="",uri:h,domain:f,nonce:l,type:v,exp:_,nbf:m,methods:$=[],expiry:O}=r,D=[...r.resources||[]],{topic:P,uri:C}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:a});this.client.logger.info({message:"Generated new pairing",pairing:{topic:P,uri:C}});const T=await this.client.core.crypto.generateKeyPair(),N=Na(T);if(await Promise.all([this.client.auth.authKeys.set(qa,{responseTopic:N,publicKey:T}),this.client.auth.pairingTopics.set(N,{topic:N,pairingTopic:P})]),await this.client.core.relayer.subscribe(N,{transportType:a}),this.client.logger.info(`sending request to new pairing topic: ${P}`),$.length>0){const{namespace:y}=Ps(o[0]);let d=O6(y,"request",$);Ra(D)&&(d=C6(d,D.pop())),D.push(d)}const z=O&&O>ct.wc_sessionAuthenticate.req.ttl?O:ct.wc_sessionAuthenticate.req.ttl,H={authPayload:{type:v??"caip122",chains:o,statement:c,aud:h,domain:f,version:"1",nonce:l,iat:new Date().toISOString(),exp:_,nbf:m,resources:D},requester:{publicKey:T,metadata:this.client.metadata},expiryTimestamp:st(z)},U={eip155:{chains:o,methods:[...new Set(["personal_sign",...$])],events:["chainChanged","accountsChanged"]}},B={requiredNamespaces:{},optionalNamespaces:U,relays:[{protocol:"irn"}],pairingTopic:P,proposer:{publicKey:T,metadata:this.client.metadata},expiryTimestamp:st(ct.wc_sessionPropose.req.ttl),id:Ar()},{done:J,resolve:S,reject:u}=Mi(z,"Request expired"),b=Ar(),w=ue("session_connect",B.id),p=ue("session_request",b),g=async({error:y,session:d})=>{this.events.off(p,E),y?u(y):d&&S({session:d})},E=async y=>{var d,x,R;if(await this.deletePendingAuthRequest(b,{message:"fulfilled",code:0}),y.error){const Y=fe("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return y.error.code===Y.code?void 0:(this.events.off(w,g),u(y.error.message))}await this.deleteProposal(B.id),this.events.off(w,g);const{cacaos:j,responder:F}=y.result,q=[],G=[];for(const Y of j){await _f({cacao:Y,projectId:this.client.core.projectId})||(this.client.logger.error(Y,"Signature verification failed"),u(fe("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:ee}=Y,bt=Ra(ee.resources),ae=[zc(ee.iss)],de=Va(ee.iss);if(bt){const Gt=Ef(bt),ge=xf(bt);q.push(...Gt),ae.push(...ge)}for(const Gt of ae)G.push(`${Gt}:${de}`)}const X=await this.client.core.crypto.generateSharedKey(T,F.publicKey);let Q;q.length>0&&(Q={topic:X,acknowledged:!0,self:{publicKey:T,metadata:this.client.metadata},peer:F,controller:F.publicKey,expiry:st(cs),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:P,namespaces:zf([...new Set(q)],[...new Set(G)]),transportType:a},await this.client.core.relayer.subscribe(X,{transportType:a}),await this.client.session.set(X,Q),P&&await this.client.core.pairing.updateMetadata({topic:P,metadata:F.metadata}),Q=this.client.session.get(X)),(d=this.client.metadata.redirect)!=null&&d.linkMode&&(x=F.metadata.redirect)!=null&&x.linkMode&&(R=F.metadata.redirect)!=null&&R.universal&&i&&(this.client.core.addLinkModeSupportedApp(F.metadata.redirect.universal),this.client.session.update(X,{transportType:Pe.link_mode})),S({auths:j,session:Q})};this.events.once(w,g),this.events.once(p,E);let I;try{if(n){const y=pi("wc_sessionAuthenticate",H,b);this.client.core.history.set(P,y);const d=await this.client.core.crypto.encode("",y,{type:Qn,encoding:xn});I=xa(i,P,d)}else await Promise.all([this.sendRequest({topic:P,method:"wc_sessionAuthenticate",params:H,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:b}),this.sendRequest({topic:P,method:"wc_sessionPropose",params:B,expiry:ct.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:B.id})])}catch(y){throw this.events.off(w,g),this.events.off(p,E),y}return await this.setProposal(B.id,B),await this.setAuthRequest(b,{request:Rt(ke({},H),{verifyContext:{}}),pairingTopic:P,transportType:a}),{uri:I??C,response:J}}),k(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:s}=r,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Oi.authenticated_session_approve_started]}});try{this.isInitialized()}catch(O){throw n.setError(In.no_internet_connection),O}const a=this.getPendingAuthRequest(i);if(!a)throw n.setError(In.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const o=a.transportType||Pe.relay;o===Pe.relay&&await this.confirmOnlineStateOrThrow();const c=a.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=Na(c),l={type:Yr,receiverPublicKey:c,senderPublicKey:h},v=[],_=[];for(const O of s){if(!await _f({cacao:O,projectId:this.client.core.projectId})){n.setError(In.invalid_cacao);const N=fe("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:f,error:N,encodeOpts:l}),new Error(N.message)}n.addTrace(Oi.cacaos_verified);const{p:D}=O,P=Ra(D.resources),C=[zc(D.iss)],T=Va(D.iss);if(P){const N=Ef(P),z=xf(P);v.push(...N),C.push(...z)}for(const N of C)_.push(`${N}:${T}`)}const m=await this.client.core.crypto.generateSharedKey(h,c);n.addTrace(Oi.create_authenticated_session_topic);let $;if((v==null?void 0:v.length)>0){$={topic:m,acknowledged:!0,self:{publicKey:h,metadata:this.client.metadata},peer:{publicKey:c,metadata:a.requester.metadata},controller:c,expiry:st(cs),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:a.pairingTopic,namespaces:zf([...new Set(v)],[...new Set(_)]),transportType:o},n.addTrace(Oi.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(m,{transportType:o})}catch(O){throw n.setError(In.subscribe_authenticated_session_topic_failure),O}n.addTrace(Oi.subscribe_authenticated_session_topic_success),await this.client.session.set(m,$),n.addTrace(Oi.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:a.pairingTopic,metadata:a.requester.metadata})}n.addTrace(Oi.publishing_authenticated_session_approve);try{await this.sendResult({topic:f,id:i,result:{cacaos:s,responder:{publicKey:h,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(a.requester.metadata,o)})}catch(O){throw n.setError(In.authenticated_session_approve_publish_failure),O}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:a.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:$}}),k(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:s}=r,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===Pe.relay&&await this.confirmOnlineStateOrThrow();const a=n.requester.publicKey,o=await this.client.core.crypto.generateKeyPair(),c=Na(a),h={type:Yr,receiverPublicKey:a,senderPublicKey:o};await this.sendError({id:i,topic:c,error:s,encodeOpts:h,rpcOpts:ct.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.client.proposal.delete(i,fe("USER_DISCONNECTED"))}),k(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:s}=r;return s0(i,s)}),k(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),k(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var a,o;return((a=n.peerMetadata)==null?void 0:a.url)&&((o=n.peerMetadata)==null?void 0:o.url)===r.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),k(this,"deleteSession",async r=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:a=!0,id:o=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,fe("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Md).catch(h=>this.client.logger.warn(h)),this.getPendingSessionRequests().forEach(h=>{h.topic===s&&this.deletePendingSessionRequest(h.id,fe("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=Sr.idle),a&&this.client.events.emit("session_delete",{id:o,topic:s})}),k(this,"deleteProposal",async(r,i)=>{if(i)try{const s=this.client.proposal.get(r),n=this.client.core.eventClient.getEvent({topic:s.pairingTopic});n==null||n.setError(Pi.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,fe("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),k(this,"deletePendingSessionRequest",async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==r),s&&(this.sessionRequestQueue.state=Sr.idle,this.client.events.emit("session_request_expire",{id:r}))}),k(this,"deletePendingAuthRequest",async(r,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])}),k(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),k(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,st(ct.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),k(this,"setAuthRequest",async(r,i)=>{const{request:s,pairingTopic:n,transportType:a=Pe.relay}=i;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:n,verifyContext:s.verifyContext,transportType:a})}),k(this,"setPendingSessionRequest",async r=>{const{id:i,topic:s,params:n,verifyContext:a}=r,o=n.request.expiryTimestamp||st(ct.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,o),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:a})}),k(this,"sendRequest",async r=>{const{topic:i,method:s,params:n,expiry:a,relayRpcId:o,clientRpcId:c,throwOnFailedPublish:h,appLink:f,tvf:l}=r,v=pi(s,n,c);let _;const m=!!f;try{const D=m?xn:li;_=await this.client.core.crypto.encode(i,v,{encoding:D})}catch(D){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),D}let $;if(ex.includes(s)){const D=Gr(JSON.stringify(v)),P=Gr(_);$=await this.client.core.verify.register({id:P,decryptedId:D})}const O=ct[s].req;if(O.attestation=$,a&&(O.ttl=a),o&&(O.id=o),this.client.core.history.set(i,v),m){const D=xa(f,i,_);await global.Linking.openURL(D,this.client.name)}else{const D=ct[s].req;a&&(D.ttl=a),o&&(D.id=o),D.tvf=Rt(ke({},l),{correlationId:v.id}),h?(D.internal=Rt(ke({},D.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,_,D)):this.client.core.relayer.publish(i,_,D).catch(P=>this.client.logger.error(P))}return v.id}),k(this,"sendResult",async r=>{const{id:i,topic:s,result:n,throwOnFailedPublish:a,encodeOpts:o,appLink:c}=r,h=$o(i,n);let f;const l=c&&typeof(global==null?void 0:global.Linking)<"u";try{const m=l?xn:li;f=await this.client.core.crypto.encode(s,h,Rt(ke({},o||{}),{encoding:m}))}catch(m){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),m}let v,_;try{v=await this.client.core.history.get(s,i);const m=v.request;try{this.shouldSetTVF(m.method,m.params)&&(_=this.getTVFParams(i,m.params,n))}catch($){this.client.logger.warn("sendResult() -> getTVFParams() failed",$)}}catch(m){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),m}if(l){const m=xa(c,s,f);await global.Linking.openURL(m,this.client.name)}else{const m=v.request.method,$=ct[m].res;$.tvf=Rt(ke({},_),{correlationId:i}),a?($.internal=Rt(ke({},$.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,f,$)):this.client.core.relayer.publish(s,f,$).catch(O=>this.client.logger.error(O))}await this.client.core.history.resolve(h)}),k(this,"sendError",async r=>{const{id:i,topic:s,error:n,encodeOpts:a,rpcOpts:o,appLink:c}=r,h=So(i,n);let f;const l=c&&typeof(global==null?void 0:global.Linking)<"u";try{const _=l?xn:li;f=await this.client.core.crypto.encode(s,h,Rt(ke({},a||{}),{encoding:_}))}catch(_){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),_}let v;try{v=await this.client.core.history.get(s,i)}catch(_){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),_}if(l){const _=xa(c,s,f);await global.Linking.openURL(_,this.client.name)}else{const _=v.request.method,m=o||ct[_].res;this.client.core.relayer.publish(s,f,m)}await this.client.core.history.resolve(h)}),k(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;ui(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{ui(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),k(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),k(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Sr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Sr.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Sr.idle}),k(this,"processRequest",async r=>{const{topic:i,payload:s,attestation:n,transportType:a,encryptedId:o}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:o});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:o,transportType:a});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:o,transportType:a});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),k(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s,transportType:n}=r,a=(await this.client.core.history.get(i,s.id)).request.method;switch(a){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${a}`)}}),k(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:s}=V("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),k(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:s}=r,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),k(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:s,attestation:n,encryptedId:a}=r,{params:o,id:c}=s;try{const h=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),h==null||h.setError(Wr.proposal_listener_not_found)),this.isValidConnect(ke({},s.params));const f=o.expiryTimestamp||st(ct.wc_sessionPropose.req.ttl),l=ke({id:c,pairingTopic:i,expiryTimestamp:f},o);await this.setProposal(c,l);const v=await this.getVerifyContext({attestationId:n,hash:Gr(JSON.stringify(s)),encryptedId:a,metadata:l.proposer.metadata});h==null||h.addTrace(Ir.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:l,verifyContext:v})}catch(h){await this.sendError({id:c,topic:i,error:h,rpcOpts:ct.wc_sessionPropose.autoReject}),this.client.logger.error(h)}}),k(this,"onSessionProposeResponse",async(r,i,s)=>{const{id:n}=i;if(Dr(i)){const{result:a}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:a});const o=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:o});const c=o.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=a.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const f=await this.client.core.crypto.generateSharedKey(c,h);this.pendingSessions.set(n,{sessionTopic:f,pairingTopic:r,proposalId:n,publicKey:c});const l=await this.client.core.relayer.subscribe(f,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:r})}else if(er(i)){await this.client.proposal.delete(n,fe("USER_DISCONNECTED"));const a=ue("session_connect",n);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:i.error})}}),k(this,"onSessionSettleRequest",async(r,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:a,controller:o,expiry:c,namespaces:h,sessionProperties:f,sessionConfig:l}=i.params,v=[...this.pendingSessions.values()].find($=>$.sessionTopic===r);if(!v)return this.client.logger.error(`Pending session not found for topic ${r}`);const _=this.client.proposal.get(v.proposalId),m=Rt(ke(ke({topic:r,relay:a,expiry:c,namespaces:h,acknowledged:!0,pairingTopic:v.pairingTopic,requiredNamespaces:_.requiredNamespaces,optionalNamespaces:_.optionalNamespaces,controller:o.publicKey,self:{publicKey:v.publicKey,metadata:this.client.metadata},peer:{publicKey:o.publicKey,metadata:o.metadata}},f&&{sessionProperties:f}),l&&{sessionConfig:l}),{transportType:Pe.relay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:v.pairingTopic,metadata:m.peer.metadata}),this.client.events.emit("session_connect",{session:m}),this.events.emit(ue("session_connect",v.proposalId),{session:m}),this.pendingSessions.delete(v.proposalId),this.deleteProposal(v.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:i.id,topic:r,result:!0,throwOnFailedPublish:!0})}catch(a){await this.sendError({id:s,topic:r,error:a}),this.client.logger.error(a)}}),k(this,"onSessionSettleResponse",async(r,i)=>{const{id:s}=i;Dr(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ue("session_approve",s),{})):er(i)&&(await this.client.session.delete(r,fe("USER_DISCONNECTED")),this.events.emit(ue("session_approve",s),{error:i.error}))}),k(this,"onSessionUpdateRequest",async(r,i)=>{const{params:s,id:n}=i;try{const a=`${r}_session_update`,o=$n.get(a);if(o&&this.isRequestOutOfSync(o,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:r,error:fe("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ke({topic:r},s));try{$n.set(a,n),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0})}catch(c){throw $n.delete(a),c}this.client.events.emit("session_update",{id:n,topic:r,params:s})}catch(a){await this.sendError({id:n,topic:r,error:a}),this.client.logger.error(a)}}),k(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),k(this,"onSessionUpdateResponse",(r,i)=>{const{id:s}=i,n=ue("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Dr(i)?this.events.emit(ue("session_update",s),{}):er(i)&&this.events.emit(ue("session_update",s),{error:i.error})}),k(this,"onSessionExtendRequest",async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,st(cs)),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),k(this,"onSessionExtendResponse",(r,i)=>{const{id:s}=i,n=ue("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Dr(i)?this.events.emit(ue("session_extend",s),{}):er(i)&&this.events.emit(ue("session_extend",s),{error:i.error})}),k(this,"onSessionPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),k(this,"onSessionPingResponse",(r,i)=>{const{id:s}=i,n=ue("session_ping",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);setTimeout(()=>{Dr(i)?this.events.emit(ue("session_ping",s),{}):er(i)&&this.events.emit(ue("session_ping",s),{error:i.error})},500)}),k(this,"onSessionDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(ut.publish,async()=>{n(await this.deleteSession({topic:r,id:s}))})}),this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:fe("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),k(this,"onSessionRequest",async r=>{var i,s,n;const{topic:a,payload:o,attestation:c,encryptedId:h,transportType:f}=r,{id:l,params:v}=o;try{await this.isValidRequest(ke({topic:a},v));const _=this.client.session.get(a),m=await this.getVerifyContext({attestationId:c,hash:Gr(JSON.stringify(pi("wc_sessionRequest",v,l))),encryptedId:h,metadata:_.peer.metadata,transportType:f}),$={id:l,topic:a,params:v,verifyContext:m};await this.setPendingSessionRequest($),f===Pe.link_mode&&(i=_.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=_.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest($):(this.addSessionRequestToSessionRequestQueue($),this.processSessionRequestQueue())}catch(_){await this.sendError({id:l,topic:a,error:_}),this.client.logger.error(_)}}),k(this,"onSessionRequestResponse",(r,i)=>{const{id:s}=i,n=ue("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Dr(i)?this.events.emit(ue("session_request",s),{result:i.result}):er(i)&&this.events.emit(ue("session_request",s),{error:i.error})}),k(this,"onSessionEventRequest",async(r,i)=>{const{id:s,params:n}=i;try{const a=`${r}_session_event_${n.event.name}`,o=$n.get(a);if(o&&this.isRequestOutOfSync(o,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ke({topic:r},n)),this.client.events.emit("session_event",{id:s,topic:r,params:n}),$n.set(a,s)}catch(a){await this.sendError({id:s,topic:r,error:a}),this.client.logger.error(a)}}),k(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),Dr(i)?this.events.emit(ue("session_request",s),{result:i.result}):er(i)&&this.events.emit(ue("session_request",s),{error:i.error})}),k(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:s,payload:n,attestation:a,encryptedId:o,transportType:c}=r;try{const{requester:h,authPayload:f,expiryTimestamp:l}=n.params,v=await this.getVerifyContext({attestationId:a,hash:Gr(JSON.stringify(n)),encryptedId:o,metadata:h.metadata,transportType:c}),_={requester:h,pairingTopic:s,id:n.id,authPayload:f,verifyContext:v,expiryTimestamp:l};await this.setAuthRequest(n.id,{request:_,pairingTopic:s,transportType:c}),c===Pe.link_mode&&(i=h.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:v})}catch(h){this.client.logger.error(h);const f=n.params.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),v=this.getAppLinkIfEnabled(n.params.requester.metadata,c),_={type:Yr,receiverPublicKey:f,senderPublicKey:l};await this.sendError({id:n.id,topic:s,error:h,encodeOpts:_,rpcOpts:ct.wc_sessionAuthenticate.autoReject,appLink:v})}}),k(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),k(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Sr.idle,this.processSessionRequestQueue()},K.toMiliseconds(this.requestQueueDelay))}),k(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===r&&n.request.method==="wc_sessionRequest").forEach(n=>{const a=n.request.id,o=ue("session_request",a);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners`);this.events.emit(ue("session_request",n.request.id),{error:i})})}),k(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Sr.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Sr.active,this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),k(this,"emitSessionRequest",r=>{this.client.events.emit("session_request",r)}),k(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:pi("wc_sessionPropose",{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties},i.id)})}),k(this,"isValidConnect",async r=>{if(!Ft(r)){const{message:c}=V("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(c)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:a,relays:o}=r;if(Pt(i)||await this.isValidPairingTopic(i),!h4(o)){const{message:c}=V("MISSING_OR_INVALID",`connect() relays: ${o}`);throw new Error(c)}!Pt(s)&&jn(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!Pt(n)&&jn(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),Pt(a)||this.validateSessionProps(a,"sessionProperties")}),k(this,"validateNamespaces",(r,i)=>{const s=c4(r,"connect()",i);if(s)throw new Error(s.message)}),k(this,"isValidApprove",async r=>{if(!Ft(r))throw new Error(V("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const o=this.client.proposal.get(i),c=fc(s,"approve()");if(c)throw new Error(c.message);const h=Kf(o.requiredNamespaces,s,"approve()");if(h)throw new Error(h.message);if(!tt(n,!0)){const{message:f}=V("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(f)}Pt(a)||this.validateSessionProps(a,"sessionProperties")}),k(this,"isValidReject",async r=>{if(!Ft(r)){const{message:n}=V("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(n)}const{id:i,reason:s}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!f4(s)){const{message:n}=V("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),k(this,"isValidSessionSettleRequest",r=>{if(!Ft(r)){const{message:h}=V("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(h)}const{relay:i,controller:s,namespaces:n,expiry:a}=r;if(!_0(i)){const{message:h}=V("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(h)}const o=r4(s,"onSessionSettleRequest()");if(o)throw new Error(o.message);const c=fc(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(ui(a)){const{message:h}=V("EXPIRED","onSessionSettleRequest()");throw new Error(h)}}),k(this,"isValidUpdate",async r=>{if(!Ft(r)){const{message:c}=V("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:s}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),a=fc(s,"update()");if(a)throw new Error(a.message);const o=Kf(n.requiredNamespaces,s,"update()");if(o)throw new Error(o.message)}),k(this,"isValidExtend",async r=>{if(!Ft(r)){const{message:s}=V("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),k(this,"isValidRequest",async r=>{if(!Ft(r)){const{message:c}=V("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:s,chainId:n,expiry:a}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!Hf(o,n)){const{message:c}=V("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!d4(s)){const{message:c}=V("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!b4(o,n,s.method)){const{message:c}=V("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(a&&!m4(a,wc)){const{message:c}=V("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${wc.min} and ${wc.max}`);throw new Error(c)}}),k(this,"isValidRespond",async r=>{var i;if(!Ft(r)){const{message:a}=V("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:s,response:n}=r;try{await this.isValidSessionTopic(s)}catch(a){throw(i=r==null?void 0:r.response)!=null&&i.id&&this.cleanupAfterResponse(r),a}if(!l4(n)){const{message:a}=V("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(a)}}),k(this,"isValidPing",async r=>{if(!Ft(r)){const{message:s}=V("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),k(this,"isValidEmit",async r=>{if(!Ft(r)){const{message:o}=V("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(o)}const{topic:i,event:s,chainId:n}=r;await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Hf(a,n)){const{message:o}=V("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(o)}if(!p4(s)){const{message:o}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}if(!g4(a,n,s.name)){const{message:o}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}}),k(this,"isValidDisconnect",async r=>{if(!Ft(r)){const{message:s}=V("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),k(this,"isValidAuthenticate",r=>{const{chains:i,uri:s,domain:n,nonce:a}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!tt(s,!1))throw new Error("uri is required parameter");if(!tt(n,!1))throw new Error("domain is required parameter");if(!tt(a,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>Ps(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:o}=Ps(i[0]);if(o!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),k(this,"getVerifyContext",async r=>{const{attestationId:i,hash:s,encryptedId:n,metadata:a,transportType:o}=r,c={verified:{verifyUrl:a.verifyUrl||Rn,validation:"UNKNOWN",origin:a.url||""}};try{if(o===Pe.link_mode){const f=this.getAppLinkIfEnabled(a,o);return c.verified.validation=f&&new URL(f).origin===new URL(a.url).origin?"VALID":"INVALID",c}const h=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:a.verifyUrl});h&&(c.verified.origin=h.origin,c.verified.isScam=h.isScam,c.verified.validation=h.origin===new URL(a.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.warn(h)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),k(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach(s=>{if(!tt(s,!1)){const{message:n}=V("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(n)}})}),k(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),k(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const a of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(a)}}}),k(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:s}=V("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(s)}}),k(this,"isLinkModeEnabled",(r,i)=>{var s,n,a,o,c,h,f,l,v;return!r||i!==Pe.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((o=(a=this.client.metadata)==null?void 0:a.redirect)==null?void 0:o.universal)!==void 0&&((h=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:h.universal)!==""&&((f=r==null?void 0:r.redirect)==null?void 0:f.universal)!==void 0&&((l=r==null?void 0:r.redirect)==null?void 0:l.universal)!==""&&((v=r==null?void 0:r.redirect)==null?void 0:v.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),k(this,"getAppLinkIfEnabled",(r,i)=>{var s;return this.isLinkModeEnabled(r,i)?(s=r==null?void 0:r.redirect)==null?void 0:s.universal:void 0}),k(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=df(r,"topic")||"",s=decodeURIComponent(df(r,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:Pe.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),k(this,"registerLinkModeListeners",async()=>{var r;if(Fh()||yi()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),k(this,"shouldSetTVF",(r,i)=>{if(!i||r!=="wc_sessionRequest")return!1;const{request:s}=i;return Object.keys(Td).includes(s.method)}),k(this,"getTVFParams",(r,i,s)=>{var n,a;try{const o=i.request.method,c=this.extractTxHashesFromResult(o,s);return Rt(ke({correlationId:r,rpcMethods:[o],chainId:i.chainId},this.isValidContractData(i.request.params)&&{contractAddresses:[(a=(n=i.request.params)==null?void 0:n[0])==null?void 0:a.to]}),{txHashes:c})}catch(o){this.client.logger.warn("Error getting TVF params",o)}return{}}),k(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const s=(r==null?void 0:r.data)||((i=r==null?void 0:r[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),k(this,"extractTxHashesFromResult",(r,i)=>{try{const s=Td[r];if(typeof i=="string")return[i];const n=i[s.key];if(Fr(n))return n;if(typeof n=="string")return[n]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ut.message,e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):this.onRelayMessage(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:s,transportType:n}=e,{publicKey:a}=this.client.auth.authKeys.keys.includes(qa)?this.client.auth.authKeys.get(qa):{publicKey:void 0},o=await this.client.core.crypto.decode(r,i,{receiverPublicKey:a,encoding:n===Pe.link_mode?xn:li});try{Wh(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o,attestation:s,transportType:n,encryptedId:Gr(i)})):Io(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o,transportType:n}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o,transportType:n})}catch(c){this.client.logger.error(c)}}registerExpirerEvents(){this.client.core.expirer.on(Qt.expired,async e=>{const{topic:r,id:i}=Jp(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,V("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,V("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ri.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Ri.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!tt(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(ui(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=V("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!tt(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(ui(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=V("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=V("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(tt(e,!1)){const{message:r}=V("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=V("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!u4(e)){const{message:r}=V("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(ui(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=V("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}},dx=class extends Gi{constructor(e,r){super(e,r,YE,Gh),this.core=e,this.logger=r}},lx=class extends Gi{constructor(e,r){super(e,r,XE,Gh),this.core=e,this.logger=r}},px=class extends Gi{constructor(e,r){super(e,r,QE,Gh,i=>i.id),this.core=e,this.logger=r}},bx=class extends Gi{constructor(e,r){super(e,r,ix,Do,()=>qa),this.core=e,this.logger=r}},gx=class extends Gi{constructor(e,r){super(e,r,sx,Do),this.core=e,this.logger=r}},vx=class extends Gi{constructor(e,r){super(e,r,nx,Do,i=>i.id),this.core=e,this.logger=r}};var yx=Object.defineProperty,mx=(t,e,r)=>e in t?yx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_c=(t,e,r)=>mx(t,typeof e!="symbol"?e+"":e,r);let wx=class{constructor(e,r){this.core=e,this.logger=r,_c(this,"authKeys"),_c(this,"pairingTopics"),_c(this,"requests"),this.authKeys=new bx(this.core,this.logger),this.pairingTopics=new gx(this.core,this.logger),this.requests=new vx(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}};var _x=Object.defineProperty,Ex=(t,e,r)=>e in t?_x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,se=(t,e,r)=>Ex(t,typeof e!="symbol"?e+"":e,r);let xx=class Q0 extends e9{constructor(e){super(e),se(this,"protocol",Y0),se(this,"version",X0),se(this,"name",mc.name),se(this,"metadata"),se(this,"core"),se(this,"logger"),se(this,"events",new ir.EventEmitter),se(this,"engine"),se(this,"session"),se(this,"proposal"),se(this,"pendingRequest"),se(this,"auth"),se(this,"signConfig"),se(this,"on",(i,s)=>this.events.on(i,s)),se(this,"once",(i,s)=>this.events.once(i,s)),se(this,"off",(i,s)=>this.events.off(i,s)),se(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),se(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),se(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),se(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),se(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),se(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||mc.name,this.metadata=(e==null?void 0:e.metadata)||Hp(),this.signConfig=e==null?void 0:e.signConfig;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:ta(xo({level:(e==null?void 0:e.logger)||mc.logger}));this.core=(e==null?void 0:e.core)||new JE(e),this.logger=Mt(r,this.name),this.session=new lx(this.core,this.logger),this.proposal=new dx(this.core,this.logger),this.pendingRequest=new px(this.core,this.logger),this.engine=new fx(this),this.auth=new wx(this.core,this.logger)}static async init(e){const r=new Q0(e);return await r.initialize(),r}get context(){return Lt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},K.toMiliseconds(K.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var fh={exports:{}};(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Dt<"u"&&Dt,i=function(){function n(){this.fetch=!1,this.DOMException=r.DOMException}return n.prototype=r,new n}();(function(n){(function(a){var o=typeof n<"u"&&n||typeof self<"u"&&self||typeof Dt<"u"&&Dt||{},c={searchParams:"URLSearchParams"in o,iterable:"Symbol"in o&&"iterator"in Symbol,blob:"FileReader"in o&&"Blob"in o&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in o,arrayBuffer:"ArrayBuffer"in o};function h(p){return p&&DataView.prototype.isPrototypeOf(p)}if(c.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(p){return p&&f.indexOf(Object.prototype.toString.call(p))>-1};function v(p){if(typeof p!="string"&&(p=String(p)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(p)||p==="")throw new TypeError('Invalid character in header field name: "'+p+'"');return p.toLowerCase()}function _(p){return typeof p!="string"&&(p=String(p)),p}function m(p){var g={next:function(){var E=p.shift();return{done:E===void 0,value:E}}};return c.iterable&&(g[Symbol.iterator]=function(){return g}),g}function $(p){this.map={},p instanceof $?p.forEach(function(g,E){this.append(E,g)},this):Array.isArray(p)?p.forEach(function(g){if(g.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+g.length);this.append(g[0],g[1])},this):p&&Object.getOwnPropertyNames(p).forEach(function(g){this.append(g,p[g])},this)}$.prototype.append=function(p,g){p=v(p),g=_(g);var E=this.map[p];this.map[p]=E?E+", "+g:g},$.prototype.delete=function(p){delete this.map[v(p)]},$.prototype.get=function(p){return p=v(p),this.has(p)?this.map[p]:null},$.prototype.has=function(p){return this.map.hasOwnProperty(v(p))},$.prototype.set=function(p,g){this.map[v(p)]=_(g)},$.prototype.forEach=function(p,g){for(var E in this.map)this.map.hasOwnProperty(E)&&p.call(g,this.map[E],E,this)},$.prototype.keys=function(){var p=[];return this.forEach(function(g,E){p.push(E)}),m(p)},$.prototype.values=function(){var p=[];return this.forEach(function(g){p.push(g)}),m(p)},$.prototype.entries=function(){var p=[];return this.forEach(function(g,E){p.push([E,g])}),m(p)},c.iterable&&($.prototype[Symbol.iterator]=$.prototype.entries);function O(p){if(!p._noBody){if(p.bodyUsed)return Promise.reject(new TypeError("Already read"));p.bodyUsed=!0}}function D(p){return new Promise(function(g,E){p.onload=function(){g(p.result)},p.onerror=function(){E(p.error)}})}function P(p){var g=new FileReader,E=D(g);return g.readAsArrayBuffer(p),E}function C(p){var g=new FileReader,E=D(g),I=/charset=([A-Za-z0-9_-]+)/.exec(p.type),y=I?I[1]:"utf-8";return g.readAsText(p,y),E}function T(p){for(var g=new Uint8Array(p),E=new Array(g.length),I=0;I<g.length;I++)E[I]=String.fromCharCode(g[I]);return E.join("")}function N(p){if(p.slice)return p.slice(0);var g=new Uint8Array(p.byteLength);return g.set(new Uint8Array(p)),g.buffer}function z(){return this.bodyUsed=!1,this._initBody=function(p){this.bodyUsed=this.bodyUsed,this._bodyInit=p,p?typeof p=="string"?this._bodyText=p:c.blob&&Blob.prototype.isPrototypeOf(p)?this._bodyBlob=p:c.formData&&FormData.prototype.isPrototypeOf(p)?this._bodyFormData=p:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(p)?this._bodyText=p.toString():c.arrayBuffer&&c.blob&&h(p)?(this._bodyArrayBuffer=N(p.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(p)||l(p))?this._bodyArrayBuffer=N(p):this._bodyText=p=Object.prototype.toString.call(p):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof p=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(p)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var p=O(this);if(p)return p;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var p=O(this);return p||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(P);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var p=O(this);if(p)return p;if(this._bodyBlob)return C(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(T(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(J)}),this.json=function(){return this.text().then(JSON.parse)},this}var H=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function U(p){var g=p.toUpperCase();return H.indexOf(g)>-1?g:p}function B(p,g){if(!(this instanceof B))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');g=g||{};var E=g.body;if(p instanceof B){if(p.bodyUsed)throw new TypeError("Already read");this.url=p.url,this.credentials=p.credentials,g.headers||(this.headers=new $(p.headers)),this.method=p.method,this.mode=p.mode,this.signal=p.signal,!E&&p._bodyInit!=null&&(E=p._bodyInit,p.bodyUsed=!0)}else this.url=String(p);if(this.credentials=g.credentials||this.credentials||"same-origin",(g.headers||!this.headers)&&(this.headers=new $(g.headers)),this.method=U(g.method||this.method||"GET"),this.mode=g.mode||this.mode||null,this.signal=g.signal||this.signal||function(){if("AbortController"in o){var d=new AbortController;return d.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&E)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(E),(this.method==="GET"||this.method==="HEAD")&&(g.cache==="no-store"||g.cache==="no-cache")){var I=/([?&])_=[^&]*/;if(I.test(this.url))this.url=this.url.replace(I,"$1_="+new Date().getTime());else{var y=/\?/;this.url+=(y.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}B.prototype.clone=function(){return new B(this,{body:this._bodyInit})};function J(p){var g=new FormData;return p.trim().split("&").forEach(function(E){if(E){var I=E.split("="),y=I.shift().replace(/\+/g," "),d=I.join("=").replace(/\+/g," ");g.append(decodeURIComponent(y),decodeURIComponent(d))}}),g}function S(p){var g=new $,E=p.replace(/\r?\n[\t ]+/g," ");return E.split("\r").map(function(I){return I.indexOf(`
`)===0?I.substr(1,I.length):I}).forEach(function(I){var y=I.split(":"),d=y.shift().trim();if(d){var x=y.join(":").trim();try{g.append(d,x)}catch(R){console.warn("Response "+R.message)}}}),g}z.call(B.prototype);function u(p,g){if(!(this instanceof u))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(g||(g={}),this.type="default",this.status=g.status===void 0?200:g.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=g.statusText===void 0?"":""+g.statusText,this.headers=new $(g.headers),this.url=g.url||"",this._initBody(p)}z.call(u.prototype),u.prototype.clone=function(){return new u(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new $(this.headers),url:this.url})},u.error=function(){var p=new u(null,{status:200,statusText:""});return p.ok=!1,p.status=0,p.type="error",p};var b=[301,302,303,307,308];u.redirect=function(p,g){if(b.indexOf(g)===-1)throw new RangeError("Invalid status code");return new u(null,{status:g,headers:{location:p}})},a.DOMException=o.DOMException;try{new a.DOMException}catch{a.DOMException=function(g,E){this.message=g,this.name=E;var I=Error(g);this.stack=I.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function w(p,g){return new Promise(function(E,I){var y=new B(p,g);if(y.signal&&y.signal.aborted)return I(new a.DOMException("Aborted","AbortError"));var d=new XMLHttpRequest;function x(){d.abort()}d.onload=function(){var F={statusText:d.statusText,headers:S(d.getAllResponseHeaders()||"")};y.url.indexOf("file://")===0&&(d.status<200||d.status>599)?F.status=200:F.status=d.status,F.url="responseURL"in d?d.responseURL:F.headers.get("X-Request-URL");var q="response"in d?d.response:d.responseText;setTimeout(function(){E(new u(q,F))},0)},d.onerror=function(){setTimeout(function(){I(new TypeError("Network request failed"))},0)},d.ontimeout=function(){setTimeout(function(){I(new TypeError("Network request timed out"))},0)},d.onabort=function(){setTimeout(function(){I(new a.DOMException("Aborted","AbortError"))},0)};function R(F){try{return F===""&&o.location.href?o.location.href:F}catch{return F}}if(d.open(y.method,R(y.url),!0),y.credentials==="include"?d.withCredentials=!0:y.credentials==="omit"&&(d.withCredentials=!1),"responseType"in d&&(c.blob?d.responseType="blob":c.arrayBuffer&&(d.responseType="arraybuffer")),g&&typeof g.headers=="object"&&!(g.headers instanceof $||o.Headers&&g.headers instanceof o.Headers)){var j=[];Object.getOwnPropertyNames(g.headers).forEach(function(F){j.push(v(F)),d.setRequestHeader(F,_(g.headers[F]))}),y.headers.forEach(function(F,q){j.indexOf(q)===-1&&d.setRequestHeader(q,F)})}else y.headers.forEach(function(F,q){d.setRequestHeader(q,F)});y.signal&&(y.signal.addEventListener("abort",x),d.onreadystatechange=function(){d.readyState===4&&y.signal.removeEventListener("abort",x)}),d.send(typeof y._bodyInit>"u"?null:y._bodyInit)})}return w.polyfill=!0,o.fetch||(o.fetch=w,o.Headers=$,o.Request=B,o.Response=u),a.Headers=$,a.Request=B,a.Response=u,a.fetch=w,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=r.fetch?r:i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,t.exports=e})(fh,fh.exports);var $x=fh.exports;const Nd=vh($x);var Sx=Object.defineProperty,Ix=Object.defineProperties,Ax=Object.getOwnPropertyDescriptors,Fd=Object.getOwnPropertySymbols,Dx=Object.prototype.hasOwnProperty,Px=Object.prototype.propertyIsEnumerable,Bd=(t,e,r)=>e in t?Sx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qd=(t,e)=>{for(var r in e||(e={}))Dx.call(e,r)&&Bd(t,r,e[r]);if(Fd)for(var r of Fd(e))Px.call(e,r)&&Bd(t,r,e[r]);return t},Ld=(t,e)=>Ix(t,Ax(e));const Ox={Accept:"application/json","Content-Type":"application/json"},Mx="POST",jd={headers:Ox,method:Mx},Ud=10;let mr=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new ir.EventEmitter,this.isAvailable=!1,this.registering=!1,!cd(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=Xr(e),i=await(await Nd(this.url,Ld(qd({},jd),{body:r}))).json();this.onPayload({data:i})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!cd(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=Xr({id:1,jsonrpc:"2.0",method:"test",params:[]});await Nd(e,Ld(qd({},jd),{body:r}))}this.onOpen()}catch(r){const i=this.parseError(r);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Li(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=So(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return P0(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Ud&&this.events.setMaxListeners(Ud)}};const zd="error",Cx="wss://relay.walletconnect.org",Tx="wc",Rx="universal_provider",kd=`${Tx}@2:${Rx}:`,e1="https://rpc.walletconnect.org/v1/",_s="generic",Nx=`${e1}bundler`,or={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Da=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fx(){this.__data__=[],this.size=0}var Bx=Fx;function qx(t,e){return t===e||t!==t&&e!==e}var Po=qx,Lx=Po;function jx(t,e){for(var r=t.length;r--;)if(Lx(t[r][0],e))return r;return-1}var Oo=jx,Ux=Oo,zx=Array.prototype,kx=zx.splice;function Hx(t){var e=this.__data__,r=Ux(e,t);if(r<0)return!1;var i=e.length-1;return r==i?e.pop():kx.call(e,r,1),--this.size,!0}var Kx=Hx,Vx=Oo;function Wx(t){var e=this.__data__,r=Vx(e,t);return r<0?void 0:e[r][1]}var Gx=Wx,Jx=Oo;function Yx(t){return Jx(this.__data__,t)>-1}var Xx=Yx,Zx=Oo;function Qx(t,e){var r=this.__data__,i=Zx(r,t);return i<0?(++this.size,r.push([t,e])):r[i][1]=e,this}var e$=Qx,t$=Bx,r$=Kx,i$=Gx,s$=Xx,n$=e$;function Es(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}Es.prototype.clear=t$,Es.prototype.delete=r$,Es.prototype.get=i$,Es.prototype.has=s$,Es.prototype.set=n$;var Mo=Es,a$=Mo;function o$(){this.__data__=new a$,this.size=0}var c$=o$;function h$(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var u$=h$;function f$(t){return this.__data__.get(t)}var d$=f$;function l$(t){return this.__data__.has(t)}var p$=l$,b$=typeof Da=="object"&&Da&&Da.Object===Object&&Da,t1=b$,g$=t1,v$=typeof self=="object"&&self&&self.Object===Object&&self,y$=g$||v$||Function("return this")(),Js=y$,m$=Js,w$=m$.Symbol,r1=w$,Hd=r1,i1=Object.prototype,_$=i1.hasOwnProperty,E$=i1.toString,Pn=Hd?Hd.toStringTag:void 0;function x$(t){var e=_$.call(t,Pn),r=t[Pn];try{t[Pn]=void 0;var i=!0}catch{}var s=E$.call(t);return i&&(e?t[Pn]=r:delete t[Pn]),s}var $$=x$,S$=Object.prototype,I$=S$.toString;function A$(t){return I$.call(t)}var D$=A$,Kd=r1,P$=$$,O$=D$,M$="[object Null]",C$="[object Undefined]",Vd=Kd?Kd.toStringTag:void 0;function T$(t){return t==null?t===void 0?C$:M$:Vd&&Vd in Object(t)?P$(t):O$(t)}var Co=T$;function R$(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Ji=R$,N$=Co,F$=Ji,B$="[object AsyncFunction]",q$="[object Function]",L$="[object GeneratorFunction]",j$="[object Proxy]";function U$(t){if(!F$(t))return!1;var e=N$(t);return e==q$||e==L$||e==B$||e==j$}var Jh=U$,z$=Js,k$=z$["__core-js_shared__"],H$=k$,Ec=H$,Wd=function(){var t=/[^.]+$/.exec(Ec&&Ec.keys&&Ec.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function K$(t){return!!Wd&&Wd in t}var V$=K$,W$=Function.prototype,G$=W$.toString;function J$(t){if(t!=null){try{return G$.call(t)}catch{}try{return t+""}catch{}}return""}var Y$=J$,X$=Jh,Z$=V$,Q$=Ji,eS=Y$,tS=/[\\^$.*+?()[\]{}|]/g,rS=/^\[object .+?Constructor\]$/,iS=Function.prototype,sS=Object.prototype,nS=iS.toString,aS=sS.hasOwnProperty,oS=RegExp("^"+nS.call(aS).replace(tS,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function cS(t){if(!Q$(t)||Z$(t))return!1;var e=X$(t)?oS:rS;return e.test(eS(t))}var hS=cS;function uS(t,e){return t==null?void 0:t[e]}var fS=uS,dS=hS,lS=fS;function pS(t,e){var r=lS(t,e);return dS(r)?r:void 0}var Yh=pS,bS=Yh,gS=Js,vS=bS(gS,"Map"),s1=vS,yS=Yh,mS=yS(Object,"create"),To=mS,Gd=To;function wS(){this.__data__=Gd?Gd(null):{},this.size=0}var _S=wS;function ES(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var xS=ES,$S=To,SS="__lodash_hash_undefined__",IS=Object.prototype,AS=IS.hasOwnProperty;function DS(t){var e=this.__data__;if($S){var r=e[t];return r===SS?void 0:r}return AS.call(e,t)?e[t]:void 0}var PS=DS,OS=To,MS=Object.prototype,CS=MS.hasOwnProperty;function TS(t){var e=this.__data__;return OS?e[t]!==void 0:CS.call(e,t)}var RS=TS,NS=To,FS="__lodash_hash_undefined__";function BS(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=NS&&e===void 0?FS:e,this}var qS=BS,LS=_S,jS=xS,US=PS,zS=RS,kS=qS;function xs(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}xs.prototype.clear=LS,xs.prototype.delete=jS,xs.prototype.get=US,xs.prototype.has=zS,xs.prototype.set=kS;var HS=xs,Jd=HS,KS=Mo,VS=s1;function WS(){this.size=0,this.__data__={hash:new Jd,map:new(VS||KS),string:new Jd}}var GS=WS;function JS(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var YS=JS,XS=YS;function ZS(t,e){var r=t.__data__;return XS(e)?r[typeof e=="string"?"string":"hash"]:r.map}var Ro=ZS,QS=Ro;function eI(t){var e=QS(this,t).delete(t);return this.size-=e?1:0,e}var tI=eI,rI=Ro;function iI(t){return rI(this,t).get(t)}var sI=iI,nI=Ro;function aI(t){return nI(this,t).has(t)}var oI=aI,cI=Ro;function hI(t,e){var r=cI(this,t),i=r.size;return r.set(t,e),this.size+=r.size==i?0:1,this}var uI=hI,fI=GS,dI=tI,lI=sI,pI=oI,bI=uI;function $s(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}$s.prototype.clear=fI,$s.prototype.delete=dI,$s.prototype.get=lI,$s.prototype.has=pI,$s.prototype.set=bI;var gI=$s,vI=Mo,yI=s1,mI=gI,wI=200;function _I(t,e){var r=this.__data__;if(r instanceof vI){var i=r.__data__;if(!yI||i.length<wI-1)return i.push([t,e]),this.size=++r.size,this;r=this.__data__=new mI(i)}return r.set(t,e),this.size=r.size,this}var EI=_I,xI=Mo,$I=c$,SI=u$,II=d$,AI=p$,DI=EI;function Ss(t){var e=this.__data__=new xI(t);this.size=e.size}Ss.prototype.clear=$I,Ss.prototype.delete=SI,Ss.prototype.get=II,Ss.prototype.has=AI,Ss.prototype.set=DI;var PI=Ss,OI=Yh,MI=function(){try{var t=OI(Object,"defineProperty");return t({},"",{}),t}catch{}}(),n1=MI,Yd=n1;function CI(t,e,r){e=="__proto__"&&Yd?Yd(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Xh=CI,TI=Xh,RI=Po;function NI(t,e,r){(r!==void 0&&!RI(t[e],r)||r===void 0&&!(e in t))&&TI(t,e,r)}var a1=NI;function FI(t){return function(e,r,i){for(var s=-1,n=Object(e),a=i(e),o=a.length;o--;){var c=a[t?o:++s];if(r(n[c],c,n)===!1)break}return e}}var BI=FI,qI=BI,LI=qI(),jI=LI,dh={exports:{}};(function(t,e){var r=Js,i=e&&!e.nodeType&&e,s=i&&!0&&t&&!t.nodeType&&t,n=s&&s.exports===i,a=n?r.Buffer:void 0,o=a?a.allocUnsafe:void 0;function c(h,f){if(f)return h.slice();var l=h.length,v=o?o(l):new h.constructor(l);return h.copy(v),v}t.exports=c})(dh,dh.exports);var UI=Js,zI=UI.Uint8Array,kI=zI,Xd=kI;function HI(t){var e=new t.constructor(t.byteLength);return new Xd(e).set(new Xd(t)),e}var KI=HI,VI=KI;function WI(t,e){var r=e?VI(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var GI=WI;function JI(t,e){var r=-1,i=t.length;for(e||(e=Array(i));++r<i;)e[r]=t[r];return e}var YI=JI,XI=Ji,Zd=Object.create,ZI=function(){function t(){}return function(e){if(!XI(e))return{};if(Zd)return Zd(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),QI=ZI;function eA(t,e){return function(r){return t(e(r))}}var tA=eA,rA=tA,iA=rA(Object.getPrototypeOf,Object),o1=iA,sA=Object.prototype;function nA(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||sA;return t===r}var c1=nA,aA=QI,oA=o1,cA=c1;function hA(t){return typeof t.constructor=="function"&&!cA(t)?aA(oA(t)):{}}var uA=hA;function fA(t){return t!=null&&typeof t=="object"}var sa=fA,dA=Co,lA=sa,pA="[object Arguments]";function bA(t){return lA(t)&&dA(t)==pA}var gA=bA,Qd=gA,vA=sa,h1=Object.prototype,yA=h1.hasOwnProperty,mA=h1.propertyIsEnumerable,wA=Qd(function(){return arguments}())?Qd:function(t){return vA(t)&&yA.call(t,"callee")&&!mA.call(t,"callee")},u1=wA,_A=Array.isArray,f1=_A,EA=9007199254740991;function xA(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=EA}var d1=xA,$A=Jh,SA=d1;function IA(t){return t!=null&&SA(t.length)&&!$A(t)}var Zh=IA,AA=Zh,DA=sa;function PA(t){return DA(t)&&AA(t)}var OA=PA,Za={exports:{}};function MA(){return!1}var CA=MA;(function(t,e){var r=Js,i=CA,s=e&&!e.nodeType&&e,n=s&&!0&&t&&!t.nodeType&&t,a=n&&n.exports===s,o=a?r.Buffer:void 0,c=o?o.isBuffer:void 0,h=c||i;t.exports=h})(Za,Za.exports);var TA=Co,RA=o1,NA=sa,FA="[object Object]",BA=Function.prototype,qA=Object.prototype,l1=BA.toString,LA=qA.hasOwnProperty,jA=l1.call(Object);function UA(t){if(!NA(t)||TA(t)!=FA)return!1;var e=RA(t);if(e===null)return!0;var r=LA.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&l1.call(r)==jA}var zA=UA,kA=Co,HA=d1,KA=sa,VA="[object Arguments]",WA="[object Array]",GA="[object Boolean]",JA="[object Date]",YA="[object Error]",XA="[object Function]",ZA="[object Map]",QA="[object Number]",eD="[object Object]",tD="[object RegExp]",rD="[object Set]",iD="[object String]",sD="[object WeakMap]",nD="[object ArrayBuffer]",aD="[object DataView]",oD="[object Float32Array]",cD="[object Float64Array]",hD="[object Int8Array]",uD="[object Int16Array]",fD="[object Int32Array]",dD="[object Uint8Array]",lD="[object Uint8ClampedArray]",pD="[object Uint16Array]",bD="[object Uint32Array]",De={};De[oD]=De[cD]=De[hD]=De[uD]=De[fD]=De[dD]=De[lD]=De[pD]=De[bD]=!0,De[VA]=De[WA]=De[nD]=De[GA]=De[aD]=De[JA]=De[YA]=De[XA]=De[ZA]=De[QA]=De[eD]=De[tD]=De[rD]=De[iD]=De[sD]=!1;function gD(t){return KA(t)&&HA(t.length)&&!!De[kA(t)]}var vD=gD;function yD(t){return function(e){return t(e)}}var mD=yD,lh={exports:{}};(function(t,e){var r=t1,i=e&&!e.nodeType&&e,s=i&&!0&&t&&!t.nodeType&&t,n=s&&s.exports===i,a=n&&r.process,o=function(){try{var c=s&&s.require&&s.require("util").types;return c||a&&a.binding&&a.binding("util")}catch{}}();t.exports=o})(lh,lh.exports);var wD=vD,_D=mD,el=lh.exports,tl=el&&el.isTypedArray,ED=tl?_D(tl):wD,p1=ED;function xD(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var b1=xD,$D=Xh,SD=Po,ID=Object.prototype,AD=ID.hasOwnProperty;function DD(t,e,r){var i=t[e];(!(AD.call(t,e)&&SD(i,r))||r===void 0&&!(e in t))&&$D(t,e,r)}var PD=DD,OD=PD,MD=Xh;function CD(t,e,r,i){var s=!r;r||(r={});for(var n=-1,a=e.length;++n<a;){var o=e[n],c=i?i(r[o],t[o],o,r,t):void 0;c===void 0&&(c=t[o]),s?MD(r,o,c):OD(r,o,c)}return r}var TD=CD;function RD(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}var ND=RD,FD=9007199254740991,BD=/^(?:0|[1-9]\d*)$/;function qD(t,e){var r=typeof t;return e=e??FD,!!e&&(r=="number"||r!="symbol"&&BD.test(t))&&t>-1&&t%1==0&&t<e}var g1=qD,LD=ND,jD=u1,UD=f1,zD=Za.exports,kD=g1,HD=p1,KD=Object.prototype,VD=KD.hasOwnProperty;function WD(t,e){var r=UD(t),i=!r&&jD(t),s=!r&&!i&&zD(t),n=!r&&!i&&!s&&HD(t),a=r||i||s||n,o=a?LD(t.length,String):[],c=o.length;for(var h in t)(e||VD.call(t,h))&&!(a&&(h=="length"||s&&(h=="offset"||h=="parent")||n&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||kD(h,c)))&&o.push(h);return o}var GD=WD;function JD(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var YD=JD,XD=Ji,ZD=c1,QD=YD,eP=Object.prototype,tP=eP.hasOwnProperty;function rP(t){if(!XD(t))return QD(t);var e=ZD(t),r=[];for(var i in t)i=="constructor"&&(e||!tP.call(t,i))||r.push(i);return r}var iP=rP,sP=GD,nP=iP,aP=Zh;function oP(t){return aP(t)?sP(t,!0):nP(t)}var v1=oP,cP=TD,hP=v1;function uP(t){return cP(t,hP(t))}var fP=uP,rl=a1,dP=dh.exports,lP=GI,pP=YI,bP=uA,il=u1,sl=f1,gP=OA,vP=Za.exports,yP=Jh,mP=Ji,wP=zA,_P=p1,nl=b1,EP=fP;function xP(t,e,r,i,s,n,a){var o=nl(t,r),c=nl(e,r),h=a.get(c);if(h){rl(t,r,h);return}var f=n?n(o,c,r+"",t,e,a):void 0,l=f===void 0;if(l){var v=sl(c),_=!v&&vP(c),m=!v&&!_&&_P(c);f=c,v||_||m?sl(o)?f=o:gP(o)?f=pP(o):_?(l=!1,f=dP(c,!0)):m?(l=!1,f=lP(c,!0)):f=[]:wP(c)||il(c)?(f=o,il(o)?f=EP(o):(!mP(o)||yP(o))&&(f=bP(c))):l=!1}l&&(a.set(c,f),s(f,c,i,n,a),a.delete(c)),rl(t,r,f)}var $P=xP,SP=PI,IP=a1,AP=jI,DP=$P,PP=Ji,OP=v1,MP=b1;function y1(t,e,r,i,s){t!==e&&AP(e,function(n,a){if(s||(s=new SP),PP(n))DP(t,e,a,r,y1,i,s);else{var o=i?i(MP(t,a),n,a+"",t,e,s):void 0;o===void 0&&(o=n),IP(t,a,o)}},OP)}var CP=y1;function TP(t){return t}var m1=TP;function RP(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var NP=RP,FP=NP,al=Math.max;function BP(t,e,r){return e=al(e===void 0?t.length-1:e,0),function(){for(var i=arguments,s=-1,n=al(i.length-e,0),a=Array(n);++s<n;)a[s]=i[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=i[s];return o[e]=r(a),FP(t,this,o)}}var qP=BP;function LP(t){return function(){return t}}var jP=LP,UP=jP,ol=n1,zP=m1,kP=ol?function(t,e){return ol(t,"toString",{configurable:!0,enumerable:!1,value:UP(e),writable:!0})}:zP,HP=kP,KP=800,VP=16,WP=Date.now;function GP(t){var e=0,r=0;return function(){var i=WP(),s=VP-(i-r);if(r=i,s>0){if(++e>=KP)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var JP=GP,YP=HP,XP=JP,ZP=XP(YP),QP=ZP,eO=m1,tO=qP,rO=QP;function iO(t,e){return rO(tO(t,e,eO),t+"")}var sO=iO,nO=Po,aO=Zh,oO=g1,cO=Ji;function hO(t,e,r){if(!cO(r))return!1;var i=typeof e;return(i=="number"?aO(r)&&oO(e,r.length):i=="string"&&e in r)?nO(r[e],t):!1}var uO=hO,fO=sO,dO=uO;function lO(t){return fO(function(e,r){var i=-1,s=r.length,n=s>1?r[s-1]:void 0,a=s>2?r[2]:void 0;for(n=t.length>3&&typeof n=="function"?(s--,n):void 0,a&&dO(r[0],r[1],a)&&(n=s<3?void 0:n,s=1),e=Object(e);++i<s;){var o=r[i];o&&t(e,o,i,n)}return e})}var pO=lO,bO=CP,gO=pO,vO=gO(function(t,e,r){bO(t,e,r)}),yO=vO,mO=Object.defineProperty,wO=Object.defineProperties,_O=Object.getOwnPropertyDescriptors,cl=Object.getOwnPropertySymbols,EO=Object.prototype.hasOwnProperty,xO=Object.prototype.propertyIsEnumerable,hl=(t,e,r)=>e in t?mO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pa=(t,e)=>{for(var r in e||(e={}))EO.call(e,r)&&hl(t,r,e[r]);if(cl)for(var r of cl(e))xO.call(e,r)&&hl(t,r,e[r]);return t},$O=(t,e)=>wO(t,_O(e));function Vt(t,e,r){var i;const s=Ps(t);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${e1}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function Yi(t){return t.includes(":")?t.split(":")[1]:t}function w1(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function SO(t,e){const r=Object.keys(e.namespaces).filter(s=>s.includes(t));if(!r.length)return[];const i=[];return r.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function xc(t={},e={}){const r=ul(t),i=ul(e);return yO(r,i)}function ul(t){var e,r,i,s;const n={};if(!jn(t))return n;for(const[a,o]of Object.entries(t)){const c=kh(a)?[a]:o.chains,h=o.methods||[],f=o.events||[],l=o.rpcMap||{},v=Mn(a);n[v]=$O(Pa(Pa({},n[v]),o),{chains:Ta(c,(e=n[v])==null?void 0:e.chains),methods:Ta(h,(r=n[v])==null?void 0:r.methods),events:Ta(f,(i=n[v])==null?void 0:i.events),rpcMap:Pa(Pa({},l),(s=n[v])==null?void 0:s.rpcMap)})}return n}function IO(t){return t.includes(":")?t.split(":")[2]:t}function fl(t){const e={};for(const[r,i]of Object.entries(t)){const s=i.methods||[],n=i.events||[],a=i.accounts||[],o=kh(r)?[r]:i.chains?i.chains:w1(i.accounts);e[r]={chains:o,methods:s,events:n,accounts:a}}return e}function $c(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}const _1={},he=t=>_1[t],Sc=(t,e)=>{_1[t]=e};var AO=Object.defineProperty,DO=(t,e,r)=>e in t?AO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hs=(t,e,r)=>DO(t,typeof e!="symbol"?e+"":e,r);class PO{constructor(e){hs(this,"name","polkadot"),hs(this,"client"),hs(this,"httpProviders"),hs(this,"events"),hs(this,"namespace"),hs(this,"chainId"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const s=Yi(r);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new mr(i,he("disableProviderPing")))}}var OO=Object.defineProperty,MO=Object.defineProperties,CO=Object.getOwnPropertyDescriptors,dl=Object.getOwnPropertySymbols,TO=Object.prototype.hasOwnProperty,RO=Object.prototype.propertyIsEnumerable,ph=(t,e,r)=>e in t?OO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ll=(t,e)=>{for(var r in e||(e={}))TO.call(e,r)&&ph(t,r,e[r]);if(dl)for(var r of dl(e))RO.call(e,r)&&ph(t,r,e[r]);return t},pl=(t,e)=>MO(t,CO(e)),us=(t,e,r)=>ph(t,typeof e!="symbol"?e+"":e,r);class NO{constructor(e){us(this,"name","eip155"),us(this,"client"),us(this,"chainId"),us(this,"namespace"),us(this,"httpProviders"),us(this,"events"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r),this.chainId=parseInt(e),this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const i=r||Vt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new mr(i,he("disableProviderPing")))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const s=parseInt(Yi(r));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}async handleSwitchChain(e){var r,i;let s=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,i,s;const n=(i=(r=e.request)==null?void 0:r.params)==null?void 0:i[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const a=this.client.session.get(e.topic),o=((s=a==null?void 0:a.sessionProperties)==null?void 0:s.capabilities)||{};if(o!=null&&o[n])return o==null?void 0:o[n];const c=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:pl(ll({},a.sessionProperties||{}),{capabilities:pl(ll({},o||{}),{[n]:c})})})}catch(h){console.warn("Failed to update session with capabilities",h)}return c}async getCallStatus(e){var r,i;const s=this.client.session.get(e.topic),n=(r=s.sessionProperties)==null?void 0:r.bundler_name;if(n){const o=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(o,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,o)}}const a=(i=s.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(o){console.warn("Failed to fetch call status from custom bundler",o,a)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(pi("eth_getUserOperationReceipt",[(i=r.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,r){return`${Nx}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}}var FO=Object.defineProperty,BO=(t,e,r)=>e in t?FO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fs=(t,e,r)=>BO(t,typeof e!="symbol"?e+"":e,r);class qO{constructor(e){fs(this,"name","solana"),fs(this,"client"),fs(this,"httpProviders"),fs(this,"events"),fs(this,"namespace"),fs(this,"chainId"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const s=Yi(r);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new mr(i,he("disableProviderPing")))}}var LO=Object.defineProperty,jO=(t,e,r)=>e in t?LO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ds=(t,e,r)=>jO(t,typeof e!="symbol"?e+"":e,r);class UO{constructor(e){ds(this,"name","cosmos"),ds(this,"client"),ds(this,"httpProviders"),ds(this,"events"),ds(this,"namespace"),ds(this,"chainId"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const s=Yi(r);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new mr(i,he("disableProviderPing")))}}var zO=Object.defineProperty,kO=(t,e,r)=>e in t?zO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ls=(t,e,r)=>kO(t,typeof e!="symbol"?e+"":e,r);class HO{constructor(e){ls(this,"name","algorand"),ls(this,"client"),ls(this,"httpProviders"),ls(this,"events"),ls(this,"namespace"),ls(this,"chainId"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(!this.httpProviders[e]){const i=r||Vt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Vt(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new ar(new mr(i,he("disableProviderPing")))}}var KO=Object.defineProperty,VO=(t,e,r)=>e in t?KO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ps=(t,e,r)=>VO(t,typeof e!="symbol"?e+"":e,r);class WO{constructor(e){ps(this,"name","cip34"),ps(this,"client"),ps(this,"httpProviders"),ps(this,"events"),ps(this,"namespace"),ps(this,"chainId"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{const i=this.getCardanoRPCUrl(r),s=Yi(r);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}getCardanoRPCUrl(e){const r=this.namespace.rpcMap;if(r)return r[e]}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new mr(i,he("disableProviderPing")))}}var GO=Object.defineProperty,JO=(t,e,r)=>e in t?GO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bs=(t,e,r)=>JO(t,typeof e!="symbol"?e+"":e,r);class YO{constructor(e){bs(this,"name","elrond"),bs(this,"client"),bs(this,"httpProviders"),bs(this,"events"),bs(this,"namespace"),bs(this,"chainId"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const s=Yi(r);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new mr(i,he("disableProviderPing")))}}var XO=Object.defineProperty,ZO=(t,e,r)=>e in t?XO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gs=(t,e,r)=>ZO(t,typeof e!="symbol"?e+"":e,r);class QO{constructor(e){gs(this,"name","multiversx"),gs(this,"client"),gs(this,"httpProviders"),gs(this,"events"),gs(this,"namespace"),gs(this,"chainId"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const s=Yi(r);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new mr(i,he("disableProviderPing")))}}var eM=Object.defineProperty,tM=(t,e,r)=>e in t?eM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vs=(t,e,r)=>tM(t,typeof e!="symbol"?e+"":e,r);class rM{constructor(e){vs(this,"name","near"),vs(this,"client"),vs(this,"httpProviders"),vs(this,"events"),vs(this,"namespace"),vs(this,"chainId"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Vt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Vt(e,this.namespace);return typeof i>"u"?void 0:new ar(new mr(i,he("disableProviderPing")))}}var iM=Object.defineProperty,sM=(t,e,r)=>e in t?iM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ys=(t,e,r)=>sM(t,typeof e!="symbol"?e+"":e,r);class nM{constructor(e){ys(this,"name","tezos"),ys(this,"client"),ys(this,"httpProviders"),ys(this,"events"),ys(this,"namespace"),ys(this,"chainId"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Vt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Vt(e,this.namespace);return typeof i>"u"?void 0:new ar(new mr(i))}}var aM=Object.defineProperty,oM=(t,e,r)=>e in t?aM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ms=(t,e,r)=>oM(t,typeof e!="symbol"?e+"":e,r);class cM{constructor(e){ms(this,"name",_s),ms(this,"client"),ms(this,"httpProviders"),ms(this,"events"),ms(this,"namespace"),ms(this,"chainId"),this.namespace=e.namespace,this.events=he("events"),this.client=he("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(or.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const i={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(s=>{const n=Ps(s);i[`${n.namespace}:${n.reference}`]=this.createHttpProvider(s)}),i}getHttpProvider(e){const r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Vt(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new mr(i,he("disableProviderPing")))}}var hM=Object.defineProperty,uM=Object.defineProperties,fM=Object.getOwnPropertyDescriptors,bl=Object.getOwnPropertySymbols,dM=Object.prototype.hasOwnProperty,lM=Object.prototype.propertyIsEnumerable,bh=(t,e,r)=>e in t?hM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oa=(t,e)=>{for(var r in e||(e={}))dM.call(e,r)&&bh(t,r,e[r]);if(bl)for(var r of bl(e))lM.call(e,r)&&bh(t,r,e[r]);return t},Ic=(t,e)=>uM(t,fM(e)),br=(t,e,r)=>bh(t,typeof e!="symbol"?e+"":e,r);class Qh{constructor(e){br(this,"client"),br(this,"namespaces"),br(this,"optionalNamespaces"),br(this,"sessionProperties"),br(this,"events",new yh),br(this,"rpcProviders",{}),br(this,"session"),br(this,"providerOpts"),br(this,"logger"),br(this,"uri"),br(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:ta(xo({level:(e==null?void 0:e.logger)||zd})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const r=new Qh(e);return await r.initialize(),r}async request(e,r,i){const[s,n]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Oa({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,r,i,s){const n=new Date().getTime();this.request(e,i,s).then(a=>r(null,$o(n,a))).catch(a=>r(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:fe("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,r);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const a=fl(this.session.namespaces);this.namespaces=xc(this.namespaces,a),this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});r&&(this.uri=r,this.events.emit("display_uri",r));const s=await i();this.session=s;const n=fl(s.namespaces);return this.namespaces=xc(this.namespaces,n),this.persist("namespaces",this.namespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[i,s]=this.validateChain(e),n=this.getProvider(i);n.name===_s?n.setDefaultChain(`${i}:${s}`,r):n.setDefaultChain(s,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Fr(r)){for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await xx.init({core:this.providerOpts.core,logger:this.providerOpts.logger||zd,relayUrl:this.providerOpts.relayUrl||Cx,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>Mn(r)))];Sc("client",this.client),Sc("events",this.events),Sc("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const i=SO(r,this.session),s=w1(i),n=xc(this.namespaces,this.optionalNamespaces),a=Ic(Oa({},n[r]),{accounts:i,chains:s});switch(r){case"eip155":this.rpcProviders[r]=new NO({namespace:a});break;case"algorand":this.rpcProviders[r]=new HO({namespace:a});break;case"solana":this.rpcProviders[r]=new qO({namespace:a});break;case"cosmos":this.rpcProviders[r]=new UO({namespace:a});break;case"polkadot":this.rpcProviders[r]=new PO({namespace:a});break;case"cip34":this.rpcProviders[r]=new WO({namespace:a});break;case"elrond":this.rpcProviders[r]=new YO({namespace:a});break;case"multiversx":this.rpcProviders[r]=new QO({namespace:a});break;case"near":this.rpcProviders[r]=new rM({namespace:a});break;case"tezos":this.rpcProviders[r]=new nM({namespace:a});break;default:this.rpcProviders[_s]?this.rpcProviders[_s].updateNamespace(a):this.rpcProviders[_s]=new cM({namespace:a})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:r}=e,{event:i}=r;if(i.name==="accountsChanged"){const s=i.data;s&&Fr(s)&&this.events.emit("accountsChanged",s.map(IO))}else if(i.name==="chainChanged"){const s=r.chainId,n=r.event.data,a=Mn(s),o=$c(s)!==$c(n)?`${a}:${$c(n)}`:s;this.onChainChanged(o)}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:s}=r,n=(i=this.client)==null?void 0:i.session.get(e);this.session=Ic(Oa({},n),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Ic(Oa({},fe("USER_DISCONNECTED")),{data:e.topic}))}),this.on(or.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[_s]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r,optionalNamespaces:i,sessionProperties:s}=e;r&&Object.keys(r).length&&(this.namespaces=r),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=s,this.persist("namespaces",r),this.persist("optionalNamespaces",i)}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,i];if(r&&!Object.keys(this.namespaces||{}).map(a=>Mn(a)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&i)return[r,i];const s=Mn(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,r=!1){if(!this.namespaces)return;const[i,s]=this.validateChain(e);s&&(r||this.getProvider(i).setDefaultChain(s),this.namespaces[i]?this.namespaces[i].defaultChain=s:this.namespaces[`${i}:${s}`]?this.namespaces[`${i}:${s}`].defaultChain=s:this.namespaces[`${i}:${s}`]={defaultChain:s},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",s))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,r){this.client.core.storage.setItem(`${kd}/${e}`,r)}async getFromStore(e){return await this.client.core.storage.getItem(`${kd}/${e}`)}}const pM=Qh,bM="wc",gM="ethereum_provider",vM=`${bM}@2:${gM}:`,yM="https://rpc.walletconnect.org/v1/",Qa=["eth_sendTransaction","personal_sign"],E1=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],eo=["chainChanged","accountsChanged"],x1=["chainChanged","accountsChanged","message","disconnect","connect"];var mM=Object.defineProperty,wM=Object.defineProperties,_M=Object.getOwnPropertyDescriptors,gl=Object.getOwnPropertySymbols,EM=Object.prototype.hasOwnProperty,xM=Object.prototype.propertyIsEnumerable,gh=(t,e,r)=>e in t?mM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Is=(t,e)=>{for(var r in e||(e={}))EM.call(e,r)&&gh(t,r,e[r]);if(gl)for(var r of gl(e))xM.call(e,r)&&gh(t,r,e[r]);return t},Ac=(t,e)=>wM(t,_M(e)),zt=(t,e,r)=>gh(t,typeof e!="symbol"?e+"":e,r);function to(t){return Number(t[0].split(":")[1])}function Ma(t){return`0x${t.toString(16)}`}function $M(t){const{chains:e,optionalChains:r,methods:i,optionalMethods:s,events:n,optionalEvents:a,rpcMap:o}=t;if(!Fr(e))throw new Error("Invalid chains");const c={chains:e,methods:i||Qa,events:n||eo,rpcMap:Is({},e.length?{[to(e)]:o[to(e)]}:{})},h=n==null?void 0:n.filter(_=>!eo.includes(_)),f=i==null?void 0:i.filter(_=>!Qa.includes(_));if(!r&&!a&&!s&&!(h!=null&&h.length)&&!(f!=null&&f.length))return{required:e.length?c:void 0};const l=(h==null?void 0:h.length)&&(f==null?void 0:f.length)||!r,v={chains:[...new Set(l?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:E1))],events:[...new Set(c.events.concat(a!=null&&a.length?a:x1))],rpcMap:o};return{required:e.length?c:void 0,optional:r.length?v:void 0}}class No{constructor(){zt(this,"events",new ir.EventEmitter),zt(this,"namespace","eip155"),zt(this,"accounts",[]),zt(this,"signer"),zt(this,"chainId",1),zt(this,"modal"),zt(this,"rpc"),zt(this,"STORAGE_KEY",vM),zt(this,"on",(e,r)=>(this.events.on(e,r),this)),zt(this,"once",(e,r)=>(this.events.once(e,r),this)),zt(this,"removeListener",(e,r)=>(this.events.removeListener(e,r),this)),zt(this,"off",(e,r)=>(this.events.off(e,r),this)),zt(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const r=new No;return await r.initialize(e),r}async request(e,r){return await this.signer.request(e,this.formatChainId(this.chainId),r)}sendAsync(e,r,i){this.signer.sendAsync(e,r,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:r,optional:i}=$M(this.rpc);try{const s=await new Promise(async(a,o)=>{var c;this.rpc.showQrModal&&((c=this.modal)==null||c.subscribeModal(h=>{!h.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),o(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Ac(Is({namespaces:Is({},r&&{[this.namespace]:r})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e==null?void 0:e.pairingTopic})).then(h=>{a(h)}).catch(h=>{o(new Error(h.message))})});if(!s)return;const n=uf(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:Ma(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async authenticate(e,r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const i=await new Promise(async(n,a)=>{var o;this.rpc.showQrModal&&((o=this.modal)==null||o.subscribeModal(c=>{!c.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Ac(Is({},e),{chains:this.rpc.chains}),r).then(c=>{n(c)}).catch(c=>{a(new Error(c.message))})}),s=i.session;if(s){const n=uf(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:Ma(this.chainId)})}return i}catch(i){throw this.signer.logger.error(i),i}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",Ma(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Ac(Is({},fe("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var r,i;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(i=this.modal)==null||i.openModal({uri:e})),this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Ma(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,i,s]=e.split(":");return{chainId:`${r}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,i;const s=(r=e==null?void 0:e.chains)!=null?r:[],n=(i=e==null?void 0:e.optionalChains)!=null?i:[],a=s.concat(n);if(!a.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const o=s.length?(e==null?void 0:e.methods)||Qa:[],c=s.length?(e==null?void 0:e.events)||eo:[],h=(e==null?void 0:e.optionalMethods)||[],f=(e==null?void 0:e.optionalEvents)||[],l=(e==null?void 0:e.rpcMap)||this.buildRpcMap(a,e.projectId),v=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(_=>this.formatChainId(_)),optionalChains:n.map(_=>this.formatChainId(_)),methods:o,events:c,optionalMethods:h,optionalEvents:f,rpcMap:l,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:v,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,r)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?to(this.rpc.chains):to(this.rpc.optionalChains),this.signer=await pM.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:i}=await yl(()=>import("./index-BqU1NI_X.js").then(s=>s.i),__vite__mapDeps([5,1,2]));r=i}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Is({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:i,rpcMap:s}=e;r&&Fr(r)&&(this.rpc.chains=r.map(n=>this.formatChainId(n)),r.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)})),i&&Fr(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i==null?void 0:i.map(n=>this.formatChainId(n)),i.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)}))}getRpcUrl(e,r){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${yM}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const SM=No,GC=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:SM,OPTIONAL_EVENTS:x1,OPTIONAL_METHODS:E1,REQUIRED_EVENTS:eo,REQUIRED_METHODS:Qa,default:No},Symbol.toStringTag,{value:"Module"}));export{gg as H,Su as a,ag as b,OM as c,PM as d,so as e,TM as f,CM as g,GC as i,MM as r,Ml as t,vg as w};
